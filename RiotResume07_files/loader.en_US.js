var pvpnet_localizations = {"languages":{"en_US":"English","pt_BR":"PORTUGU\u00caS","es_MX":"Espa\u00f1ol","es_AR":"Espa\u00f1ol","en_GB":"English","de_DE":"Deutsch","es_ES":"Espa\u00f1ol","fr_FR":"Fran\u00e7ais","it_IT":"Italiano","en_PL":"English","pl_PL":"Polski","el_GR":"\u0395\u039b\u039b\u0397\u039d\u0399\u039a\u0386","ro_RO":"ROM\u00c2N\u0102","cs_CZ":"\u010ce\u0161tina","hu_HU":"Magyar","tr_TR":"T\u00fcrk\u00e7e","ru_RU":"\u0420\u0443\u0441\u0441\u043a\u0438\u0439","en_AU":"English","kr_KR":"\ud55c\uad6d\uc5b4","en":"English","pt":"PORTUGU\u00caS","de":"Deutsch","es":"Espa\u00f1ol","fr":"Fran\u00e7ais","it":"Italiano","pl":"Polski","el":"\u0395\u039b\u039b\u0397\u039d\u0399\u039a\u0386","ro":"ROM\u00c2N\u0102","tr":"T\u00fcrk\u00e7e"},"regions":{"na":"North America","br":"Brazil","lan":"Latin America North","las":"Latin America South","euw":"EU West","eune":"EU Nordic & East","tr":"Turkey","ru":"Russia","oce":"Oceania","kr":"Republic of Korea"},"or":"or","login":"Login","logout":"Logout","email":"Email Address","username":"Username","password":"Password","forgot_username":"Recover Username","forgot_password":"Recover Password","register":"Register","support":"Support","submit":"Submit","cancel":"Cancel","myaccount":"My Account","account_name":"Account Name","recover_email":"Recover Email","recover_password":"Recover Password","invalid_auth_credentials":"Sorry, unrecognized username or password.","no_summoner_name":"You must first create a Summoner by logging into League of Legends before logging into our website.","management":{"header":"Account Management","change_email":"Change Email Address","change_password":"Change Password","summoners_code_agreement":"Summoner's Code Agreement","account_protection":"Account Protection","validate_email_btn_lbl":"Validate","current_email_lbl":"Validate Email","links":{"header":"Links","summoner_code":"The Summoner's Code","tribunal":"The Tribunal","download":"Download League of Legends","raf_program":"Refer A Friend Program","raf_status":"Refer A friend Status"},"new_email":"New Email Address","reenter_email":"Re-enter Email Address","enter_password":"Enter Password","current_password":"Current Password","new_password":"New Password","confirm_password":"Confirm Password","summoners_code_description":"In order to post content on the League of Legends website, you must decide to abide by the Summoner's Code or not.","summoners_code_body":"<div class='accordian'><div class='summoner_title'><span class='roman_num'>I<\/span>Support your Team<\/div><div class='summoner_piece'><div class='inner_text'><p><em>'[Teamwork] is the fuel that allows common people to attain uncommon results.'-Andrew Carnegie<\/em><\/p><p>While we all carry a diverse set of individual ambitions and expectations into a game of League of Legends, once we hit the Field we're a part of a team. For better or worse, our fates are intertwined with that of our teammates. Once the game gets into full swing, you have to make a choice between being a positive force for your team, or contributing to your own demise.<\/p><p>Being a good team player begins at champion select. Be open minded when considering the needs of your team. If you're the last one to pick, try to fill a niche in your team that hasn't already been filled. If everyone's picked and something stands out as s deficiency in your team composition, try asking for another player to fill the gap, or change roles to embrace that responsibility yourself. Remember, that by taking on a role you don't normally play, you'll learn more about unfamiliar champions and increase your own skill level.<\/p><p>Once you get in game, try to keep an open line of communication. Warn your teammates if someone is missing from your lane, or if something is placing them in immediate danger. If they're not paying attention to chat you can always try pinging the map. Just remember that one ping is enough! Also, remember that you have to be there to contribute, so don\u2019t leave the game or go AFK! Encourage players who are having trouble, and congratulate those who are playing well. And most of all, if you're having a bad game don't take it out on your team!<\/p><\/div><\/div><\/div><div class='accordian'><div class='summoner_title'><span class='roman_num'>II<\/span>Drive Constructive Feedback<\/div><div class='summoner_piece'><div class='inner_text'><p><em>'When you confront a problem you begin to solve it.' -Rudy Giuliani<\/em><\/p><p>Player feedback is an important force in the decision making process of Riot Games.  If you want to make your voice heard, taking the time to let us know how you're feeling about the game is a good place to start. When you give feedback, make sure you take a holistic approach. If you only give negative feedback, you may find that the changes you influence detract from what you initially enjoyed. Moreover, people are simply more likely to listen if you present yourself in a calm, well thought out manner.<\/p><p>That being said, don't be afraid to tell us if you feel strongly, and why. Try to be straightforward, specific, and always try to make your feedback direct and concise. For instance, saying something along the lines of:<\/p><p>'I used to love playing Katarina because her skills give her high mobility in lane, but with the latest nerfs to Death Lotus, I no longer feel like I have a strong enough presence in team fights to be viable. I don't think that I'm going to be playing Kat in the future unless she undergoes some revisions.'<\/p><p>Is a much better way of expressing your dismay at a patch than beginning with an irate tirade, then asking for changes to be reverted or attempting to force an alternate solution. Remember that we're listening and making changes every couple of weeks, so, with a little patience, you may find that your issues will be worked themselves out.<\/p><\/div><\/div><\/div><div class='accordian'><div class='summoner_title'><span class='roman_num'>III<\/span>Facilitate Civil Discussion<\/div><div class='summoner_piece'><div class='inner_text'><p><em>'To disagree, one doesn't have to be disagreeable.' -Barry Goldwater<\/em><\/p><p>As we mentioned earlier, we want you to give feedback, but being part of the community doesn't stop there. Whether you're in chat, in a game, or on the forums, there are plenty of people to meet, and plenty of topics to discuss. Whether you're discussing game balance and champion viability, trying to form a premade team, or just want to express your affection for the legendary and infamous Gentleman Cho'gath, we encourage you to share your thoughts with other players.<\/p><p>When you choose to participate in a discussion with the rest of the playerbase, always try to be receptive to another player's point of view. If you keep an open mind, you'd be surprised what valuable information you can glean from your fellow players. Also, be mindful of how you present your point of view. If a player feels strongly on a subject, don't get caught up trying to have the last word. Just state your side and exit the conversation gracefully rather than give them the opportunity to pick a fight.<\/p><\/div><\/div><\/div><div class='accordian'><div class='summoner_title'><span class='roman_num'>IV<\/span>Enjoy Yourself, but not at Anyone Else's Expense<\/div><div class='summoner_piece'><div class='inner_text'><p><em>'Short is the joy that guilty pleasure brings.' -Euripides<\/em><\/p><p>Making games is our business, so it should come as no surprise that we want you to have a lot of fun. We want you to get excited, to have tension-filled moments, and to celebrate your success. This doesn't mean that we're okay with you ruining anybody else's day.<\/p><p>Remember, taking a jab at your friend in the middle of the game is a lot different than making a glib remark at a complete stranger. Someone who is unfamiliar with what you consider playful may take your comment as an attack and react unfavorably. If two players on a team start fighting, good communication and teamwork become nearly impossible. Once communication breaks down, the likelihood of victory is drastically diminished. It isn't uncommon for simple, good natured teasing to spiral out of control into a loss, so do yourself a favor and don't run the risk of sabotaging your own success.<\/p><\/div><\/div><\/div><div class='accordian'><div class='summoner_title'><span class='roman_num'>V<\/span>Build Relationships<\/div><div class='summoner_piece'><div class='inner_text'><p><em>'No man is an island...' -John Donne<\/em><\/p><p>League of Legends is a team game, and, as such, familiarity and rapport with the other competitors with whom you play is going to be a big part of your success. With that in mind, it would behoove you to adopt a cordial demeanor and attempt to make friends. If you have fun playing with another player, make use of the end of game lobby to thank that player for the game and send a friend request. The more friendly players that you have at your disposal, the better your chances are of getting a good, friendly game. Also, if you have friends who you think might be a good fit for the game and community, don't hesitate to shoot them an invite. Not only will you earn yourself some awesome swag, you'll have more friends you can call upon when you're having trouble flying solo.<\/p><p>Use the tools at your disposal to try and build a circle of other players of a similar skill level. If you have a relationship with a group of players that you trust, you are much more likely to get good feedback on how you're playing, receive support when learning a new champion, and just have a good time overall.<\/p><\/div><\/div><\/div><div class='accordian'><div class='summoner_title'><span class='roman_num'>VI<\/span>Show Humility in Victory, and Grace in Defeat<\/div><div class='summoner_piece'><div class='inner_text'><p><em>'To be humble to superiors is duty, to equals is courtesy, to inferiors is nobility.' -Benjamin Franklin <\/em><\/p><p>Having a great game is one of the biggest joys that League of Legends can bring you. But always bear in mind that when you're relishing that landslide victory there is someone on the receiving end that is probably ripping their hair out. While it's alright to celebrate, make sure that you keep any gloating (or any other mode of self-indulgence) out of all chat. Instead, thank your opponents for the game. After all, despite their best efforts, they just made you a very happy person.<\/p><p>Moreover, if you've just lost, avoid pointing any fingers or deploying excuses. Even if you had a great game, it's not alright to blame your team. You had five opponents in that game, and - seeing as you just lost - chances are that they had something to do with it. We all know that losing can be frustrating, particularly if it's a close game or one that's completely one sided, but nobody likes a sore loser. Instead, thank your opponents for the game, and take a moment at the end of game screen to ask what you could have done better. If you're polite, you might pick up a few pointers that can help you counter your opponent's strategy in the future.<\/p><\/div><\/div><\/div><div class='accordian'><div class='summoner_title'><span class='roman_num'>VII<\/span>Be Resolute, not Indignant<\/div><div class='summoner_piece'><div class='inner_text'><p><em>'It is easier to find men who will volunteer to die, than to find those who are willing to endure pain with patience.' -Julius Caesar <\/em><\/p><p>Intrinsic to the idea of competition is the notion that, when our pride is on the line, emotions tend to run high. Every person that we encounter is going to carry a different set of circumstances with them into the game, and therefore is going to have a different level of tolerance for frustration. If you end up in a game with an abusive player, don't lower yourself to their level. Instead, politely ask them to calm down. And remember, even if you\u2019re having a bad game, quitting or going AFK just ruins the game for the rest of the players. If someone's really starting to bother you, the mute and ignore commands are always there to resolve the situation.<\/p><p>And remember, while nobody likes being insulted, it pays to take a moment to consider the circumstances. Remember that this is a competitive game, and, more often than not, the other player is just venting their frustration. Try not to take it personally. Everyone has a breaking point and everyone rages sometimes. At some point you may find yourself in the other person's shoes.<\/p><\/div><\/div><\/div><div class='accordian'><div class='summoner_title'><span class='roman_num'>VIII<\/span>Leave No Newbie Behind!<\/div><div class='summoner_piece'><div class='inner_text'><p><em>'Be an opener of doors for such as come after thee.' -Ralph Waldo Emerson<\/em><\/p><p>We all started somewhere, and if we're going to do justice to the people who helped us move up the ladder, we have to start by paying homage to our roots. If you see a player having a bad game, or who clearly doesn't grasp the fundamentals of the genre, try offering some constructive advice. If you do so in a civil and friendly manner, it's likely that they will be receptive. Oftentimes they'll be downright grateful that somebody took the time to let them know how to improve instead of yelling at them.<\/p><p>Never get frustrated by an inexperienced player's performance. At some point, you were just as green as they were, even if it was the day that you downloaded the League of Legends client. Have a little patience, and try and help the player step up to a level where both of you can enjoy the game.  At the same time, don't be discouraged if they aren't receptive. Some small percentage of players will get hung up on the notion that they don't need anybody's help, and, no matter how politely you try to lend a hand, they won't want to hear it. That's no reason to give up on the rest of them!<\/p><\/div><\/div><\/div><div class='accordian'><div class='summoner_title'><span class='roman_num'>IX<\/span>Lead by Example<\/div><div class='summoner_piece'><div class='inner_text'><p><em>'Leadership is practiced not so much in words as in attitude and in actions.' -Harold S. Geneen<\/em><\/p><p>If you're like us and you share a vision of a game world in which players exercise good sportsmanship, help each other improve, and make friends, you've got to start living the dream before anybody everybody else is willing to do so. It's all well and good to say you're on board for the revolution, but if you don't first make yourself a paragon of model behavior, no one is going to be fooled. Nobody's asking you to be perfect, but we do want you to, whenever possible, strive to uphold the same standards of behavior that you expect everyone else to maintain.<\/p><p>So, remember! Stay positive, remain calm, and keep to the code!<\/p><\/div><\/div><\/div>","ACCT_PROTN_LBL":"Account Protection","ACCT_PROTN_VFY_EML_LBL":"Verify your email","ACCT_PROTN_VFY_DONE_EML_LBL":"Verified Email","ACCT_PROTN_VFY_EML_C2A_DESC":"<p>Verifying your email will let you:<\/p><ul><li>Authorize email\/password changes<\/li><li>Recover your account<\/li><\/ul>","ACCT_PROTN_VFY_EML_SEND_TXT":"Verify","ACCT_PROTN_VFY_EML_RESEND_TXT":"Resend","ACCT_PROTN_EML_CHG":"Change Email","ACCT_PROTN_ADD_SMS_LBL":"Add SMS Mobile Protection*","ACCT_PROTN_ADD_SMS_REQ":"* Requires Verified Email","ACCOUNT_PROTECTION":"Account Protection","ACCT_PROTN_VFY_EML_SEND_MSG":"A verification e-mail has been sent to","ACCT_PROTN_VFY_EML_SEND_CALL_OUT":"Click the link in the e-mail to verify this e-mail address.","ACCT_PROTN_IP_BOOST_TXT":"Verify your email and you will receive a 4 win IP boost. This may take up to 48 hours to be awarded.","ACCT_PROTN_VERIFY_SUCCESS_DESC":"You will now receive account notifications and confirmations to the verified email address","ACCT_PROTN_ADD_SMS_DESC":"<ul><li>More secure than email<\/li><li>Authorize email\/password changes through SMS<\/li><li>Recover your account<\/li><\/ul>","ACCT_PROTN_ADD_SMS_C2A":"Add SMS","ACCT_PROTN_ADD_SMS_DISCL":"* Standard messaging charges may apply. Some languages may not be supported by local carriers. Your phone # will only be used for account notifications. For more information on our privacy policy <a href='http:\/\/beta.na.leagueoflegends.com\/en\/legal\/privacy' target='_blank'>click here<\/a>.","ACCT_PROTN_VERIFY_PHONE_TITLE":"Verify Mobile Phone Number","ACCT_PROTN_VERIFY_PHONE_DESC_1":"Mobile phone number:","ACCT_PROTN_VERIFY_PHONE_DESC_2":"Your mobile phone number will be stored and it will be used for account notification and authentication purposes ONLY.","ACCT_PROTN_ENTER_CODE_TITLE":"Enter Mobile Verification Code","ACCT_PROTN_ENTER_CODE_DESC_1":"A text message has been sent to your mobile device.","ACCT_PROTN_ENTER_CODE_DESC_2":"Please enter the code you receive.","ACCT_PROTN_ENTER_CODE_DESC_3":"Your mobile phone number will be stored and it will be used for account notification and authentication purposes ONLY.","ACCT_PROTN_PHONE_CHG":"Remove","ACCT_PROTN_ADD_SMS_SUCCESS_DESC":"You will now receive account notifications and confirmations to the verified phone number.","ACCT_PROTN_RESEND_PASSCODE":"Resend Passcode","PASSCODE_LABEL":"Passcode:","COUNTRY_LABEL":"Country:","COUNTRY_PLACEHOLDER":"Select your country...","EMAIL_UPDATE_SUCCESS":"You have successfully changed your email address!","ACCT_PROTN_ADDED_SMS_LBL":"SMS Mobile Protection*","PASSCODE_EXPIRY":". This passcode will expire in ten minutes."},"strongpassword":{"loading":"Loading...","label":"Strength (must be okay or strong):","value-0":"too weak","value-1":"okay","value-2":"strong","value-3":"STRONGPASSWORD_VALUE_3","tooltip-1":"Must contain one number and one letter, be between 8 and 24 characters, and cannot have slashes or spaces <br><br>Easy for you to remember, but hard to guess.","tooltip-2":"","example":"Example:","bad":"Bad:","better":"Better:","best":"Best:"},"service_error":"An error has occurred.  Please try again later.","password_weak":"Your password is too weak."};
var sw_cfg = window.sw_cfg || {
host: "https://account.leagueoflegends.com",
default_region: "na",
regions: {"na":{"default":"en_US","languages":["en_US"],"homepage":"http:\/\/na.leagueoflegends.com"},"br":{"default":"pt_BR","languages":["pt_BR"],"homepage":"http:\/\/br.leagueoflegends.com"},"lan":{"default":"es_MX","languages":["es_MX"],"homepage":"http:\/\/lan.leagueoflegends.com"},"las":{"default":"es_AR","languages":["es_AR"],"homepage":"http:\/\/las.leagueoflegends.com"},"euw":{"default":"en_GB","languages":["en_GB","de_DE","es_ES","fr_FR","it_IT"],"homepage":"http:\/\/euw.leagueoflegends.com"},"eune":{"default":"en_PL","languages":["en_PL","pl_PL","el_GR","ro_RO","cs_CZ","hu_HU"],"homepage":"http:\/\/eune.leagueoflegends.com"},"tr":{"default":"tr_TR","languages":["tr_TR"],"homepage":"http:\/\/tr.leagueoflegends.com"},"ru":{"default":"ru_RU","languages":["ru_RU"],"homepage":"http:\/\/ru.leagueoflegends.com"},"oce":{"default":"en_AU","languages":["en_AU"],"homepage":"http:\/\/oce.leagueoflegends.com"},"kr":{"default":"kr_KR","languages":["kr_KR"],"homepage":"http:\/\/kr.leagueoflegends.com","unmanaged":true}},
default_language: "en_US",
captcha_public_key: "6LcwdeESAAAAAJg_ltVGdjrqlf7Bmbg449SyUcSW",
emailRegExp: /^([^@\s\t]+@[^@\s\t\.]+(\.[^@\s\t\.]*)?\.[^@\s\t\.]+)$/,
account_protection_regions: ["oce","tr","br","na","euw","eune","lan","las","ru"],
ga_account: "UA-5859958-25"
};
var Riot = Riot || {};
(function(Riot) {
function isArray(item) {
return Object.prototype.toString.call(item) === '[object Array]';
};
function rebase(data) {
var i = 0,
j = arguments.length,
under,prop,type;
while (++i < j) {
under = arguments[i];
for (prop in under) {
if (under.hasOwnProperty(prop)) {
type = typeof(under[prop]);
// We add base to that prop, since it's missing
if(typeof(data[prop]) === 'undefined') {
if(type === 'object') {
rebase(data[prop] = (isArray(under[prop])?[]:{}),under[prop]);
}
else {
data[prop] = under[prop];
}
}
else {
// We only extend it further when dealing with objects
if(type === 'object' && !(typeof(data[prop]) === 'function') && !isArray(data[prop])) {
rebase(data[prop],under[prop])
}else if(type === 'function' && typeof(data[prop]) === 'function'){
data[prop] = under[prop];
}
}
}
}
}
return data;
};
function getCookie(cookie) {
var regex = new RegExp(cookie + "=([^;]*)"),
match = regex.exec(document.cookie);
if (match) {
return match[1];
}
return false;
};
function setCookie(cookie, value, options) {
var cookieString = cookie + "=" + value + ";";
options = options || {};
options = rebase(options, {
expires: false,
path: false,
domain: false,
secure: false
});
if (options.expires) {
cookieString += "expires=" + options.expires + ";";
}
if (options.path) {
cookieString += "path=" + options.path + ";";
}
if (options.domain) {
cookieString += "domain=" + options.domain + ";";
}
if (options.secure) {
cookieString += "secure;";
}
document.cookie = cookieString;
};
// CSS injection Methods
var stylesheets = {};
function cssPrepare(id, css) {
if(typeof stylesheets[id] === "undefined") {
var style = document.createElement("style");
style.type = "text/css";
if(style.styleSheet) {
style.styleSheet.cssText = css;
}
else {
style.appendChild(document.createTextNode(css));
}
stylesheets[id] = style;
}
};
function cssPrepareLink(id, link) {
if(typeof stylesheets[id] === "undefined") {
var style = document.createElement('link');
style.href = link;
style.rel = 'stylesheet';
style.type ='text/css';
style.media ='all';
stylesheets[id] = style;
}
};
function cssInject(id) {
if(stylesheets[id]) {
if(document.getElementsByTagName("head").length > 0){
document.getElementsByTagName('head')[0].appendChild(stylesheets[id]);
}else{
document.getElementsByTagName('html')[0].appendChild(stylesheets[id]);
}
stylesheets[id] = false;
}
};
function getDomain(){
var location = window.location.hostname.split("."),
domain;
if (location.length > 2) {
domain = "." + location.slice( location.length - 2 ).join(".");
}
else {
domain = "." + window.location.hostname;
}
return domain;
};
function getParameterByName(name){
name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
var regexS = "[\\?&]" + name + "=([^&#]*)";
var regex = new RegExp(regexS);
var results = regex.exec(window.location.search);
if(results == null)
return "";
else
return decodeURIComponent(results[1].replace(/\+/g, " "));
};
function Observer() {
this.listeners = {};
this.listenerId = 0;
this.listenerTracker = {};
};
Observer.prototype.addListener = function addListener(type, callback) {
if(typeof this.listeners[type] === 'undefined') {
this.listeners[type] = [];
}
if(typeof callback.listenerId === 'undefined') {
callback.listenerId = ++this.listenerId;
this.listenerTracker[this.listenerId] = this.listeners[type].length;
this.listeners[type].push(callback);
}
};
Observer.prototype.removeListener = function removeListener(type, callback) {
if(
typeof callback.listenerId !== 'undefined' &&
typeof this.listeners[type] !== 'undefined' &&
typeof this.listenerTracker[callback.listenerId] !== 'undefined'
) {
this.listeners[type].splice(this.listenerTracker[callback.listenerId],1);
delete callback.listenerId;
}
};
Observer.prototype.trigger = function trigger(type, data) {
if(typeof this.listeners[type] !== 'undefined') {
data = data || {};
var count = this.listeners[type].length;
while(count--) {
this.listeners[type][count](data);
}
}
};
Observer.prototype.injectOnto = function injectOnto(object) {
var prop;
for(prop in this) {
if(this.hasOwnProperty(prop)) {
object[prop] = this[prop];
}
}
for(prop in Observer.prototype) {
object[prop] = Observer.prototype[prop];
}
return object;
};
var hasFeature = (function() {
var features = {},
body = document.getElementsByTagName('body')[0];
if(typeof body === 'undefined') {
throw "RiotCore must be loaded within the body tag.";
}
// First CSS detection
var cssAttributeNames = [
{
type:'borderRadius',
attributes:['borderRadius', 'MozBorderRadius', 'WebkitBorderRadius', 'OBorderRadius', 'KhtmlBorderRadius']
}],
typeCount = cssAttributeNames.length, attributes, attributeCount, attributeName;
// Loops through the above to check for sets of css properties
while(typeCount--) {
attributes = cssAttributeNames[typeCount].attributes;
attributeCount = attributes.length;
while(attributeCount--) {
attributeName = attributes[attributeCount];
if(typeof body.style[attributeName] !== 'undefined') {
features[cssAttributeNames[typeCount].type] = true;
break;
}
}
if(attributeCount < 0) {
features[cssAttributeNames[typeCount].type] = false;
}
}
return function(featureType) {
return features[featureType];
}
})();
// Expose
rebase(Riot, {
isArray: isArray,
rebase: rebase,
getCookie: getCookie,
setCookie: setCookie,
cssPrepare: cssPrepare,
cssPrepareLink: cssPrepareLink,
cssInject: cssInject,
Observer: Observer,
getParameterByName: getParameterByName,
hasFeature: hasFeature,
getDomain: getDomain
});
})(Riot);

(function(f,n){"object"===typeof exports?module.exports=n():"function"===typeof define&&define.amd?define(n):f.IPv6=n(f)})(this,function(f){var n=f&&f.IPv6;return{best:function(g){g=g.toLowerCase().split(":");var h=g.length,d=8;""===g[0]&&""===g[1]&&""===g[2]?(g.shift(),g.shift()):""===g[0]&&""===g[1]?g.shift():""===g[h-1]&&""===g[h-2]&&g.pop();h=g.length;-1!==g[h-1].indexOf(".")&&(d=7);var m;for(m=0;m<h&&""!==g[m];m++);if(m<d)for(g.splice(m,1,"0000");g.length<d;)g.splice(m,0,"0000");for(m=0;m<d;m++){for(var h=
g[m].split(""),f=0;3>f;f++)if("0"===h[0]&&1<h.length)h.splice(0,1);else break;g[m]=h.join("")}var h=-1,n=f=0,k=-1,u=!1;for(m=0;m<d;m++)u?"0"===g[m]?n+=1:(u=!1,n>f&&(h=k,f=n)):"0"===g[m]&&(u=!0,k=m,n=1);n>f&&(h=k,f=n);1<f&&g.splice(h,f,"");h=g.length;d="";""===g[0]&&(d=":");for(m=0;m<h;m++){d+=g[m];if(m===h-1)break;d+=":"}""===g[h-1]&&(d+=":");return d},noConflict:function(){f.IPv6===this&&(f.IPv6=n);return this}}});
(function(f){function n(a){throw RangeError(B[a]);}function g(a,b){for(var c=a.length;c--;)a[c]=b(a[c]);return a}function h(a,b){return g(a.split(l),b).join(".")}function d(a){for(var b=[],c=0,d=a.length,l,e;c<d;)l=a.charCodeAt(c++),55296<=l&&56319>=l&&c<d?(e=a.charCodeAt(c++),56320==(e&64512)?b.push(((l&1023)<<10)+(e&1023)+65536):(b.push(l),c--)):b.push(l);return b}function m(a){return g(a,function(a){var b="";65535<a&&(a-=65536,b+=D(a>>>10&1023|55296),a=56320|a&1023);return b+=D(a)}).join("")}function w(a,
b){return a+22+75*(26>a)-((0!=b)<<5)}function r(a,b,c){var d=0;a=c?z(a/H):a>>1;for(a+=z(a/b);a>v*t>>1;d+=p)a=z(a/v);return z(d+(v+1)*a/(a+x))}function k(b){var c=[],d=b.length,l,e=0,B=E,k=F,g,v,f,h,u;g=b.lastIndexOf(a);0>g&&(g=0);for(v=0;v<g;++v)128<=b.charCodeAt(v)&&n("not-basic"),c.push(b.charCodeAt(v));for(g=0<g?g+1:0;g<d;){v=e;l=1;for(f=p;;f+=p){g>=d&&n("invalid-input");h=b.charCodeAt(g++);h=10>h-48?h-22:26>h-65?h-65:26>h-97?h-97:p;(h>=p||h>z((q-e)/l))&&n("overflow");e+=h*l;u=f<=k?s:f>=k+t?t:
f-k;if(h<u)break;h=p-u;l>z(q/h)&&n("overflow");l*=h}l=c.length+1;k=r(e-v,l,0==v);z(e/l)>q-B&&n("overflow");B+=z(e/l);e%=l;c.splice(e++,0,B)}return m(c)}function u(b){var c,l,e,B,g,k,v,h,f,u=[],m,y,A;b=d(b);m=b.length;c=E;l=0;g=F;for(k=0;k<m;++k)f=b[k],128>f&&u.push(D(f));for((e=B=u.length)&&u.push(a);e<m;){v=q;for(k=0;k<m;++k)f=b[k],f>=c&&f<v&&(v=f);y=e+1;v-c>z((q-l)/y)&&n("overflow");l+=(v-c)*y;c=v;for(k=0;k<m;++k)if(f=b[k],f<c&&++l>q&&n("overflow"),f==c){h=l;for(v=p;;v+=p){f=v<=g?s:v>=g+t?t:v-g;
if(h<f)break;A=h-f;h=p-f;u.push(D(w(f+A%h,0)));h=z(A/h)}u.push(D(w(h,0)));g=r(l,y,e==B);l=0;++e}++l;++c}return u.join("")}var y="object"==typeof exports&&exports,A="object"==typeof module&&module&&module.exports==y&&module,C="object"==typeof global&&global;if(C.global===C||C.window===C)f=C;var e,q=2147483647,p=36,s=1,t=26,x=38,H=700,F=72,E=128,a="-",b=/^xn--/,c=/[^ -~]/,l=/\x2E|\u3002|\uFF0E|\uFF61/g,B={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)",
"invalid-input":"Invalid input"},v=p-s,z=Math.floor,D=String.fromCharCode,G;e={version:"1.2.3",ucs2:{decode:d,encode:m},decode:k,encode:u,toASCII:function(a){return h(a,function(a){return c.test(a)?"xn--"+u(a):a})},toUnicode:function(a){return h(a,function(a){return b.test(a)?k(a.slice(4).toLowerCase()):a})}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return e});else if(y&&!y.nodeType)if(A)A.exports=e;else for(G in e)e.hasOwnProperty(G)&&(y[G]=e[G]);else f.punycode=
e})(this);
(function(f,n){"object"===typeof exports?module.exports=n():"function"===typeof define&&define.amd?define(n):f.SecondLevelDomains=n(f)})(this,function(f){var n=f&&f.SecondLevelDomains,g={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",
bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",
cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ","do":" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",
et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ","in":" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",
ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",
kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",
mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",
pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",
sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",
na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",
rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",
tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",
us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch "},has:function(h){var d=h.lastIndexOf(".");if(0>=d||d>=h.length-1)return!1;
var f=h.lastIndexOf(".",d-1);if(0>=f||f>=d-1)return!1;var n=g.list[h.slice(d+1)];return n?0<=n.indexOf(" "+h.slice(f+1,d)+" "):!1},is:function(f){var d=f.lastIndexOf(".");if(0>=d||d>=f.length-1||0<=f.lastIndexOf(".",d-1))return!1;var m=g.list[f.slice(d+1)];return m?0<=m.indexOf(" "+f.slice(0,d)+" "):!1},get:function(f){var d=f.lastIndexOf(".");if(0>=d||d>=f.length-1)return null;var m=f.lastIndexOf(".",d-1);if(0>=m||m>=d-1)return null;var n=g.list[f.slice(d+1)];return!n||0>n.indexOf(" "+f.slice(m+
1,d)+" ")?null:f.slice(m+1)},noConflict:function(){f.SecondLevelDomains===this&&(f.SecondLevelDomains=n);return this}};return g});
(function(f,n){"object"===typeof exports?module.exports=n(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"===typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],n):f.URI=n(f.punycode,f.IPv6,f.SecondLevelDomains,f)})(this,function(f,n,g,h){function d(a,b){if(!(this instanceof d))return new d(a,b);void 0===a&&(a="undefined"!==typeof location?location.href+"":"");this.href(a);return void 0!==b?this.absoluteTo(b):this}function m(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,
"\\$1")}function w(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function r(a){return"Array"===w(a)}function k(a,b){var c,d;if(r(b)){c=0;for(d=b.length;c<d;c++)if(!k(a,b[c]))return!1;return!0}var e=w(b);c=0;for(d=a.length;c<d;c++)if("RegExp"===e){if("string"===typeof a[c]&&a[c].match(b))return!0}else if(a[c]===b)return!0;return!1}function u(a,b){if(!r(a)||!r(b)||a.length!==b.length)return!1;a.sort();b.sort();for(var c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;
return!0}function y(a){return escape(a)}function A(a){return encodeURIComponent(a).replace(/[!'()*]/g,y).replace(/\*/g,"%2A")}var C=h&&h.URI;d.version="1.13.1";var e=d.prototype,q=Object.prototype.hasOwnProperty;d._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:d.duplicateQueryParameters,escapeQuerySpace:d.escapeQuerySpace}};d.duplicateQueryParameters=!1;d.escapeQuerySpace=!0;d.protocol_expression=
/^[a-z][a-z0-9.+-]*$/i;d.idn_expression=/[^a-z0-9\.-]/i;d.punycode_expression=/(xn--)/i;d.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;d.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;
d.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig;d.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/};d.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};d.invalid_hostname_characters=
/[^a-zA-Z0-9\.-]/;d.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src"};d.getDomAttribute=function(a){if(a&&a.nodeName){var b=a.nodeName.toLowerCase();return"input"===b&&"image"!==a.type?void 0:d.domAttributes[b]}};d.encode=A;d.decode=decodeURIComponent;d.iso8859=function(){d.encode=escape;d.decode=unescape};d.unicode=function(){d.encode=A;d.decode=decodeURIComponent};d.characters=
{pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}};d.encodeQuery=
function(a,b){var c=d.encode(a+"");void 0===b&&(b=d.escapeQuerySpace);return b?c.replace(/%20/g,"+"):c};d.decodeQuery=function(a,b){a+="";void 0===b&&(b=d.escapeQuerySpace);try{return d.decode(b?a.replace(/\+/g,"%20"):a)}catch(c){return a}};d.recodePath=function(a){a=(a+"").split("/");for(var b=0,c=a.length;b<c;b++)a[b]=d.encodePathSegment(d.decode(a[b]));return a.join("/")};d.decodePath=function(a){a=(a+"").split("/");for(var b=0,c=a.length;b<c;b++)a[b]=d.decodePathSegment(a[b]);return a.join("/")};
var p={encode:"encode",decode:"decode"},s,t=function(a,b){return function(c){return d[b](c+"").replace(d.characters[a][b].expression,function(c){return d.characters[a][b].map[c]})}};for(s in p)d[s+"PathSegment"]=t("pathname",p[s]);d.encodeReserved=t("reserved","encode");d.parse=function(a,b){var c;b||(b={});c=a.indexOf("#");-1<c&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c));c=a.indexOf("?");-1<c&&(b.query=a.substring(c+1)||null,a=a.substring(0,c));"//"===a.substring(0,2)?(b.protocol=null,
a=a.substring(2),a=d.parseAuthority(a,b)):(c=a.indexOf(":"),-1<c&&(b.protocol=a.substring(0,c)||null,b.protocol&&!b.protocol.match(d.protocol_expression)?b.protocol=void 0:"file"===b.protocol?a=a.substring(c+3):"//"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=d.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0)));b.path=a;return b};d.parseHost=function(a,b){var c=a.indexOf("/"),d;-1===c&&(c=a.length);"["===a.charAt(0)?(d=a.indexOf("]"),b.hostname=a.substring(1,d)||null,b.port=a.substring(d+2,c)||
null,"/"===b.port&&(b.port=null)):a.indexOf(":")!==a.lastIndexOf(":")?(b.hostname=a.substring(0,c)||null,b.port=null):(d=a.substring(0,c).split(":"),b.hostname=d[0]||null,b.port=d[1]||null);b.hostname&&"/"!==a.substring(c).charAt(0)&&(c++,a="/"+a);return a.substring(c)||"/"};d.parseAuthority=function(a,b){a=d.parseUserinfo(a,b);return d.parseHost(a,b)};d.parseUserinfo=function(a,b){var c=a.indexOf("/"),l=-1<c?a.lastIndexOf("@",c):a.indexOf("@");-1<l&&(-1===c||l<c)?(c=a.substring(0,l).split(":"),b.username=
c[0]?d.decode(c[0]):null,c.shift(),b.password=c[0]?d.decode(c.join(":")):null,a=a.substring(l+1)):(b.username=null,b.password=null);return a};d.parseQuery=function(a,b){if(!a)return{};a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!a)return{};for(var c={},l=a.split("&"),e=l.length,f,k,g=0;g<e;g++)f=l[g].split("="),k=d.decodeQuery(f.shift(),b),f=f.length?d.decodeQuery(f.join("="),b):null,c[k]?("string"===typeof c[k]&&(c[k]=[c[k]]),c[k].push(f)):c[k]=f;return c};d.build=function(a){var b="";a.protocol&&
(b+=a.protocol+":");a.urn||!b&&!a.hostname||(b+="//");b+=d.buildAuthority(a)||"";"string"===typeof a.path&&("/"!==a.path.charAt(0)&&"string"===typeof a.hostname&&(b+="/"),b+=a.path);"string"===typeof a.query&&a.query&&(b+="?"+a.query);"string"===typeof a.fragment&&a.fragment&&(b+="#"+a.fragment);return b};d.buildHost=function(a){var b="";if(a.hostname)b=d.ip6_expression.test(a.hostname)?b+("["+a.hostname+"]"):b+a.hostname;else return"";a.port&&(b+=":"+a.port);return b};d.buildAuthority=function(a){return d.buildUserinfo(a)+
d.buildHost(a)};d.buildUserinfo=function(a){var b="";a.username&&(b+=d.encode(a.username),a.password&&(b+=":"+d.encode(a.password)),b+="@");return b};d.buildQuery=function(a,b,c){var l="",e,f,k,g;for(f in a)if(q.call(a,f)&&f)if(r(a[f]))for(e={},k=0,g=a[f].length;k<g;k++)void 0!==a[f][k]&&void 0===e[a[f][k]+""]&&(l+="&"+d.buildQueryParameter(f,a[f][k],c),!0!==b&&(e[a[f][k]+""]=!0));else void 0!==a[f]&&(l+="&"+d.buildQueryParameter(f,a[f],c));return l.substring(1)};d.buildQueryParameter=function(a,
b,c){return d.encodeQuery(a,c)+(null!==b?"="+d.encodeQuery(b,c):"")};d.addQuery=function(a,b,c){if("object"===typeof b)for(var l in b)q.call(b,l)&&d.addQuery(a,l,b[l]);else if("string"===typeof b)void 0===a[b]?a[b]=c:("string"===typeof a[b]&&(a[b]=[a[b]]),r(c)||(c=[c]),a[b]=a[b].concat(c));else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");};d.removeQuery=function(a,b,c){var l;if(r(b))for(c=0,l=b.length;c<l;c++)a[b[c]]=void 0;else if("object"===typeof b)for(l in b)q.call(b,
l)&&d.removeQuery(a,l,b[l]);else if("string"===typeof b)if(void 0!==c)if(a[b]===c)a[b]=void 0;else{if(r(a[b])){l=a[b];var e={},f,k;if(r(c))for(f=0,k=c.length;f<k;f++)e[c[f]]=!0;else e[c]=!0;f=0;for(k=l.length;f<k;f++)void 0!==e[l[f]]&&(l.splice(f,1),k--,f--);a[b]=l}}else a[b]=void 0;else throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");};d.hasQuery=function(a,b,c,l){if("object"===typeof b){for(var e in b)if(q.call(b,e)&&!d.hasQuery(a,e,b[e]))return!1;return!0}if("string"!==
typeof b)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(w(c)){case "Undefined":return b in a;case "Boolean":return a=Boolean(r(a[b])?a[b].length:a[b]),c===a;case "Function":return!!c(a[b],b,a);case "Array":return r(a[b])?(l?k:u)(a[b],c):!1;case "RegExp":return r(a[b])?l?k(a[b],c):!1:Boolean(a[b]&&a[b].match(c));case "Number":c=String(c);case "String":return r(a[b])?l?k(a[b],c):!1:a[b]===c;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter");
}};d.commonPath=function(a,b){var c=Math.min(a.length,b.length),d;for(d=0;d<c;d++)if(a.charAt(d)!==b.charAt(d)){d--;break}if(1>d)return a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":"";if("/"!==a.charAt(d)||"/"!==b.charAt(d))d=a.substring(0,d).lastIndexOf("/");return a.substring(0,d+1)};d.withinString=function(a,b,c){c||(c={});var l=c.start||d.findUri.start,e=c.end||d.findUri.end,f=c.trim||d.findUri.trim,k=/[a-z0-9-]=["']?$/i;for(l.lastIndex=0;;){var g=l.exec(a);if(!g)break;g=g.index;if(c.ignoreHtml){var h=
a.slice(Math.max(g-3,0),g);if(h&&k.test(h))continue}var h=g+a.slice(g).search(e),u=a.slice(g,h).replace(f,"");c.ignore&&c.ignore.test(u)||(h=g+u.length,u=b(u,g,h,a),a=a.slice(0,g)+u+a.slice(h),l.lastIndex=g+u.length)}l.lastIndex=0;return a};d.ensureValidHostname=function(a){if(a.match(d.invalid_hostname_characters)){if(!f)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(f.toASCII(a).match(d.invalid_hostname_characters))throw new TypeError('Hostname "'+
a+'" contains characters other than [A-Z0-9.-]');}};d.noConflict=function(a){if(a)return a={URI:this.noConflict()},h.URITemplate&&"function"===typeof h.URITemplate.noConflict&&(a.URITemplate=h.URITemplate.noConflict()),h.IPv6&&"function"===typeof h.IPv6.noConflict&&(a.IPv6=h.IPv6.noConflict()),h.SecondLevelDomains&&"function"===typeof h.SecondLevelDomains.noConflict&&(a.SecondLevelDomains=h.SecondLevelDomains.noConflict()),a;h.URI===this&&(h.URI=C);return this};e.build=function(a){if(!0===a)this._deferred_build=
!0;else if(void 0===a||this._deferred_build)this._string=d.build(this._parts),this._deferred_build=!1;return this};e.clone=function(){return new d(this)};e.valueOf=e.toString=function(){return this.build(!1)._string};p={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"};t=function(a){return function(b,c){if(void 0===b)return this._parts[a]||"";this._parts[a]=b||null;this.build(!c);return this}};for(s in p)e[s]=t(p[s]);p={query:"?",fragment:"#"};t=function(a,
b){return function(c,d){if(void 0===c)return this._parts[a]||"";null!==c&&(c+="",c.charAt(0)===b&&(c=c.substring(1)));this._parts[a]=c;this.build(!d);return this}};for(s in p)e[s]=t(s,p[s]);p={search:["?","query"],hash:["#","fragment"]};t=function(a,b){return function(c,d){var e=this[a](c,d);return"string"===typeof e&&e.length?b+e:e}};for(s in p)e[s]=t(p[s][1],p[s][0]);e.pathname=function(a,b){if(void 0===a||!0===a){var c=this._parts.path||(this._parts.hostname?"/":"");return a?d.decodePath(c):c}this._parts.path=
a?d.recodePath(a):"/";this.build(!b);return this};e.path=e.pathname;e.href=function(a,b){var c;if(void 0===a)return this.toString();this._string="";this._parts=d._parts();var l=a instanceof d,e="object"===typeof a&&(a.hostname||a.path||a.pathname);a.nodeName&&(e=d.getDomAttribute(a),a=a[e]||"",e=!1);!l&&e&&void 0!==a.pathname&&(a=a.toString());if("string"===typeof a)this._parts=d.parse(a,this._parts);else if(l||e)for(c in l=l?a._parts:a,l)q.call(this._parts,c)&&(this._parts[c]=l[c]);else throw new TypeError("invalid input");
this.build(!b);return this};e.is=function(a){var b=!1,c=!1,e=!1,f=!1,k=!1,h=!1,u=!1,p=!this._parts.urn;this._parts.hostname&&(p=!1,c=d.ip4_expression.test(this._parts.hostname),e=d.ip6_expression.test(this._parts.hostname),b=c||e,k=(f=!b)&&g&&g.has(this._parts.hostname),h=f&&d.idn_expression.test(this._parts.hostname),u=f&&d.punycode_expression.test(this._parts.hostname));switch(a.toLowerCase()){case "relative":return p;case "absolute":return!p;case "domain":case "name":return f;case "sld":return k;
case "ip":return b;case "ip4":case "ipv4":case "inet4":return c;case "ip6":case "ipv6":case "inet6":return e;case "idn":return h;case "url":return!this._parts.urn;case "urn":return!!this._parts.urn;case "punycode":return u}return null};var x=e.protocol,H=e.port,F=e.hostname;e.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\/\/)?$/,""),!a.match(d.protocol_expression)))throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return x.call(this,
a,b)};e.scheme=e.protocol;e.port=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError('Port "'+a+'" contains characters other than [0-9]');return H.call(this,a,b)};e.hostname=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var c={};d.parseHost(a,c);a=c.hostname}return F.call(this,a,b)};e.host=function(a,b){if(this._parts.urn)return void 0===a?"":this;
if(void 0===a)return this._parts.hostname?d.buildHost(this._parts):"";d.parseHost(a,this._parts);this.build(!b);return this};e.authority=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?d.buildAuthority(this._parts):"";d.parseAuthority(a,this._parts);this.build(!b);return this};e.userinfo=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.username)return"";var c=d.buildUserinfo(this._parts);return c.substring(0,
c.length-1)}"@"!==a[a.length-1]&&(a+="@");d.parseUserinfo(a,this._parts);this.build(!b);return this};e.resource=function(a,b){var c;if(void 0===a)return this.path()+this.search()+this.hash();c=d.parse(a);this._parts.path=c.path;this._parts.query=c.query;this._parts.fragment=c.fragment;this.build(!b);return this};e.subdomain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.length-this.domain().length-
1;return this._parts.hostname.substring(0,c)||""}c=this._parts.hostname.length-this.domain().length;c=this._parts.hostname.substring(0,c);c=RegExp("^"+m(c));a&&"."!==a.charAt(a.length-1)&&(a+=".");a&&d.ensureValidHostname(a);this._parts.hostname=this._parts.hostname.replace(c,a);this.build(!b);return this};e.domain=function(a,b){if(this._parts.urn)return void 0===a?"":this;"boolean"===typeof a&&(b=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.match(/\./g);
if(c&&2>c.length)return this._parts.hostname;c=this._parts.hostname.length-this.tld(b).length-1;c=this._parts.hostname.lastIndexOf(".",c-1)+1;return this._parts.hostname.substring(c)||""}if(!a)throw new TypeError("cannot set domain empty");d.ensureValidHostname(a);!this._parts.hostname||this.is("IP")?this._parts.hostname=a:(c=RegExp(m(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a));this.build(!b);return this};e.tld=function(a,b){if(this._parts.urn)return void 0===a?"":
this;"boolean"===typeof a&&(b=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.lastIndexOf("."),c=this._parts.hostname.substring(c+1);return!0!==b&&g&&g.list[c.toLowerCase()]?g.get(this._parts.hostname)||c:c}if(a)if(a.match(/[^a-zA-Z0-9-]/))if(g&&g.is(a))c=RegExp(m(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a);else throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||
this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");c=RegExp(m(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(c,a)}else throw new TypeError("cannot set TLD empty");this.build(!b);return this};e.directory=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var c=this._parts.path.length-this.filename().length-1,c=this._parts.path.substring(0,
c)||(this._parts.hostname?"/":"");return a?d.decodePath(c):c}c=this._parts.path.length-this.filename().length;c=this._parts.path.substring(0,c);c=RegExp("^"+m(c));this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a));a&&"/"!==a.charAt(a.length-1)&&(a+="/");a=d.recodePath(a);this._parts.path=this._parts.path.replace(c,a);this.build(!b);return this};e.filename=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";
var c=this._parts.path.lastIndexOf("/"),c=this._parts.path.substring(c+1);return a?d.decodePathSegment(c):c}c=!1;"/"===a.charAt(0)&&(a=a.substring(1));a.match(/\.?\//)&&(c=!0);var e=RegExp(m(this.filename())+"$");a=d.recodePath(a);this._parts.path=this._parts.path.replace(e,a);c?this.normalizePath(b):this.build(!b);return this};e.suffix=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var c=this.filename(),e=c.lastIndexOf(".");
if(-1===e)return"";c=c.substring(e+1);c=/^[a-z0-9%]+$/i.test(c)?c:"";return a?d.decodePathSegment(c):c}"."===a.charAt(0)&&(a=a.substring(1));if(c=this.suffix())e=a?RegExp(m(c)+"$"):RegExp(m("."+c)+"$");else{if(!a)return this;this._parts.path+="."+d.recodePath(a)}e&&(a=d.recodePath(a),this._parts.path=this._parts.path.replace(e,a));this.build(!b);return this};e.segment=function(a,b,c){var d=this._parts.urn?":":"/",e=this.path(),f="/"===e.substring(0,1),e=e.split(d);void 0!==a&&"number"!==typeof a&&
(c=b,b=a,a=void 0);if(void 0!==a&&"number"!==typeof a)throw Error('Bad segment "'+a+'", must be 0-based integer');f&&e.shift();0>a&&(a=Math.max(e.length+a,0));if(void 0===b)return void 0===a?e:e[a];if(null===a||void 0===e[a])if(r(b)){e=[];a=0;for(var k=b.length;a<k;a++)if(b[a].length||e.length&&e[e.length-1].length)e.length&&!e[e.length-1].length&&e.pop(),e.push(b[a])}else{if(b||"string"===typeof b)""===e[e.length-1]?e[e.length-1]=b:e.push(b)}else b||"string"===typeof b&&b.length?e[a]=b:e.splice(a,
1);f&&e.unshift("");return this.path(e.join(d),c)};e.segmentCoded=function(a,b,c){var e,f;"number"!==typeof a&&(c=b,b=a,a=void 0);if(void 0===b){a=this.segment(a,b,c);if(r(a))for(e=0,f=a.length;e<f;e++)a[e]=d.decode(a[e]);else a=void 0!==a?d.decode(a):void 0;return a}if(r(b))for(e=0,f=b.length;e<f;e++)b[e]=d.decode(b[e]);else b="string"===typeof b?d.encode(b):b;return this.segment(a,b,c)};var E=e.query;e.query=function(a,b){if(!0===a)return d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);
if("function"===typeof a){var c=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace),e=a.call(this,c);this._parts.query=d.buildQuery(e||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!b);return this}return void 0!==a&&"string"!==typeof a?(this._parts.query=d.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):E.call(this,a,b)};e.setQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);
if("object"===typeof a)for(var f in a)q.call(a,f)&&(e[f]=a[f]);else if("string"===typeof a)e[a]=void 0!==b?b:null;else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof a&&(c=b);this.build(!c);return this};e.addQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);d.addQuery(e,a,void 0===b?null:b);this._parts.query=
d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof a&&(c=b);this.build(!c);return this};e.removeQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);d.removeQuery(e,a,b);this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof a&&(c=b);this.build(!c);return this};e.hasQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);
return d.hasQuery(e,a,b,c)};e.setSearch=e.setQuery;e.addSearch=e.addQuery;e.removeSearch=e.removeQuery;e.hasSearch=e.hasQuery;e.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()};e.normalizeProtocol=function(a){"string"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),
this.build(!a));return this};e.normalizeHostname=function(a){this._parts.hostname&&(this.is("IDN")&&f?this._parts.hostname=f.toASCII(this._parts.hostname):this.is("IPv6")&&n&&(this._parts.hostname=n.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a));return this};e.normalizePort=function(a){"string"===typeof this._parts.protocol&&this._parts.port===d.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a));return this};e.normalizePath=
function(a){if(this._parts.urn||!this._parts.path||"/"===this._parts.path)return this;var b,c=this._parts.path,e="",f,k;"/"!==c.charAt(0)&&(b=!0,c="/"+c);c=c.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");b&&(e=c.substring(1).match(/^(\.\.\/)+/)||"")&&(e=e[0]);for(;;){f=c.indexOf("/..");if(-1===f)break;else if(0===f){c=c.substring(3);continue}k=c.substring(0,f).lastIndexOf("/");-1===k&&(k=f);c=c.substring(0,k)+c.substring(f+3)}b&&this.is("relative")&&(c=e+c.substring(1));c=d.recodePath(c);
this._parts.path=c;this.build(!a);return this};e.normalizePathname=e.normalizePath;e.normalizeQuery=function(a){"string"===typeof this._parts.query&&(this._parts.query.length?this.query(d.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a));return this};e.normalizeFragment=function(a){this._parts.fragment||(this._parts.fragment=null,this.build(!a));return this};e.normalizeSearch=e.normalizeQuery;e.normalizeHash=e.normalizeFragment;e.iso8859=function(){var a=
d.encode,b=d.decode;d.encode=escape;d.decode=decodeURIComponent;this.normalize();d.encode=a;d.decode=b;return this};e.unicode=function(){var a=d.encode,b=d.decode;d.encode=A;d.decode=unescape;this.normalize();d.encode=a;d.decode=b;return this};e.readable=function(){var a=this.clone();a.username("").password("").normalize();var b="";a._parts.protocol&&(b+=a._parts.protocol+"://");a._parts.hostname&&(a.is("punycode")&&f?(b+=f.toUnicode(a._parts.hostname),a._parts.port&&(b+=":"+a._parts.port)):b+=a.host());
a._parts.hostname&&a._parts.path&&"/"!==a._parts.path.charAt(0)&&(b+="/");b+=a.path(!0);if(a._parts.query){for(var c="",e=0,k=a._parts.query.split("&"),g=k.length;e<g;e++){var h=(k[e]||"").split("="),c=c+("&"+d.decodeQuery(h[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"));void 0!==h[1]&&(c+="="+d.decodeQuery(h[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}b+="?"+c.substring(1)}return b+=d.decodeQuery(a.hash(),!0)};e.absoluteTo=function(a){var b=this.clone(),c=["protocol","username",
"password","hostname","port"],e,f;if(this._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");a instanceof d||(a=new d(a));b._parts.protocol||(b._parts.protocol=a._parts.protocol);if(this._parts.hostname)return b;for(e=0;f=c[e];e++)b._parts[f]=a._parts[f];b._parts.path?".."===b._parts.path.substring(-2)&&(b._parts.path+="/"):(b._parts.path=a._parts.path,b._parts.query||(b._parts.query=a._parts.query));"/"!==b.path().charAt(0)&&(a=a.directory(),b._parts.path=(a?
a+"/":"")+b._parts.path,b.normalizePath());b.build();return b};e.relativeTo=function(a){var b=this.clone().normalize(),c,e,f,k;if(b._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");a=(new d(a)).normalize();c=b._parts;e=a._parts;f=b.path();k=a.path();if("/"!==f.charAt(0))throw Error("URI is already relative");if("/"!==k.charAt(0))throw Error("Cannot calculate a URI relative to another relative URI");c.protocol===e.protocol&&(c.protocol=null);if(c.username===
e.username&&c.password===e.password&&null===c.protocol&&null===c.username&&null===c.password&&c.hostname===e.hostname&&c.port===e.port)c.hostname=null,c.port=null;else return b.build();if(f===k)return c.path="",b.build();a=d.commonPath(b.path(),a.path());if(!a)return b.build();e=e.path.substring(a.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");c.path=e+c.path.substring(a.length);return b.build()};e.equals=function(a){var b=this.clone();a=new d(a);var c={},e={},f={},k;b.normalize();a.normalize();
if(b.toString()===a.toString())return!0;c=b.query();e=a.query();b.query("");a.query("");if(b.toString()!==a.toString()||c.length!==e.length)return!1;c=d.parseQuery(c,this._parts.escapeQuerySpace);e=d.parseQuery(e,this._parts.escapeQuerySpace);for(k in c)if(q.call(c,k)){if(!r(c[k])){if(c[k]!==e[k])return!1}else if(!u(c[k],e[k]))return!1;f[k]=!0}for(k in e)if(q.call(e,k)&&!f[k])return!1;return!0};e.duplicateQueryParameters=function(a){this._parts.duplicateQueryParameters=!!a;return this};e.escapeQuerySpace=
function(a){this._parts.escapeQuerySpace=!!a;return this};return d});
(function(f,n){"object"===typeof exports?module.exports=n(require("./URI")):"function"===typeof define&&define.amd?define(["./URI"],n):f.URITemplate=n(f.URI,f)})(this,function(f,n){function g(d){if(g._cache[d])return g._cache[d];if(!(this instanceof g))return new g(d);this.expression=d;g._cache[d]=this;return this}function h(d){this.data=d;this.cache={}}var d=n&&n.URITemplate,m=Object.prototype.hasOwnProperty,w=g.prototype,r={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},
"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",
separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};g._cache={};g.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g;g.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/;g.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/;g.expand=function(d,f){var h=r[d.operator],m=h.named?"Named":"Unnamed",n=d.variables,e=[],q,p,s;for(s=0;p=n[s];s++)q=f.get(p.name),q.val.length?e.push(g["expand"+m](q,h,p.explode,p.explode&&h.separator||",",p.maxlength,p.name)):q.type&&e.push("");return e.length?h.prefix+e.join(h.separator):
""};g.expandNamed=function(d,g,h,m,n,e){var q="",p=g.encode;g=g.empty_name_separator;var s=!d[p].length,t=2===d.type?"":f[p](e),x,r,w;r=0;for(w=d.val.length;r<w;r++)n?(x=f[p](d.val[r][1].substring(0,n)),2===d.type&&(t=f[p](d.val[r][0].substring(0,n)))):s?(x=f[p](d.val[r][1]),2===d.type?(t=f[p](d.val[r][0]),d[p].push([t,x])):d[p].push([void 0,x])):(x=d[p][r][1],2===d.type&&(t=d[p][r][0])),q&&(q+=m),h?q+=t+(g||x?"=":"")+x:(r||(q+=f[p](e)+(g||x?"=":"")),2===d.type&&(q+=t+","),q+=x);return q};g.expandUnnamed=
function(d,g,h,n,m){var e="",q=g.encode;g=g.empty_name_separator;var p=!d[q].length,s,t,r,w;r=0;for(w=d.val.length;r<w;r++)m?t=f[q](d.val[r][1].substring(0,m)):p?(t=f[q](d.val[r][1]),d[q].push([2===d.type?f[q](d.val[r][0]):void 0,t])):t=d[q][r][1],e&&(e+=n),2===d.type&&(s=m?f[q](d.val[r][0].substring(0,m)):d[q][r][0],e+=s,e=h?e+(g||t?"=":""):e+","),e+=t;return e};g.noConflict=function(){n.URITemplate===g&&(n.URITemplate=d);return g};w.expand=function(d){var f="";this.parts&&this.parts.length||this.parse();
d instanceof h||(d=new h(d));for(var m=0,n=this.parts.length;m<n;m++)f+="string"===typeof this.parts[m]?this.parts[m]:g.expand(this.parts[m],d);return f};w.parse=function(){var d=this.expression,f=g.EXPRESSION_PATTERN,h=g.VARIABLE_PATTERN,m=g.VARIABLE_NAME_PATTERN,n=[],e=0,q,p,s;for(f.lastIndex=0;;){p=f.exec(d);if(null===p){n.push(d.substring(e));break}else n.push(d.substring(e,p.index)),e=p.index+p[0].length;if(!r[p[1]])throw Error('Unknown Operator "'+p[1]+'" in "'+p[0]+'"');if(!p[3])throw Error('Unclosed Expression "'+
p[0]+'"');q=p[2].split(",");for(var t=0,w=q.length;t<w;t++){s=q[t].match(h);if(null===s)throw Error('Invalid Variable "'+q[t]+'" in "'+p[0]+'"');if(s[1].match(m))throw Error('Invalid Variable Name "'+s[1]+'" in "'+p[0]+'"');q[t]={name:s[1],explode:!!s[3],maxlength:s[4]&&parseInt(s[4],10)}}if(!q.length)throw Error('Expression Missing Variable(s) "'+p[0]+'"');n.push({expression:p[0],operator:p[1],variables:q})}n.length||n.push(d);this.parts=n;return this};h.prototype.get=function(d){var f=this.data,
g={type:0,val:[],encode:[],encodeReserved:[]},h;if(void 0!==this.cache[d])return this.cache[d];this.cache[d]=g;f="[object Function]"===String(Object.prototype.toString.call(f))?f(d):"[object Function]"===String(Object.prototype.toString.call(f[d]))?f[d](d):f[d];if(void 0!==f&&null!==f)if("[object Array]"===String(Object.prototype.toString.call(f))){h=0;for(d=f.length;h<d;h++)void 0!==f[h]&&null!==f[h]&&g.val.push([void 0,String(f[h])]);g.val.length&&(g.type=3)}else if("[object Object]"===String(Object.prototype.toString.call(f))){for(h in f)m.call(f,
h)&&void 0!==f[h]&&null!==f[h]&&g.val.push([h,String(f[h])]);g.val.length&&(g.type=2)}else g.type=1,g.val.push([void 0,String(f)]);return g};f.expand=function(d,h){var m=(new g(d)).expand(h);return new f(m)};return g});

(function ($) {
var NS = ".sandwormformvalidation",
SUBMIT_EVENT = "submit" + NS;
function returnTrue() {
return true;
}
$.fn.addSandwormFormValidation = function (_opt) {
var options = $.extend({
onValidate: returnTrue,
onSubmit: returnTrue,
submit: "input[type=submit]",
inputs: "input[name],textarea[name],select[name]",
events: ["keyup", "click", "change"]
}, _opt),
$form = $(this),
validationEvents = $.map(options.events, function (event) { return event + NS; }).join(" "),
isLocked = false,
isValid = true,
$loader,
$message,
handler,
shouldPreventSubmit = function () {
return isLocked || !isValid;
},
syncUI = function () {
$(options.submit, $form).attr("disabled", shouldPreventSubmit());
},
setLock = function (shouldLock) {
isLocked = shouldLock;
syncUI();
},
getLock = function () {
return isLocked;
},
setMessage = function (type, message) {
var cb = type && message ? function () {
var isSuccess = "success" === type;
$message.
toggleClass("pvpnet-success", isSuccess).
toggleClass("pvpnet-error", !isSuccess).
html(message).
fadeIn(100);
} : $.noop;
$message.fadeOut(100, cb);
},
setLoading = function (isLoading) {
$loader[isLoading ? "show" : "hide"]();
},
checkValidity = function () {
var validity = true;
validity = validity && options.onValidate($form);
isValid = validity;
syncUI();
return isValid;
},
reset = function () {
setLoading(false);
setMessage();
$(options.inputs, $form).val("");
$(options.inputs, $form).change();
};
// remove existing validator if there is one
if ($form.data("validator")) {
$form.data("validator").detach();
}
$message = $("<p class=\"pvpnet-message\"></p>");
$message.hide().prependTo($form);
$loader = $("<div class='pvpnet-menu-loader'><div></div></div>");
$loader.hide();
$form.prepend($loader);
$form.on(validationEvents, options.inputs, checkValidity);
$form.on(SUBMIT_EVENT, function (e) {
checkValidity();
if (shouldPreventSubmit() || !options.onSubmit(e)) {
e.preventDefault();
}
});
handler = {
reset: reset,
setLoading: setLoading,
setMessage: setMessage,
setLock: setLock,
getLock: getLock,
shouldPreventSubmit: function () {
checkValidity();
return shouldPreventSubmit();
},
detach: function () {
isValid = true;
setLock(false);
reset();
setLoading = setMessage = setLock = checkValidity = shouldPreventSubmit = getLock = $.noop;
$message.remove();
$loader.remove();
$form.off(validationEvents, options.inputs);
$form.off(SUBMIT_EVENT);
$form.data("validator", null);
}
};
checkValidity();
$form.data("validator", handler);
return handler;
};
}(jQuery));
if (! ("JSON" in window && window.JSON)){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());

Riot.Sandworm = Riot.Sandworm || {};
(function(Riot, global) {
// Define sandworm cookies
var cookies = {
token:"PVPNET_TOKEN",
user:"PVPNET_ACCT",
lang:"PVPNET_LANG",
region:"PVPNET_REGION",
userid:"PVPNET_ID"
};
// Twig Methods
var twigs = {},
twigFuncReg = /{% (.+?) %}/,
twigFuncs = {
'include': function(id) {
return getTwig(id.substr(1, id.length-2), this.data);
},
'includeif': function(condition, id) {
if(this.data[condition]) {
return getTwig(id.substr(1, id.length-2), this.data);
}
return '';
}
};
function setTwig(id, twig) {
if(typeof twig === 'string') {
twigs[id] = twig;
}
else {
twigs[id] = twig.join('');
}
};
function getTwig(id, data) {
data = data || {};
var twig = twigs[id];
if (data) {
for (var key in data) {
if (data.hasOwnProperty(key)) {
twig = twig.replace(new RegExp('{{ ' + key + ' }}', 'g'), data[key]);
}
}
}
var twigMatch, twigSplit, twigResult,
context = {
id: id,
data: data,
twig: twig
};
while(twigMatch = twigFuncReg.exec(twig)) {
twigSplit = twigMatch[1].split(' ');
twigResult = twigFuncs[twigSplit.shift()].apply(context, twigSplit);
twig = twig.replace(twigMatch[0],twigResult);
}
return twig;
};
function formatLanguageCode(lang_code){
//are we in a aa-aa (case insensitive) format? switch to aa_AA (case sensitive with underscore
var lowercase_hyphen_expression = /([a-zA-Z]{2})[\-_]([a-zA-Z]{2})/;
if(lang_code.match(lowercase_hyphen_expression)){
var language_pieces = lowercase_hyphen_expression.exec(lang_code);
lang_code = language_pieces[1] + "_" + language_pieces[2].toUpperCase();
}else if(lang_code.length == 2){
lang_code = lang_code.toLowerCase();
}else {
lang_code = lang_code.substr(0,2).toLowerCase();
}
return lang_code;
};
function getAvailableLanguages() {
if ('pvpnet_localizations' in global && global.pvpnet_localizations.languages != undefined ){
return pvpnet_localizations.languages;
}
}
function getAvailableRegions() {
if ('pvpnet_localizations' in global && global.pvpnet_localizations.regions != undefined ){
return pvpnet_localizations.regions;
}
}
function getLanguageFromUrl(){
var path = window.location.pathname;
if (path === "/") { // no path
return null;
}
var pathPieces = path.split("/");
//pathPieces[0] is empty, as the first part of pathname includes /
var expectedLang = pathPieces[1];
var languages = getAvailableLanguages();
if( languages.hasOwnProperty(expectedLang) ){
return expectedLang;
}
return null;
};
var URIjs = URI.noConflict(true);
function getDomain(href) {
href = href || window.location.href;
var uri = new URIjs.URI(href);
return uri.domain();
}
function setLang(lang_code) {
var domain = getDomain();
var expire = new Date();
// Set expiration to 14 days
expire.setTime(new Date().getTime() + 1209600000);
var formattedLanguageCode = formatLanguageCode(lang_code);
if(formattedLanguageCode == false){
throw "Language code invalid " + formattedLanguageCode
}
var pvpnet_lang = formattedLanguageCode;
var lol_lang = formattedLanguageCode.substr(0,2);
Riot.setCookie("PVPNET_LANG", pvpnet_lang, {
expires:expire.toGMTString(),
path:'/',
domain:domain
});
// lang is used as the return value for getLang()
// setting the value here allows for Riot.Sandworm.setLang() and then Riot.Sandworm.getLang()
// to be called and return the expected value
lang_cookie = pvpnet_lang;
lang = pvpnet_lang;
};
function setRegion(newRegion) {
var expire = new Date(),
regions = sw_cfg.regions;
if ((!regions.hasOwnProperty(newRegion)) || regions[newRegion].unmanaged) {
// die silently if it's not a supported region
return;
}
// Set expiration to 14 days
expire.setTime(new Date().getTime() + 1209600000);
var domain = getDomain();
Riot.setCookie(cookies.region, newRegion,{
expires: expire,
path: "/",
domain: domain
});
//Set the object scoped region variable for Riot.Sandworm.getRegion
region = newRegion;
return region;
}
function getRegionFromUrl(){
var region_from_url = null;
var hostname_parts = window.location.hostname.split(".");
hostname_parts.splice(hostname_parts.length-2, 2);//get rid of the second and top level domains
var availableRegions = getAvailableRegions();
if(hostname_parts.length == 1 && hostname_parts[0] != "www"){
region_from_url = hostname_parts[0].toLowerCase();
}else if ( (hostname_parts.length == 2) && (/^[a-z]{2,4}$/g.test(hostname_parts[1]) ) ){
//here - we are assuming that we are following the pattern of <application>.<region>
region_from_url = hostname_parts[1].toLowerCase();
}
if(availableRegions && availableRegions.hasOwnProperty(region_from_url)){
return region_from_url;
} else {
return null;
}
}
function getRegionFromQueryParam() {
return getQueryParam("region");
}
// Get the region this app is set to use
var region = null;
// Look for the region cookie first
var region_from_cookie = Riot.getCookie(cookies.region);
//Also - get the region from the url
var region_from_url = getRegionFromUrl();
// Also - get the region from a query param
var regionFromQueryParam = getRegionFromQueryParam();
if(regionFromQueryParam) {
// If the user has specified a region in the query param then it
// takes precedence over regions in cookies and regions in other
// parts of the URL.
region = regionFromQueryParam;
setRegion(region);
} else if(!region_from_cookie) {
//Did we get a region from the URL?
if(region_from_url != null){
region = region_from_url;
setRegion(region);
}else{//Use the default
region = sw_cfg.default_region.toLowerCase();
}
}else if(region_from_url != null){
//if the region cookie was set - let's just double check that the region_from_url matches it
if(region_from_cookie.toLowerCase() !== region_from_url.toLowerCase()){
// decisions decisions...if the two disagree, for now let's just use the region_from_url and not mess w/ the cookie
region = region_from_url;
// set the cookie for requests
setRegion(region);
}else{
//If the two match - it matters little which one we set
region = region_from_cookie
}
}else{//if region_from_url is null, use the cookie value
region = region_from_cookie
}
function getQueryParam(name) { 
name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");  
var regexS = "[\\?&]"+name+"=([^&#]*)";  
var regex = new RegExp( regexS );  
var results = regex.exec( window.location.href );
if( results == null ) {
return null;
} else {
return results[1];
}
}
function getRegion(){
return region;
};
function isAccountProtectionEnabledForUser() {
var thisRegion = getRegion();
var accountProtectRegions = sw_cfg.account_protection_regions;
for(var i = 0; i < accountProtectRegions.length; i++) {
if(accountProtectRegions[i] === thisRegion) {
return true;
}
}
return false;
}
// Get the current language by reading out the cookie
var lang = null;
var lang_from_url = getLanguageFromUrl();
var lang_cookie = Riot.getCookie(cookies.lang);
if(lang_from_url && lang_from_url != null && lang_from_url != false) {
lang = lang_from_url;
} else if(lang_cookie && lang_cookie != null && lang_cookie != false ){
lang = lang_cookie;
} else if(sw_cfg.regions[region] && sw_cfg.regions[region]['default']){
lang = sw_cfg.regions[region]['default'];
setLang(lang);
}
if(lang === null) {
lang = sw_cfg.default_language;
setLang(lang);
}
function getLang () {
return lang;
};
function getAcceptablePath(path){
return path;
}
function isEmail (sEmail) {
// intentionally lax reg ex - essentially {something}@{something}.{something}
return sw_cfg.emailRegExp.test(sEmail);
}
function getSummonerName() {
var region = getRegion().toUpperCase(),
gas = Riot.getCookie(cookies.token + "_" + region),
user = Riot.getCookie(cookies.user + "_" + getRegion().toUpperCase());
return gas && user;
}
function getTLD(host) {
var location = host && host.split("."),
domain;
if(!location) {
return null;
}
if (location.length > 2) {
domain = "." + location.slice( location.length - 2 ).join(".");
}
else {
domain = "." + host
}
return domain;
}
function getHostnameFromUrl(url) {
var matches = url.match(/([a-z]+\:\/\/)?(.[^/:]+)/i);
return matches && matches[2];
}
function isForeignHost() {
var thisDomain = window.location.hostname,
sandwormDomain = getTLD(getHostnameFromUrl(sw_cfg.host)),
sandwormDomainRegex = new RegExp(sandwormDomain + '$');
return !sandwormDomainRegex.test(thisDomain);
}
// Expose
Riot.rebase(Riot.Sandworm, {
isEmail: isEmail,
URIjs: URIjs,
setTwig: setTwig,
getTwig: getTwig,
formatLanguageCode: formatLanguageCode,
getDomain: getDomain,
setLang: setLang,
getLang: getLang,
getLanguageFromUrl: getLanguageFromUrl,
getAvailableLanguages: getAvailableLanguages,
getAvailableRegions: getAvailableRegions,
getRegion: getRegion,
setRegion: setRegion,
getAcceptablePath: getAcceptablePath,
cookies: cookies,
isAccountProtectionEnabledForUser: isAccountProtectionEnabledForUser,
getSummonerName: getSummonerName,
isForeignHost: isForeignHost,
sw_cfg: sw_cfg
});
})(Riot, this);

!function(a){"use strict";function b(){return a.Performance&&a.performance instanceof a.Performance}function c(){return a.performance.now()}function d(){return(new Date).getTime()}function e(a){return l.call(a,0)}function f(){a.ga||!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga")}function g(a){return new h(a)}function h(){this.init.apply(this,arguments)}var i,j=a.Riot=a.Riot||{},k=0,l=Array.prototype.slice;h.prototype={init:function(b){var c="ga"+1*new Date+ ++k;f(),a.ga("create",b,{name:c}),this.name=c},time:function(a,b,c){var d=i(),e=this;return function(){e.send("timing",a.substr(0,150),b.substr(0,500),Math.round(i()-d),c.substr(0,500))}},call:function(){var b=e(arguments);-1===b[0].indexOf(".")&&(b[0]=this.name+"."+b[0]),a.ga.apply(null,b)},send:function(){var a=e(arguments);a.unshift("send"),this.call.apply(this,a)},getGA:function(){return a.ga},getName:function(){return this.name}},i=b()?c:d,h.create=g,j.Tracker=h}(window);(function (win) {
var Riot       = win.Riot = win.Riot || {},
Sandworm   = Riot.Sandworm = Riot.Sandworm || {},
ga_account = win.sw_cfg && win.sw_cfg.ga_account,
RiotTracker = Riot.Tracker.create(ga_account),
track = function () {
RiotTracker.call('set', 'dimension1', Riot.Sandworm.getRegion());
RiotTracker.send.apply(RiotTracker, arguments);
};
// returns the name of the ga() method
track.getGA = function () {
return RiotTracker.getGA();
};
// returns the name of the sandworm tracker
track.getName = function () {
return RiotTracker.getName();
};
track.time = function (timingCategory, timingVar, timingLabel) {
return RiotTracker.time(timingCategory, timingVar, timingLabel);
};
track.send = function() {
track.apply(null, arguments);
};
Sandworm.track = track;
}(window));
(function (win, $, undef) {
var Riot = win.Riot = win.Riot || {},
INIT_TIMEOUT = 15000; // seems long, we can back it down if necessary
Riot.Sandworm = Riot.Sandworm || {};
function Bridge(options) {
var observer,  // allow observer to by mocked
socket, // set to null so we only initialize when we make a call
self = this,
loc = win.location,
origin = loc.protocol + "//" + loc.hostname,
host = options.host,
remoteUrl = options.origin +
options.bridgePath + "#" +
origin + loc.pathname,
timeout = options.timeout || 1000,  // allow socket to by mocked
tracker = options.tracker,
userPromise;
function onBridgeMessage(message, messageOrigin) { // origin is passed as a second argument; unused for now
var response = JSON.parse(message),
data;
if (messageOrigin !== host) {
return;
}
if (response.data === undef) {
response.data = {};
}
// replace the "SERVICE_ERROR" with a translated message
data = response.data;
if (options.serviceError && "object" === typeof data.error) {
if (data.error.type === "timeout") {
data.error.response.error = options.serviceError;
} else if (data.error.type === "send" && data.error.response === "SERVICE_ERROR") {
data.error.response = options.serviceError;
}
}
self.getObserver().trigger(response.event, response.data);
}
function getSocket(config) {
return new win.easyXDM.Socket(config);
}
function getObserver() {
if (!observer) {
observer = new Riot.Observer();
}
return observer;
}
function createSocket() {
var initTimeout, initListener;
if (!socket) {
if (tracker) {
initListener = function () {
clearTimeout(initTimeout);
tracker("event", "sandworm", "init", "success");
self.getObserver().removeListener("init", initListener);
};
self.getObserver().addListener("init", initListener);
initTimeout = setTimeout(function () {
tracker("event", "sandworm", "init", "error");
}, Bridge.INIT_TIMEOUT);
}
socket = self.getSocket({
remote: remoteUrl,
onMessage: self.onMessage
});
}
return socket;
}
function makeRequest(message) {
createSocket().postMessage(JSON.stringify({
event: "send",
data: message
}));
}
// surface for unit testing
this.getObserver = getObserver;
this.getSocket = getSocket;
this.onMessage = onBridgeMessage;
this.markUserStale = function () {
userPromise = null;
return this;
};
this.getUser = function () {
if (!userPromise) {
userPromise = this.send({
type: "loaduser",
action: host + "/account/email-validate-state",
method: "GET"
});
}
return userPromise;
};
this.updateUser = function (newData) {
return this.getUser().pipe(function (oldData) {
return $.extend(oldData, newData);
});
},
this.reloadUser = function() {
this.markUserStale();
return this.getUser();
},
this.requestPasscode = function (type) {
return this.send({
type: "issue-passcode",
action: "/change/issue-passcode",
input: {
type: type
}
});
},
this.send = function (config) {
var successEvent = config.type + "-success",
errorEvent = config.type + "-error",
deferred = new $.Deferred(),
observer = self.getObserver(),
detach,
request,
getTimer,
// weird, but some existing code looks for data.success and data.error
// in the success logic, so we'll keep supporting that.
successHandler = function (data) {
if (data.error) {
deferred.reject(data);
} else {
deferred.resolve(data);
}
if (getTimer) { getTimer(); }
detach();
},
errorHandler = function (data) {
deferred.reject(data);
if (getTimer) { getTimer(); }
detach();
};
detach = function () {
observer.removeListener(successEvent, successHandler);
observer.removeListener(errorEvent, errorHandler);
};
if (tracker) {
deferred.always(function () {
var action = config.type,
label = "rejected" === deferred.state() ? "error" : "success";
tracker("event", "sandworm", action, label);
tracker("pageview", "/sandworm/" + action + "/" + label);
});
getTimer = tracker.time("sandworm", config.action, config.type);
}
observer.addListener(successEvent, successHandler);
observer.addListener(errorEvent, errorHandler);
request = {
type: config.type,
method: config.method || "POST",
// TODO: Refactor the host out of all our paths
action:  config.action,
timestamp: new Date().getTime(),
timeout: timeout,
input: config.input || {}
};
if(Riot.Sandworm.isForeignHost()) {
// Transfer cookies over to the Sandworm domain
// TODO: Seems unnecessary to do this on every send.. can't we just do it when we change cookie values
this.copyCookiesToLol([
Riot.Sandworm.cookies.region,
Riot.Sandworm.cookies.lang
]).then(function (data) {
makeRequest(request);
});
} else {
makeRequest(request);
}
return deferred.promise();
};
this.copyCookiesFromLol = function(cookieNames) {
var deferred = new $.Deferred();
this.getCookies(cookieNames).then(function(data) {
var cookies = data.cookies;
for (var cookieName in cookies) {
if(cookies.hasOwnProperty(cookieName)){
if(cookies[cookieName]) {
setCookie(cookieName, cookies[cookieName]);
} else {
deleteCookie(cookieName);
}
}
}
deferred.resolve(data);
})
return deferred.promise();
};
this.copyCookiesToLol = function(cookieNames) {
var cookies = {};
for(var i = 0; i < cookieNames.length; i++) {
cookies[cookieNames[i]] = getCookie(cookieNames[i]);
}
return this.setCookies(cookies);
}
this.setCookies = function(cookies) {
var deferred = new $.Deferred(),
observer = self.getObserver(),
successHandler;
successHandler = function(data) {
deferred.resolve(data);
detach();
};
function detach() {
observer.removeListener('set-cookies-result', successHandler);
}
observer.addListener('set-cookies-result', successHandler);
if(!socket) {
socket = self.getSocket({
remote: remoteUrl,
onMessage: self.onMessage
});
}
socket.postMessage(JSON.stringify({
event: "set-cookies",
data: {
cookies: cookies
}
}));
return deferred.promise();
}
this.getCookies = function(cookieNames) {
var deferred = new $.Deferred(),
observer = self.getObserver(),
successHandler;
successHandler = function(data) {
deferred.resolve(data);
detach();
};
function detach() {
observer.removeListener('get-cookies-result', successHandler);
}
observer.addListener('get-cookies-result', successHandler);
createSocket().postMessage(JSON.stringify({
event: "get-cookies",
data: {
cookieNames: cookieNames
}
}));
return deferred.promise();
};
}
function getCookie(name) {
return Riot.getCookie(name);
}
function setCookie(name, value) {
var expire = new Date();
// Set expiration to 14 days
expire.setTime(new Date().getTime() + 1209600000);
var domain = Riot.Sandworm.getDomain();
Riot.setCookie(name, value, {
expires: expire,
path: "/",
domain: domain
});
}
function deleteCookie(name) {
var expire = new Date();
// Set expiration in the past
expire.setTime(new Date().getTime() - 1209600000);
var domain = Riot.Sandworm.getDomain();
Riot.setCookie(name, '', {
expires: expire,
path: "/",
domain: domain
});
}
Bridge.INIT_TIMEOUT = INIT_TIMEOUT;
Riot.Sandworm.Bridge = Bridge;
}(window, jQuery));
Riot.cssPrepare("pvpnet","#pvpnet{font-size:120%;line-height:1.16667}#pvpnet *{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}#pvpnet h1,#pvpnet h2,#pvpnet h3,#pvpnet h4{font-family:inherit;color:inherit;font-weight:bold}html body #pvpnet p{margin:1em 0}html body #pvpnet p:last-child{margin-bottom:1em}html body #pvpnet p:first-child{margin-top:1em}#pvpnet{position:fixed;top:0px;left:0px;width:100%;font-family:Arial,Helvetica,Verdana,'Bitstream Vera Sans',sans-serif;font-size:10px;color:#585858;z-index:3000000;text-align:center}#pvpnet a,#pvpnet a:link,#pvpnet a:visited{color:#0096ff;text-decoration:none}#pvpnet a:hover,#pvpnet a:active{color:#FFFFFF;text-decoration:none}#pvpnet-bar{height:31px;border-bottom:1px solid #2b2b2b;background:url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) repeat-x 0px 0px #161616;-webkit-user-select:none;user-select:none}#pvpnet-bar-inner{max-width:1000px;min-width:604px;margin:0 auto;position:relative}#pvpnet-bar-logo{height:24px;width:162px;margin:0 15px 0 0;float:left}#pvpnet-bar-logo a{background:url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) 0px -400px no-repeat transparent;height:24px;width:162px;display:block;text-indent:-9999px;overflow:none;margin-top:3px}#pvpnet-bar .separator-text{padding:0 10px}#pvpnet-bar .pvpnet-bar-support-link{float:right}#pvpnet-bar .pvpnet-bar-account{float:right;margin-right:20px}#pvpnet-bar .pvpnet-bar-account a,#pvpnet-bar .pvpnet-bar-support-link a{color:#0096ff;background:url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) 0px -42px repeat-x;padding:0 10px;line-height:31px;height:31px;text-transform:uppercase;display:block;display:inline-block;text-decoration:none;border-left:1px solid #2B2B2B;border-right:1px solid #232323;border-right:1px solid rgba(35,35,35,0.7)}#pvpnet-bar .pvpnet-bar-account a{margin:0 5px}#pvpnet-bar .pvpnet-bar-account a:hover,#pvpnet-bar .pvpnet-bar-support-link a:hover{background-position:0px -84px;background-color:#424242;color:#fff;text-decoration:none}#pvpnet #pvpnet-bar-activator{float:left;height:31px;text-align:left;padding:0px 5px;padding-right:25px;padding:0px;text-transform:capitalize;margin-right:-200px;cursor:pointer;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-o-user-select:none;user-select:none}#pvpnet #pvpnet-bar-activator .pvpnet-bar-selected{line-height:31px;height:31px;padding:0 15px;float:left}#pvpnet #pvpnet-bar-activator .activator-region{text-transform:uppercase;color:#0096ff}#pvpnet #pvpnet-bar-activator:hover{color:#fff;text-decoration:none;background:url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) 0px -42px repeat-x transparent}#pvpnet #pvpnet-bar-activator .activator-button{float:left;height:31px;width:34px;background:url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) 0px -42px repeat-x transparent;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-o-user-select:none;user-select:none}#pvpnet #pvpnet-bar-activator .activator-button span{background:url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) no-repeat scroll 0px -592px transparent;display:block;height:31px;width:34px}#pvpnet.pvpnet-open #pvpnet-bar-activator .activator-button span{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg)}#pvpnet #pvpnet-bar-activator:hover .activator-button,#pvpnet #pvpnet-bar-activator .activator-button:hover{background-position:0 -82px;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-o-user-select:none;user-select:none}#pvpnet #pvpnet-bar-activator ul{font-weight:bold;border-left:1px solid #444444;border-right:1px solid #444444;border-bottom:1px solid #444444;color:#0096ff;position:absolute;top:32px;left:0;right:0;list-style:none;margin:0;padding:0;display:none;z-index:100}#pvpnet #pvpnet-bar-activator ul li a{color:#2267D1 !important;padding:6px 15px;display:block;border-bottom:1px solid #333333;background:rgba(0,0,0,0.75) none}#pvpnet #pvpnet-bar-activator ul li a:hover{background:rgba(0,0,0,0.9) none;text-decoration:none;color:white !important}#pvpnet #pvpnet-bar-activator ul li .active{color:#2e98fb !important}#pvpnet #pvpnet-bar #pvpnet-bar-region-selector{height:31px;left:380px;line-height:31px;padding:2px 25px 2px 5px;position:absolute;text-align:left;top:-2px}#pvpnet #pvpnet-bar .pvpnet-bar-region{margin-left:20px;color:#585858;text-transform:uppercase}#pvpnet #pvpnet-bar .pvpnet-bar-region a{color:#585858}#pvpnet #pvpnet-bar .pvpnet-bar-region a:hover{color:#585858;text-decoration:none}#pvpnet #pvpnet-regions{position:absolute;top:31px;left:0px;z-index:81;width:100%;text-align:left;box-shadow:0 4px 6px -2px rgba(0,0,0,0.5);display:none;background:#111111;background:-moz-linear-gradient(top, #111 0%, #282828 2%, #161616 60%);background:-webkit-gradient(linear, left top, left bottom, color-stop(0%, #111), color-stop(2%, #282828), color-stop(60%, #161616));background:-webkit-linear-gradient(top, #111 0%, #282828 2%, #161616 60%);background:-o-linear-gradient(top, #111 0%, #282828 2%, #161616 60%);background:-ms-linear-gradient(top, #111 0%, #282828 2%, #161616 60%);background:linear-gradient(to bottom, #111111 0%,#282828 2%,#161616 60%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#111111', endColorstr='#161616',GradientType=0 )}#pvpnet .pvpnet-dropdown-inner{max-width:1000px;margin:0 auto;position:relative;padding:15px 0 12px;min-height:130px;-webkit-user-select:none;user-select:none}#pvpnet #lol-pvpnet #lol-pvpnet-selection-list{position:relative}#pvpnet-region-selection-list,#pvpnet-region-selection-list ul,#pvpnet-region-selection-list li{list-style:none;margin:0px 0px 0px 0px;padding:0px}#pvpnet #pvpnet-region-selection-list{margin-left:-5px}#pvpnet #pvpnet-region-selection-list li.region{width:220px;margin:0 0 10px 25px;float:left}#pvpnet #pvpnet-region-selection-list li.region .region-name{display:table-cell;background:url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) no-repeat scroll 0px -553px transparent;font-size:14px;height:40px;line-height:16px;margin-bottom:5px;min-height:40px;padding-left:40px;text-align:left;vertical-align:middle}#pvpnet #pvpnet-region-selection-list li.region ul{background:#2D2D2D;padding:5px 0;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px}#pvpnet #pvpnet-region-selection-list li.language a{display:block;padding-left:40px;height:20px;line-height:20px;text-transform:uppercase;text-align:left}#pvpnet #pvpnet-region-selection-list li.selected-language a,#pvpnet #pvpnet-region-selection-list li.selected-language a:hover{background:url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) no-repeat scroll 0px -634px transparent;color:#888888}#pvpnet #pvpnet-region-selection-list li.language a:hover{background-color:#343434;color:#FFF}#pvpnet .clearall{clear:both}.sw-managesection-rendering{position:absolute;height:0 !important;overflow:hidden}.sw-changeemail-passcode{display:none}.sw-changeemail-requirespasscode .sw-changeemail-passcode{display:block}#pvpnet #account-management-container{width:800px;margin-left:-400px}#pvpnet #account-management-menu{display:table;width:750px;margin:20px 25px 25px}#pvpnet .account-input{width:150px}#pvpnet .account-column{display:table-cell}#pvpnet #account-management-left-column{width:270px;float:left;min-height:370px;background-color:#151515;position:relative}#pvpnet #account-management-left-column h4{text-transform:capitalize;padding-left:35px;line-height:30px;background:transparent url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) no-repeat 0px -667px;margin:0 0 5px 0;font-size:12px;font-weight:normal}#pvpnet #account-management-left-column h4.ma-refer-friend{background-position:0px -667px}#pvpnet #account-management-left-column h4.account-management-menu{background-position:0px -697px}#pvpnet #account-management-left-column h4.account-management-links{background-position:0px -730px}#pvpnet #account-management-left-column ul{margin:0px 0 10px 0;padding:0px;width:260px}#pvpnet #account-management-left-column ul li{list-style:none;display:block;height:20px;line-height:20px;padding-left:35px;text-align:left;color:#007ed7;font-size:10px}#pvpnet #account-management-left-column ul li a,#pvpnet #account-management-left-column ul li a:link,#pvpnet #account-management-left-column ul li a:visited{color:#007ed7;text-decoration:none}#pvpnet #account-management-left-column ul li:hover,#pvpnet #account-management-left-column ul li a:hover{color:#FFFFFF}#pvpnet #account-management-left-column ul.nav-menu li{text-transform:uppercase;background:#1e1e1e;height:23px;line-height:23px;cursor:pointer}#pvpnet #account-management-left-column ul.nav-menu li:hover{background-color:#252525}#pvpnet #account-management-left-column ul.nav-menu li.active{background:#323232;background:transparent url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) no-repeat 100% -865px;color:#FFFFFF;margin-right:-30px;width:245px;z-index:1041;position:relative}#pvpnet .pvpnet-modal-body{padding:20px 25px 25px}#pvpnet .pvpnet-modal-content,#pvpnet #account-management-right-column{background-color:#232323;padding:20px;font-size:12px;position:relative}#pvpnet #account-management-right-column{width:440px;margin:0px;margin-left:270px;margin-right:-750px;float:left;min-height:330px;box-sizing:content-box;-moz-box-sizing:content-box}#pvpnet #account-management-right-column .sandworm_panel{padding:0px;margin-left:auto;margin-right:auto;width:255px}#pvpnet #account-management-right-column .expanded.sandworm_panel{position:relative;width:442px;height:480px}#pvpnet #account-management-right-column .expanded.sandworm_panel .account-management-form{width:255px;margin-left:93px}#pvpnet #account-management-right-column .sandworm_panel .account-management-form{padding-top:30px}#pvpnet #account-management-right-column .sandworm_panel .email-validation-management-form{padding-top:30px}#pvpnet .pvpnet-modal-body .pvpnet-recover-password-form{padding-top:10px}#pvpnet .pvpnet-modal-body .pvpnet-recover-username-form{padding-top:10px}#pvpnet .pvpnet-modal-body .pvpnet-login-form{padding-top:10px}#pvpnet #account-management-right-column .sandworm_panel .accordian{height:24px;border:1px solid #373737;overflow:hidden;margin-bottom:-1px}#pvpnet #account-management-right-column .sandworm_panel .accordian.active{height:140px}#pvpnet #account-management-right-column .sandworm_panel .accordian .summoner_title{height:21px;padding:2px 6px;background:transparent url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) repeat-x 0px 0px;cursor:pointer;color:#FFF;font-size:1.1em}#pvpnet #account-management-right-column .sandworm_panel .accordian.active .summoner_title,#pvpnet #account-management-right-column .sandworm_panel .accordian.active .summoner_title:hover{background:transparent url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) repeat-x 0px -82px;cursor:default}#pvpnet #account-management-right-column .sandworm_panel .accordian .summoner_title:hover{background:transparent url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) repeat-x 0px -41px}#pvpnet #account-management-right-column .sandworm_panel .accordian .summoner_title .roman_num{min-width:20px;padding-right:7px}#pvpnet #account-management-right-column .sandworm_panel .accordian .summoner_piece{padding:1px}#pvpnet #account-management-right-column .sandworm_panel .accordian .summoner_piece .inner_text{padding:2px;height:110px;overflow:auto}#pvpnet #pvpnet-account-change-sca{position:absolute;bottom:0px;margin-bottom:0px}#pvpnet #account-management-right-column .summoners_code_description{padding:4px}#pvpnet .pvpnet-modal-container .form-text,#pvpnet .pvpnet-modal-container .form-password{-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;border:2px solid #AAA;padding:5px 8px;line-height:22px;height:22px;display:block;width:234px;margin:10px 0px 20px 0px;box-sizing:content-box;-moz-box-sizing:content-box}#pvpnet .pvpnet-modal-container label{color:#a0a0a0;font-weight:bold}#pvpnet .pvpnet-modal-container .form-text:focus,#pvpnet .pvpnet-modal-container .form-text:active,#pvpnet .pvpnet-modal-container .form-password:focus,#pvpnet .pvpnet-modal-container .form-password:active,#pvpnet .pvpnet-modal-container .form-cancel:active,#pvpnet .pvpnet-modal-container .form-cancel:focus{outline:none;-webkit-box-shadow:0 0 10px 3px rgba(0,126,215,0.9);-moz-box-shadow:0 0 10px 3px rgba(0,126,215,0.9);box-shadow:0 0 10px 3px rgba(0,126,215,0.9)}#pvpnet .pvpnet-modal-container strong{font-weight:bold;text-transform:uppercase}#pvpnet .sandworm_panel .pvpnet-modal-button .success_button{background:green;cursor:default;width:auto;padding-left:10px;padding-right:10px}#pvpnet .pvpnet-modal-container .form-cancel,#pvpnet .pvpnet-modal-container .form-submit,#pvpnet .pvpnet-modal-container input[type=submit]{background:transparent url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) no-repeat -1px -900px;border:none;height:35px;width:117px;padding:0;color:white;font-weight:bold;font-family:Arial, Helvetica, sans-serif;font-size:14px;text-shadow:-1px -1px 2px rgba(0,0,0,0.4);display:block;text-align:center;line-height:35px;float:left;margin:5px 20px 5px 0px;text-decoration:none;cursor:pointer;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px}#pvpnet .pvpnet-modal-container .form-cancel:hover,#pvpnet .pvpnet-modal-container .form-submit:hover,#pvpnet .pvpnet-modal-container input[type=submit]:hover{background-position:-1px -935px}#pvpnet .pvpnet-modal-container input[type=submit][disabled]{background-position:-118px -900px;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;color:#AAA;cursor:auto;opacity:0.5}#pvpnet .pvpnet-modal-container .form-cancel{background-position:-118px -900px;margin-right:0px;color:#FFFFFF;padding-right:0px}#pvpnet .pvpnet-modal-container .form-cancel:hover{background-position:-118px -935px}#pvpnet .pvpnet-form-links{text-align:center;margin:15px 0 5px}#pvpnet .pvpnet-form-links a{display:inline-block;padding:2px 10px;text-decoration:none}#pvpnet .pvpnet-success,#pvpnet .pvpnet-warning,#pvpnet .pvpnet-error{background:#090;color:white;padding:5px 5px;border-radius:3px}#pvpnet .pvpnet-warning{background:#B70}#pvpnet .pvpnet-error{background:#900}#pvpnet .pvpnet-message{width:245px}#pvpnet #pvpnet-password-recovery{position:relative;margin-left:auto}#pvpnet .pvpnet-modal-container{position:fixed;top:0px;left:50%;margin:80px auto 0;width:350px;margin-left:-175px;background-color:#151515;color:#a0a0a0;padding:0;font-family:Arial,Helvetica,Verdana,'Bitstream Vera Sans',sans-serif;text-align:left;border:1px solid #444444;z-index:1005;-webkit-border-radius:15px 15px 15px 15px;-moz-border-radius:15px 15px 15px 15px;border-radius:15px 15px 15px 15px;-webkit-box-shadow:0 0 20px rgba(200,200,200,0.2) inset,0px 0px 10px 5px rgba(0,0,0,0.5);-moz-box-shadow:0 0 20px rgba(200,200,200,0.2) inset,0px 0px 10px 5px rgba(0,0,0,0.5);box-shadow:0 0 20px rgba(200,200,200,0.2) inset,0px 0px 10px 5px rgba(0,0,0,0.5)}#pvpnet .pvpnet-modal-container.recaptcha{width:400px;margin-left:-200px}#pvpnet .pvpnet-modal-container.recaptcha form>div.clearfix{padding-left:25px}#pvpnet .pvpnet-modal-container.recaptcha form .recaptchatable input{background:none white;float:none;height:auto;line-height:normal;display:inline;border:solid 1px grey}#pvpnet .pvpnet-modal-container.recaptcha .pvpnet-modal-input{width:295px;box-sizing:content-box;-moz-box-sizing:content-box}#pvpnet .pvpnet-modal-container.recaptcha #recaptcha_privacy{float:none;padding-bottom:3px}#pvpnet .pvpnet-modal-header{text-align:center;border-bottom:1px solid #333;line-height:40px;height:40px;background-color:#151515;position:relative;-webkit-border-radius:15px 15px 0 0;-moz-border-radius:15px 15px 0 0;border-radius:15px 15px 0 0;-webkit-box-shadow:0px 20px 40px -20px rgba(200,200,200,0.2) inset,0px -10px 10px -5px rgba(0,0,0,0.3) inset,0px 8px 8px -3px rgba(0,0,0,0.5);-moz-box-shadow:0px 20px 40px -20px rgba(200,200,200,0.2) inset,0px -10px 10px -5px rgba(0,0,0,0.3) inset,0px 8px 8px -3px rgba(0,0,0,0.5);box-shadow:0px 20px 40px -20px rgba(200,200,200,0.2) inset,0px -10px 10px -5px rgba(0,0,0,0.3) inset,0px 8px 8px -3px rgba(0,0,0,0.5)}#pvpnet .pvpnet-modal-header h2{text-transform:uppercase;font-size:12px;margin:0px;font-weight:normal;color:#7b7b7b;font-family:Arial, Helvetica, Verdana, 'Bitstream Vera Sans', sans-serif;line-height:inherit}#pvpnet #account-management-container .pvpnet-modal-header h2{font-size:18px}#pvpnet .pvpnet-modal-header .pvpnet-modal-logo{height:24px;width:156px;position:absolute;top:7px;left:10px}#pvpnet #account-management-container .pvpnet-modal-header .pvpnet-modal-logo{background-position:0px -400px;height:24px;width:162px}#pvpnet .pvpnet-modal-header .pvpnet-modal-close{background:transparent url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) no-repeat -3px -764px;height:24px;width:24px;position:absolute;top:7px;right:10px;opacity:0.8}#pvpnet .pvpnet-modal-header .pvpnet-modal-close:hover{opacity:1.0}#pvpnet .clearfix:before,.clearfix:after{content:'';display:table}#pvpnet .clearfix:after{clear:both}#pvpnet .clearfix{zoom:1}#pvpnet .oldie .pvpnet-modal-container{padding:10px;background:transparent none 0 0;border:none;border-radius:none;box-shadow:none;width:366px;margin-left:-183px}#pvpnet .oldie #account-management-container{width:816px;margin-left:-408px}#pvpnet .oldie .pvpnet-modal-container .pvpnet-modal-header{padding:10px 10px 10px 10px;background:transparent url(https://account.leagueoflegends.com/bundles/riotsandworm/img/pvpnet-modal-small.png) no-repeat 50% 0px;border:none;border-radius:none;box-shadow:none}#pvpnet .oldie #account-management-container .pvpnet-modal-header{background-image:url(https://account.leagueoflegends.com/bundles/riotsandworm/img/pvpnet-modal-large.png);background-position-x:3px}#pvpnet .oldie .pvpnet-modal-container #account-management-menu,#pvpnet .oldie .pvpnet-modal-container .pvpnet-modal-body{margin:0px;padding:10px 35px 35px 35px;background:transparent url(https://account.leagueoflegends.com/bundles/riotsandworm/img/pvpnet-modal-small.png) no-repeat 50% 100%;border:none;border-radius:initial;box-shadow:none}#pvpnet .oldie #account-management-container #account-management-menu{background-image:url(https://account.leagueoflegends.com/bundles/riotsandworm/img/pvpnet-modal-large.png)}#pvpnet .oldie .pvpnet-modal-header .pvpnet-modal-logo{top:16px;left:25px}#pvpnet .oldie .pvpnet-modal-header .pvpnet-modal-close{top:15px;right:25px}#pvpnet.pvpnet-standalone{position:relative}#pvpnet.pvpnet-standalone .pvpnet-modal-container,#pvpnet.pvpnet-standalone #account-management-container{position:relative;top:auto;left:auto;margin-left:auto}#pvpnet .pvpnet-menu-loader{text-align:center}#pvpnet .pvpnet-menu-loader>div{margin:0 auto;width:32px;height:32px;background:url(https://account.leagueoflegends.com/bundles/riotsandworm/img/loader.gif) no-repeat}#pvpnet .pvpnet-form-invalid-auth{color:red;font-weight:bold}.sw-loading-modal-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1040;background-color:#232323;opacity:1;filter:alpha(opacity=100)}.sw-loading-modal-backdrop .try-again-wrapper{position:relative;width:100%}.sw-loading-modal-backdrop .try-again-wrapper a{position:relative;float:right;cursor:pointer}.sw-loading-modal{position:fixed;top:50%;left:50%;z-index:1050;overflow:auto;width:32px;margin:-16px 0 0 -16px}.sw-resend-passcode{line-height:45px;white-space:nowrap}.pvpnet-account-change-password form>div{position:relative}.pvpnet-account-change-password .tooltip-wrapper{position:absolute;display:none;top:6px;right:-220px;padding:1px 1px 1px 1px;height:160px;width:200px;color:black}.pvpnet-account-change-password .tooltip{border-radius:5px;padding:10px 10px 5px 10px;background:white}.pvpnet-account-change-password .pointer{position:absolute;left:-9px;background:white;top:20px}.pvpnet-account-change-password .pointer svg{position:absolute;display:inline-block;width:10px;height:20px}.pvpnet-account-change-password .strength-level{position:relative;height:10px;width:99%;border:1px solid;font-size:0px}.pvpnet-account-change-password .strength-level>div{display:inline-block;background-color:orange;height:100%;position:relative;width:25%}.pvpnet-account-change-password .tooltip ul{list-style:none;margin:0;padding:20px 0px 0px 0px;font-size:10px}.pvpnet-account-change-password .tooltip li{padding-left:20px;padding-bottom:10px}.pvpnet-account-change-password .password-strength label{color:inherit;position:relative;display:block;margin-bottom:5px}.pvpnet-account-change-password li.checked{background:transparent url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) no-repeat -10px -638px}.pvpnet-account-change-password>div{position:relative}#pvpnet .preload01{background:url(https://account.leagueoflegends.com/bundles/riotsandworm/img/loader-2.gif) no-repeat;width:32px;height:32px}#pvpnet .pvpnet-modal-button .preload01{float:left;margin-top:7px;display:none}");

(function (Riot, $) {
var Sandworm = Riot.Sandworm = Riot.Sandworm || {},
Section = Sandworm.Section = function (config) {
var observer = new Riot.Observer();
observer.injectOnto(this);
this.config = config || {};
};
$.extend(Section.prototype, {
_render: function () {},
l10n: {},
twigId: "",
render: function (container) {
var self = this,
content = $(Riot.Sandworm.getTwig(self.twigId, self.l10n));
content.addClass("sw-managesection-rendering");
content.appendTo(container);
self.content = content;
return $.when(self._render()).pipe(function () {
return self.hide();
}).pipe(function () {
content.removeClass("sw-managesection-rendering").find(".sw-managesection-state").hide();
return self;
});
},
_activate: function () {},
show: function () {
return $.when(this._activate(), this.content.fadeIn(100).promise());
},
_deactivate: function () {},
hide: function () {
var self = this;
return self.content.fadeOut(100).promise().pipe(function () {
return self._deactivate();
});
},
getState: function (id) {
var state = id || this.currentState;
return $(".sw-managesection-state-" + state, this.content)[0];
},
setState: function (newId) {
var oldState = this.getState(),
newState = this.getState(newId),
self = this;
if (oldState === newState) {
return;
}
return $.when($(oldState).fadeOut(100).promise()).
pipe(function () {
return $(newState).fadeIn(100).promise();
}).
pipe(function () {
self.currentState = newId;
return newId;
});
}
});
}(Riot, jQuery));

(function (Riot, $) {
var Sandworm = Riot.Sandworm = Riot.Sandworm || {};
Sandworm.ManageMenu = {
init: function () {
var config = this.config,
options = config.options,
// bridge = config.bridge,
// events = config.events,
sw_cfg = config.sw_cfg,
$pvpnet = config.$pvpnet;
this.track = config.tracker || $.noop;
// store all of the localization strings
this.l10n = $.extend({
my_account_header: options.localization.myaccount,
submit: options.localization.submit,
accept_code: options.localization.submit,
management_header: options.localization.management.header,
management_change_email: options.localization.management.change_email,
management_change_password: options.localization.management.change_password,
management_summoners_code_agreement: options.localization.management.summoners_code_agreement,
management_account_protection: options.localization.management.account_protection,
management_links_header: options.localization.management.links.header,
host: sw_cfg.host,
region: Riot.Sandworm.getRegion(),
short_language: Riot.Sandworm.getLang().substr(0,2),
links_tribunal: options.localization.management.links.tribunal,
links_refer_a_friend: options.localization.management.links.raf_program,
links_download: options.localization.management.links.download,
show_links: options.show_links,
account_protection_enabled: Riot.Sandworm.isAccountProtectionEnabledForUser(),
password_weak: options.localization.password_weak
}, options.localization.management);
this.contents = $(Riot.Sandworm.getTwig('management', this.l10n)).appendTo($pvpnet);
this.initialized = true;
if (!options.standalone) {
this._renderClose();
}
this._renderNav();
},
defaultSection: "change_email",
hideActiveSection: function () {
var id = this.activeTab;
return id && this.renderedTabs[id].hide();
},
showTabIfNext: function (id) {
var self = this,
tab;
// if another tab has been shown, don't show this one
if (id !== self.nextTab) {
return;
}
tab = self.renderedTabs[id];
self.activeTab = id;
self.nextTab = null;
self.track("pageview", "/sandworm/managementMenu/" + id);
// change the pointer
$('li[data-goto-ref="' + id + '"]').
addClass("active").
siblings(".active").
removeClass("active");
return tab.show();
},
showTab: function (id) {
var self = this;
if (id === self.activeTab || id === self.nextTab || !this.tabRenderers[id]) {
return;
}
self.nextTab = id;
return $.when(self.getTab(id)).
pipe(function () {
return self.hideActiveSection();
}).
// 
pipe(function () {
return self.showTabIfNext(id);
});
},
_show: function () {
this.showTab(this.defaultSection);
},
_hide: function () {
this.renderedTabs[this.activeTab].hide();
this.activeTab = null;
},
_renderNav: function () {
this.navContainer = $('#account-management-left-column', this.contents);
this.tabContainer = $('#account-management-right-column', this.contents);
this.navContainer.on("click", "li[data-goto-ref]", $.proxy(this._onNavClick, this));
},
_onNavClick: function (e) {
e.preventDefault();
this.showTab($(e.target).attr("data-goto-ref"));
},
getTab: function (id) {
var self = this,
renderFn = self.tabRenderers[id],
promise = new $.Deferred();
// if the tab is rendered, return it
if (self.renderedTabs[id]) {
promise.resolve(self.renderedTabs[id]);
// if not and we have a tab renderer
} else if (renderFn) {
// render then tab, then store it, then continue
$.when(self[renderFn]()).then(function (section) {
section.addListener("showTab", $.proxy(self.showTab, self));
self.renderedTabs[id] = section;
promise.resolve(section);
});
} else {
// we couldn't find the tab; return a failed promise
promise.reject();
}
return promise.promise();
},
activeTab: null,
renderedTabs: {},
tabRenderers: {
change_sca: "_renderSummonersCodeTab"
},
_renderSummonersCodeTab: function () {
var section = new Sandworm.Section();
$.extend(section, {
l10n: this.l10n
}, Sandworm.ManageMenu.SummonersCode);
return section.render(this.tabContainer);
},
_renderClose: function () {
$(".pvpnet-modal-header", this.contents).append(
$("<div class='pvpnet-modal-close'></div>")
.bind("click", $.proxy(this._onCloseClick, this))
);
},
_onCloseClick: function (e) {
e.preventDefault();
this.hide();
}
};
Sandworm.ManageMenu.SummonersCode = {
twigId: "management_change_sca",
_render: function () {
var tabContent = this.content,
animatingAccordian,
closedAccordianHeight,
$activeAccordian;
// The Summoner's Code Accordian
animatingAccordian = false;
closedAccordianHeight = tabContent.find('.accordian').height();
$activeAccordian = tabContent.find('.accordian:first').addClass('active');
tabContent.on('click', '.summoner_title', function (e) {
var $accordianClicked = $(this).parent();
e.preventDefault();
if(!$accordianClicked.hasClass('active') && !animatingAccordian) {
animatingAccordian = true;
var fullAccordianHeight = $activeAccordian.height();
$activeAccordian.find('.inner_text').css({overflow: 'hidden'});
$activeAccordian.animate({
height: closedAccordianHeight
}, 100);
$accordianClicked.find('.inner_text').css({overflow: 'auto'});
$accordianClicked.animate({
height: fullAccordianHeight
}, 100, function() {
$activeAccordian.removeClass('active');
$accordianClicked.addClass('active');
$activeAccordian = $accordianClicked;
animatingAccordian = false;
});
}
});
}
};
}(Riot, jQuery));

(function (Riot, $) {
var RegionsMenu = {
get: function get() {
if (!this.initialized) {
this.init();
}
return this.contents;
},
getLanguageHREF: function getLanguageHREF(config) {
var options = config.options;
var region_code = config.region_code;
var language_code = config.language_code;
var pathname = config.pathname;
var href = "";
// if the URL has been overridden, just return that
if (options.hasOwnProperty("dropdown_links") && options.dropdown_links.hasOwnProperty(region_code) && options.dropdown_links[region_code].hasOwnProperty(language_code)) {
return options.dropdown_links[region_code][language_code];
}
//Use the configured region's URL as the base href if it's set for this region
var region_config = options.regions.hasOwnProperty(region_code) && options.regions[region_code];
if (region_config.hasOwnProperty("homepage")) {
href = region_config.homepage;
// if that region is unmanaged, use that
if (region_config.unmanaged) {
return href;
}
}
// If we are wanting the language code in the path
if (options.language_in_path.enabled) {
var url_language_code = "";
//Check to see if the language code is one of the allowed long languages (using the full 5 character reference in the path)
url_language_code = options.language_in_path.long_languages.indexOf(language_code) > -1 ?
//If it's an allowed long-language, lowercase the value and replace underscores with hyphens
language_code.replace(/\_/,"-").toLowerCase() :
//If it's not an allowed long language - strip it down to 2 characters and lowercase the value
language_code.substr(0,2).toLowerCase();
// If this fluffed language is not listed as an excluded language, use it in the path
if (options.language_in_path.excluded_languages_in_path.indexOf(url_language_code) === -1 ){
href += "/";
href += url_language_code;
}
}
// if we want to append path data
if (options.append_path) {
// if there is a two-letter language code in the path already, remove it
if (options.language_in_path.enabled) {
pathname = pathname.replace(/^\/[a-z]{2}\//, "/");
}
href += pathname;
}
return href;
},
onLanguageClick: function onLanguageClick(e) {
// Set the language
var langCode = e.currentTarget.getAttribute("data-lang");
var destination_region = e.currentTarget.getAttribute("data-region");
var valid_region;
if(destination_region){
valid_region = Riot.Sandworm.setRegion(destination_region);
}
if (valid_region && langCode) {
Riot.Sandworm.setLang(langCode);
}
// Hide the menu
Riot.Sandworm.pvpnetMenus.toggle("regions", true);
},
init: function init() {
var config = this.config;
var options = config.options;
var $pvpnet = config.$pvpnet;
this.contents = $(Riot.Sandworm.getTwig("regions", {}))
.appendTo($pvpnet);
//Loop through each region
var i=0;
for (var region_code in options.regions) {
if (options.regions.hasOwnProperty(region_code)) {
//Prepare initial unordered list
var region_text = options.localization.regions[region_code];
var region = options.regions[region_code],
$languages_content = $("<ul>"),
$regions_content = $("<li class='region'><span class='region-name'>" + region_text + "</span></li>");
//Loop through each language within that region
i++;
for (var language_idx = 0; language_idx < region.languages.length; language_idx++) {
var language_code = region.languages[language_idx];
var language_href = this.getLanguageHREF({
options: options,
region_code: region_code,
language_code: language_code,
pathname: window.location.pathname
});
//And build out the list items for that region
//Here we look for the language text
var language_text;
if(options.localization.languages.hasOwnProperty(language_code)){
language_text = options.localization.languages[language_code];
}else if(language_code.length > 2 && options.localization.languages.hasOwnProperty(language_code.substr(0,2))){
//If we can't immediately find the language code,
// and the language code is more than 2 characters long (no need for regex match)
// make use of the 2 character code text
language_text = options.localization.languages[language_code.substr(0,2)];
}else{
//If all else fails, use the region text to avoid "undefined" showing up
language_text = region_text;
}
var language_content = Riot.Sandworm.getTwig("language-item", {
language_code:language_code,
region_code:region_code,
language_text:language_text,
language_href: language_href
});
//Append the list item to th overall languages content
$languages_content.append(language_content);
}
//Append the newly built language to the regions content and inject into this.contents
$regions_content.append($languages_content)
.appendTo($("#pvpnet-region-selection-list"));
}
}
$(".language a", this.contents).bind("click", this.onLanguageClick);
this.initialized = true;
},
show: function show() {
if (!this.active) {
Riot.Sandworm.track("pageview", "/sandworm/regionsMenu");
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().slideDown(200, function () {
Riot.Sandworm.pvpnetMenus.setAnimating(false);
});
this.active = true;
}
},
hide: function show() {
if (this.active) {
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().slideUp(200, function () {
Riot.Sandworm.pvpnetMenus.setAnimating(false);
});
this.active = false;
}
}
};
Riot.Sandworm.setTwig("regions", [
"<div id='pvpnet-regions'>",
"<div class='pvpnet-dropdown-inner'>",
"<div class='pvpnet-dropdown-bg'></div>",
"<ul id='pvpnet-region-selection-list'></ul>",
"<div class='clearall'></div>",
"</div>",
"</div>"
]);
Riot.Sandworm.setTwig("language-item", [
"<li class='language'>",
"<a href='{{ language_href }}' data-lang='{{ language_code }}' data-region='{{ region_code }}'>",
"{{ language_text }}",
"</a>",
"</li>"
]);
Riot.Sandworm.RegionsMenu = RegionsMenu;
}(Riot, jQuery));

(function ($) {
var Sandworm = Riot.Sandworm,
ManageMenu = Sandworm.ManageMenu,
twigId = "management_change_email",
renderFn = "_renderChangeEmailTab",
tabId = "change_email";
if (ManageMenu) {
ManageMenu.tabRenderers[tabId] = renderFn;
ManageMenu[renderFn] = function () {
var section = new Sandworm.Section();
$.extend(section, {
host: this.config.sw_cfg.host,
bridge: this.config.bridge,
l10n: this.l10n
}, Sandworm.ChangeEmail);
return section.render(this.tabContainer);
};
}
Sandworm.ChangeEmail = {
twigId: twigId,
onPasscodeSubmit: function (data, e) {
var $form = $(e.target),
promise = this.activePromise;
$("input[name]", $form).each(function () {
data[this.name] = $(this).val();
});
this.submitPasscodeEmailChange($form.data("validator"), data);
},
promptForPasscode: function (data) {
var self = this,
deferred = this.activePromise = new $.Deferred(),
$form = $("#pvpnet-account-change-email-passcode", this.content);
// update the text in the form
$(".sw-changeemail-message").text(data.message);
$(".sw-changeemail-to").text(data.to);
$form.addSandwormFormValidation({
onValidate: self.validatePasscode,
onSubmit: $.proxy(self.onPasscodeSubmit, self, data.input)
});
return deferred.promise();
},
validateEmailChange: function ($form) {
var email = $("input[name=email]", $form).val(),
confirm = $("input[name=email-confirm]", $form).val(),
password = $("input[name=email-password]", $form).val();
return Riot.Sandworm.isEmail(email) && (email === confirm) && password;
},
onEmailChangeSubmit: function (e) {
var $form = $(e.target),
input = {};
$("input[name]", $form).each(function () {
input[this.name] = $(this).val();
});
this.submitUnvalidatedEmailChange($form.data("validator"), input);
},
promptForEmailChange: function () {
// storing as self.activePromise allows us to do this multiple times
var self = this,
deferred = this.activePromise = new $.Deferred(),
$form = $("#pvpnet-account-change-email", this.content);
// if the validator doesn't exist, create it now
$form.addSandwormFormValidation({
onValidate: self.validateEmailChange,
onSubmit: $.proxy(self.onEmailChangeSubmit, self)
});
return deferred.promise();
},
submitUnvalidatedEmailChange: function (validity, input) {
var self = this;
validity.setLoading(true);
validity.setLock(true);
validity.setMessage(null);
return this.bridge.send({
type: "change-email",
// Post form data to URL included in form action attribute + the query params
// currently in the URL
action: self.host + "/update/email",
input: input
// if the request was successful, detach the validator and continue
}).pipe(function (data) {
var promise = self.activePromise;
self.activePromise = null;
validity.reset();
validity.detach();
data.input = input;
if (promise) {
promise.resolve(data);
}
return data;
// if not, start the process again
}, function (response) {
validity.setLoading(false);
validity.setLock(false);
validity.setMessage("error", response.error.response.error);
});
},
submitPasscodeEmailChange: function (validity, data) {
var self = this;
validity.setLoading(true);
validity.setLock(true);
validity.setMessage(null);
return self.bridge.send({
type: "change-email-passcode",
action: self.host + "/change/email",
input: data
}).pipe(function (result) {
var promise = self.activePromise;
self.activePromise = null;
validity.reset();
validity.detach();
if (promise) {
promise.resolve(result);
}
return result;
}, function (response) {
validity.setLoading(false);
validity.setLock(false);
validity.setMessage("error", response.error.response.error);
});
},
resendPasscode: function (validity) {
var self = this;
validity.setLoading(true);
validity.setLock(true);
validity.setMessage(null);
return this.bridge.send({
type: "resend-passcode",
action: this.host + "/change/issue-passcode",
input: { type: "email" }
}).pipe(function (response) {
validity.setLoading(false);
validity.setLock(false);
validity.setMessage("success", response.message + " " + response.to + self.l10n.PASSCODE_EXPIRY);
return response;
}, function (response) {
validity.setLoading(false);
validity.setLock(false);
validity.setMessage("error", response.error.response.error);
return response;
});
},
showSuccessMessaging: function (result) {
var successView = "success";
this.bridge.markUserStale();
if (result.verify) {
successView = "verify";
$('.sw-changeemail-to', this.content).text(result.to);
}
return this.setState(successView);
},
onVerifyEmailClick: function (e) {
e.preventDefault();
this.trigger("showTab", "change_acct_protection");
},
onResendPasscodeClick: function (e) {
var validity = $(e.target).closest("form").data("validator");
e.preventDefault();
// prevent multiple clicks from firing multiple requests
if (!validity.getLock()) {
this.resendPasscode(validity);
}
},
_render: function () {
if (Sandworm.isAccountProtectionEnabledForUser()) {
$(this.content).addClass('sw-changeemail-has-protection');
$('.sw-changepassword-success-verify', this.content).click($.proxy(this.onVerifyEmailClick, this));
$('.sw-resend-passcode', this.content).click($.proxy(this.onResendPasscodeClick, this));
}
},
_activate: function () {
var self = this;
return $.when(
self.promptForEmailChange(),
self.setState("changeemail")
).
pipe(function (result) {
// if we need a passcode, send the request for it first
return result["protected"] ?
$.when(
self.promptForPasscode(result),
self.setState("passcode")
) : result;
}).pipe(function (result) {
return self.showSuccessMessaging(result);
});
},
_deactivate: function () {
// remove all of the form validators that have been setup
$("form", this.content).each(function () {
var validator = $(this).data("validator");
if (validator) {
validator.reset();
validator.detach();
}
});
// detach the active promises if it has been set up
if (this.activePromise) {
this.activePromise.reject();
this.activePromise = null;
}
}
};
Riot.Sandworm.setTwig(twigId, [
"<div class='sandworm_panel'>",
"<form class='account-management-form sw-managesection-state sw-managesection-state-changeemail' id='pvpnet-account-change-email' data-state='changeemail' autocomplete='off' accept-charset='utf-8' onsubmit='return false;'>",
"<div>",
"<label for='pvpnet-account-email'>{{ new_email }}</label>",
"<input type='text' name='email' id='pvpnet-account-email' class='form-text' />",
"</div>",
"<div>",
"<label for='pvpnet-account-email-confirm'>{{ reenter_email }}</label>",
"<input type='text' name='email-confirm' id='pvpnet-account-email-confirm' class='form-text' />",
"</div>",
"<div>",
"<label for='pvpnet-account-email-password'>{{ enter_password }}</label>",
"<input type='password' name='email-password' id='pvpnet-account-email-password' class='form-password' />",
"</div>",
"<div class='pvpnet-modal-button'>",
"<input type='submit' value='{{ submit }}' />",
"</div>",
"</form>",
"<form class='account-management-form sw-managesection-state sw-managesection-state-passcode' id='pvpnet-account-change-email-passcode' data-state='passcode' autocomplete='off' accept-charset='utf-8' onsubmit='return false;'>",
"<h2>{{ change_email }}</h2>",
"<p>",
"<span class='sw-changeemail-message'></span>",
" <strong class='sw-changeemail-to'></strong>",
"{{ PASSCODE_EXPIRY }} ",
"</p>",
"<p>{{ ACCT_PROTN_ENTER_CODE_DESC_2 }}</p>",
"<div>",
"<label for='pvpnet-account-email-passcode'>{{ PASSCODE_LABEL }}</label>",
"<input type='password' name='passcode' id='pvpnet-account-email-passcode' class='form-text' />",
"</div>",
"<div class='pvpnet-modal-button'>",
"<input type='submit' value='{{ submit }}' /> ",
"<a class='sw-resend-passcode' href='#'>{{ ACCT_PROTN_RESEND_PASSCODE }}</a> ",
"</div>",
"</form>",
"<div class='sw-managesection-state sw-managesection-state-success' data-state='success'>",
"<h2>{{ change_email }}</h2>",
"<div class='pvpnet-message pvpnet-success'>{{ EMAIL_UPDATE_SUCCESS }}</div>",
"</div>",
"<div class='sw-managesection-state sw-managesection-state-verify' data-state='verify'>",
"<h2>{{ change_email }}</h2>",
"<p>",
"{{ ACCT_PROTN_VFY_EML_SEND_MSG }} ",
"<strong class='sw-changeemail-to'></strong>",
"</p>",
"<p>{{ ACCT_PROTN_VFY_EML_SEND_CALL_OUT }}</p>",
"</div>",
"</div>"
]);
}(jQuery));
(function ($) {
var Sandworm = Riot.Sandworm,
ManageMenu = Sandworm.ManageMenu,
twigId = "management_change_password",
renderFn = "_renderChangePasswordTab",
tabId = "change_password";
if (ManageMenu) {
ManageMenu.tabRenderers[tabId] = renderFn;
ManageMenu[renderFn] = function () {
var section = new Sandworm.Section();
$.extend(section, {
host: this.config.sw_cfg.host,
bridge: this.config.bridge,
l10n: this.l10n
}, Sandworm.ChangePassword);
return section.render(this.tabContainer);
};
}
Sandworm.ChangePassword = {
twigId: twigId,
onPwChangeValidate: function ($form) {
var newPw = $("input[name='password-new']", $form).val(),
len = newPw.length;
return len >= 8;
},
promptForPwChange: function () {
var self = this,
deferred = this.activePromise = new $.Deferred(),
$form = $(".pvpnet-account-change-password", this.content),
pwMeter = this.pwMeter,
validator = $form.addSandwormFormValidation({
// validation is handled by changePassword.js
onValidate: self.onPwChangeValidate,
onSubmit: function () {
var data = {};
if (!pwMeter.isStrongEnough()) {
validator.setMessage("error", self.l10n.password_weak);
return;
}
$("input[name]", $form).each(function () {
data[this.name] = $(this).val();
});
validator.setLoading(true);
validator.setLock(true);
validator.setMessage();
self.bridge.send({
type: "change-password",
action: self.host + "/update/password",
input: data
}).then(function (response) {
self.activePromise = null;
validator.reset();
validator.detach();
deferred.resolve({
data: data,
message: response.message,
passcodeRequired: response["protected"],
to: response.to
});
return response;
}, function (response) {
validator.setLoading(false);
validator.setLock(false);
validator.setMessage("error", response.error.response.error);
});
}
});
return deferred.promise();
},
showSuccessMessaging: function (message) {
$('.sw-changepassword-success', this.content).text(message);
},
promptForPasscode: function (result) {
var self = this,
$form = $('#pvpnet-account-change-password-passcode'),
deferred = this.activePromise = new $.Deferred(),
// set up the new form
validator = $form.addSandwormFormValidation({
onValidate: function () {
// just check if the field has a value
return $('input[name="passcode"]', $form).val();
},
onSubmit: function () {
var data = {};
// copy values from the previous form
$.each(result.data, function (name, value) {
data[name] = value;
});
// copy values from this form
$("input[name]", $form).each(function () {
data[this.name] = $(this).val();
});
validator.setLoading(true);
validator.setLock(true);
validator.setMessage();
self.bridge.send({
type: "change-password-passcode",
action: self.host + "/change/password",
input: data
}).then(function (response) {
self.activePromise = null;
validator.reset();
validator.detach();
deferred.resolve(response.message);
return response;
}, function (response) {
validator.setLoading(false);
validator.setLock(false);
validator.setMessage("error", response.error.response.error);
});
}
});
$('.sw-changepassword-message', this.content).text(result.message);
$('.sw-changepassword-to', this.content).text(result.to);
return deferred.promise();
},
resendPasscode: function (validity) {
var self = this;
validity.setLoading(true);
validity.setLock(true);
validity.setMessage(null);
return this.bridge.send({
type: "resend-passcode",
action: this.host + "/change/issue-passcode",
input: { type: "password" }
}).pipe(function (response) {
validity.setLoading(false);
validity.setLock(false);
validity.setMessage("success", response.message + " " + response.to + self.l10n.PASSCODE_EXPIRY);
return response;
}, function (response) {
validity.setLoading(false);
validity.setLock(false);
validity.setMessage("error", response.error.response.error);
return response;
});
},
onResendPasscodeClick: function (e) {
var validity = $(e.target).closest("form").data("validator");
e.preventDefault();
// prevent multiple clicks from firing multiple requests
if (!validity.getLock()) {
this.resendPasscode(validity);
}
},
_render: function () {
Riot.cssInject("strongpassword");
this.pwMeter = $(".sw-managesection-state-changepw input[name='password-new']").checkPasswordStrength();
if (Sandworm.isAccountProtectionEnabledForUser()) {
$('.sw-resend-passcode', this.content).click($.proxy(this.onResendPasscodeClick, this));
}
},
_activate: function () {
var self = this;
return $.when(
self.promptForPwChange(),
self.setState("changepw")
).pipe(function (result) {
return (result.passcodeRequired) ?
$.when(
self.promptForPasscode(result),
self.setState("passcode")
) : result.message;
}).pipe(function (message) {
return $.when(
self.showSuccessMessaging(message),
self.setState("success")
);
});
},
_deactivate: function () {
$("form", this.content).each(function () {
var v = $(this).data("validator");
if (v) {
v.reset();
v.detach();
}
});
if (this.activePromise) {
this.activePromise.reject();
this.activePromise = null;
}
}
};
Riot.Sandworm.setTwig(twigId, [
"<div id='sw-change-pw-tab' class='sandworm_panel change-pw-container'>",
"<form action='{{ host }}/update/password' method='post' class='account-management-form pvpnet-account-change-password sw-managesection-state sw-managesection-state-changepw' data-state='change-pw'' autocomplete='off' accept-charset='utf-8'>",
"<div>",
"<label for='pvpnet-account-password-old'>{{ current_password }}</label>",
"<input type='password' name='password-old' class='form-password pvpnet-account-password-old' />",
"</div>",
"<div>",
"<label for='pvpnet-account-password-new'>{{ new_password }}</label>",
"<input type='password' id='pvpnet-account-password-new' name='password-new' class='form-password pvpnet-account-password-new' maxlength='30' />",
"</div>",
"<div>",
"<label for='pvpnet-account-password-confirm'>{{ confirm_password }}</label>",
"<input type='password' name='password-confirm' class='form-password pvpnet-account-password-confirm' maxlength='30' />",
"</div>",
"<div class='pvpnet-modal-button'>",
"<input type='submit' value='{{ submit }}' />",
"</div>",
"</form>",
"<form action='{{ host }}/change/password' method='post' class='account-management-form sw-managesection-state sw-managesection-state-passcode' id='pvpnet-account-change-password-passcode' data-state='passcode' autocomplete='off' accept-charset='utf-8' onsubmit='return false;'>",
"<h2>{{ change_password }}</h2>",
"<p>",
"<span class='sw-changepassword-message'></span>",
" <strong class='sw-changepassword-to'></strong>",
"{{ PASSCODE_EXPIRY }} ",
"</p>",
"<p>",
"{{ ACCT_PROTN_ENTER_CODE_DESC_2 }}",
"</p>",
"<div>",
"<label for='pvpnet-account-password-passcode'>{{ PASSCODE_LABEL }}</label>",
"<input type='password' name='passcode' id='pvpnet-account-password-passcode' class='form-text' />",
"</div>",
"<div class='pvpnet-modal-button'>",
"<input type='submit' value='{{ submit }}' /> ",
"<a class='sw-resend-passcode' href='#'>{{ ACCT_PROTN_RESEND_PASSCODE }}</a> ",
"</div>",
"</form>",
"<div class='sw-managesection-state sw-managesection-state-success'>",
"<h2>{{ change_password }}</h2>",
"<div class='sw-changepassword-success pvpnet-message pvpnet-success'></div>",
"</div>",
"</div>"
]);
}(jQuery));

(function (Riot, $) {
var Sandworm = Riot.Sandworm,
tabId = "change_acct_protection",
renderer = "_renderAccountProtection",
twigId = "management-account-protection-tab",
ManageMenu = Sandworm.ManageMenu;
// Add Sandworm to the Manage menu
if (ManageMenu && Sandworm.isAccountProtectionEnabledForUser()) {
ManageMenu.defaultSection = tabId;
ManageMenu.tabRenderers[tabId] = renderer;
ManageMenu[renderer] = function () {
var section = new Sandworm.Section();
$.extend(section, {
twigId: twigId,
bridge: this.config.bridge,
l10n: this.l10n,
host: this.config.sw_cfg.host,
container: this
}, Sandworm.AccountProtection);
return section.render(this.tabContainer);
};
}
// methods & properties of the sandworm class
Sandworm.AccountProtection = {
twigId: twigId,
_render: function () {
var container = this.content,
ipAward = $('.sw-accountprotection-ipboost', container);
Riot.cssInject("pvpnet-accountprotection");
// Set up the initial state buttons once
// wire the change email button
$('.sw-accountprotection-changeemail', container).click($.proxy(this.onChangeEmailClick, this));
// wire the add SMS button
$(".sw-accountprotection-addsms-c2a .form-submit", container).click($.proxy(this._onAddSMSClick, this));
// wire the remove SMS button
$('.sw-accountprotection-changephone', container).click($.proxy(this._onRemoveSMSProtectionClick, this));
// wire the validate email button
$(".sw-accountprotection-c2a .form-submit", container).click($.proxy(this.onVerifyClick, this));
// wire the award tooltip
ipAward.hover(this.showToolTip, this.hideToolTip);
$(".sw-accountprotection-tooltip", ipAward).hide();            
},
_showErrorState: function (data) {
var message = data;
if ("object" === typeof message) {
message = message.error.response.error;
}
$('.sw-managesection-state-error .pvpnet-error', this.content).text(message);
this.setState('error');
},
_activate: function () {
var self = this;
return self.setState("loading").
pipe(function () {
return self.bridge.getUser();
}).
pipe(function (data) {
return self.syncUserState(data);
}, function (data) {
self._showErrorState(data);
}).
pipe(function () {
return self.setState("initialstate");
});
},
_deactivate: function () {
if (this._activePromise) {
this._activePromise.reject();
}
},
// call this when a promise is resolved by user action
_savePromise: function (promise) {
var self = this,
oldPromise = self._activePromise;
if (oldPromise && "pending" === oldPromise.state()) {
oldPromise.reject();
}
self._activePromise = promise;
promise.always(function () {
if (promise === self._activePromise) {
self._activePromise = null;
}
});
},
syncUserState: function (data) {
var container = this.content,
ipAward =  $('.sw-accountprotection-ipboost', container),
emailStatus = this.emailStatus = this._getStatus(data.email_status),
smsStatus = this.smsStatus = this._getStatus(data.sms_status);
// if we have state already, remove it
if (container.data("synced")) {
container.
removeClass("sw-accountprotection-emailstate-" + container.data("emailStatus")).
removeClass("sw-accountprotection-smsstate-" + container.data("smsStatus"));
}
// add classes to set up the state
container.
addClass("sw-accountprotection-emailstate-" + emailStatus).
addClass("sw-accountprotection-smsstate-" + smsStatus).
// store these statuses so we can update them later
data("emailStatus", emailStatus).
data("smsStatus", smsStatus).
data("synced", true);
// update text fields
$('.sw-accountprotection-obscuredphone', container).text(data.obscured_phone || "");
$('.sw-accountprotection-obscuredemail', container).text(data.obscured_email || "");
// hide or show the award
ipAward.toggle(data.eligible_for_award);
return data;
},
// ensure the unsent state is always the same no matter what the server
// sends.
_getStatus: function (status) {
return ("validated" === status || "token_generated" === status || "disabled" === status) ? status : "unsent";
},
showToolTip: function (e) {
$(".sw-accountprotection-tooltip", e.target).fadeIn();
},
hideToolTip: function (e) {
$(".sw-accountprotection-tooltip", e.target).fadeOut();
},
onChangeEmailClick: function (e) {
e.preventDefault();
this.trigger("showTab", "change_email");
},
onVerifyClick: function (e) {
var self = this,
bridge = self.bridge;
e.preventDefault();
this.setState("loading").
pipe(function () {
return bridge.send({
type: 'validate-email',
action: self.host + '/email/validate/issue-token'
});
}).
pipe(function () {
self.setState('validation');
}, function (data) {
self._showErrorState(data);
});
},
isValidPhone: function (n) {
// strip out all non-digit characters
var number = n.replace(/\D/g, '');
// US phone numbers
// return (/^1?[2-9][0-8]\d[2-9]\d{6}$/).test(number);
// TODO: This algorithm still isn't great
return number.length > 4 && number.length < 16;
},
promptForSMSNumber: function (response) {
var deferred = new $.Deferred(),
$form = $('.sw-managesection-state-entersmsnumber', this.content),
$phone = $('input[name=new-phone]', $form),
$passcode = $("input[name=passcode]", $form),
$countrySelector = $('select', $form).countrySelector();
self = this,
validation = $form.addSandwormFormValidation({
onValidate: function () {
return $countrySelector.val() && $passcode.val() && self.isValidPhone($phone.val());
},
onSubmit: function () {
var phone = "+" + $countrySelector.val() + $phone.val();
validation.setLock(true);
validation.setLoading(true);
validation.setMessage();
self.bridge.send({
type: "add-sms",
action: self.host + "/phone",
input: {
passcode: $passcode.val(),
"new-phone": phone
}
}).then(function (data) {
$countrySelector.data("countryselector").destroy();
validation.detach();
deferred.resolve(data);
}, function (data) {
validation.setLoading(false);
validation.setMessage("error", data.error.response.error);
$form.one("keyup", function () {
validation.setLock(false);
});
});
}
});
// if the promise is rejected, clean up
deferred.fail(function () {
$countrySelector.data("countryselector").destroy();
validation.detach();
});
$('.sw-accountprotection-addsms-message', this.content).text(response.message);
$('.sw-accountprotection-addsms-email', this.content).text(response.to);
this._savePromise(deferred);
return deferred.promise();
},
promptToEnterCode: function (response) {
var deferred = new $.Deferred(),
self = this,
$form = $('.sw-managesection-state-entersmscode', this.content),
$input = $('input[name=code]'),
validation = $form.addSandwormFormValidation({
onValidate: function () {
// TODO: Better validation here
return $input.val();
},
onSubmit: function () {
validation.setLock(true);
validation.setLoading(true);
validation.setMessage();
self.bridge.send({
type: "validate-sms",
action: self.host + "/phone/validate",
input: {
passcode: $input.val()
}
}).then(function (data) {
validation.detach();
deferred.resolve(data);
}, function (data) {
validation.setLoading(false);
validation.setMessage("error", data.error.response.error);
$form.one("keyup", function () {
validation.setLock(false);
});
});
}
});
// Update UI with correct messaging
$('.sw-accountprotection-entersmscode-message', this.content).text(response.message);
$('.sw-accountprotection-entersmscode-obscuredphone', this.content).text(response.to);
this._savePromise(deferred);
return deferred.promise();
},
removeSMSProtection: function (response) {
var deferred = new $.Deferred(),
self = this,
$form = $('.sw-managesection-state-entersmscode', this.content),
$input = $('input[name=code]'),
validation = $form.addSandwormFormValidation({
onValidate: function () {
// TODO: Better validation here
return $input.val();
},
onSubmit: function () {
validation.setLock(true);
validation.setLoading(true);
validation.setMessage();
self.bridge.send({
type: "remove-sms",
action: self.host + "/phone?passcode=" + $input.val(),
method: "DELETE"
}).then(function () {
validation.detach();
deferred.resolve();
}, function (data) {
validation.setLoading(false);
validation.setMessage("error", data.error.response.error);
$form.one("keyup", function () {
validation.setLock(false);
});
});
}
});
// Update UI with correct messaging
$('.sw-accountprotection-entersmscode-message', this.content).text(response.message);
$('.sw-accountprotection-entersmscode-obscuredphone', this.content).text(response.to);
this._savePromise(deferred);
return deferred.promise();
},
getCountrySelector: function () {
if (Sandworm.CountrySelector) {
return Sandworm.CountrySelector;
}
this._loadCountriesPromise = this._loadCountriesPromise || $.ajax({
dataType: "script",
cache: true,
url: this.host + "/countries." + Sandworm.getLang() + ".js"
}).pipe(function () {
return Sandworm.CountrySelector;
});
return this._loadCountriesPromise;
},
_onAddSMSClick: function (e) {
var self = this;
e.preventDefault();
self.setState("loading").
pipe(function () {
return $.when(
self.bridge.requestPasscode("sms"),
self.getCountrySelector()
);
}).
pipe(function (response) {
return $.when(
self.promptForSMSNumber(response),
self.setState("entersmsnumber")
);
}, function (data) {
self._showErrorState(data);
}).pipe(function (response) {
return $.when(
self.promptToEnterCode(response),
self.setState("entersmscode")                        
);
}).pipe(function () {
// Reload the user state from the server
return self.setState("loading");
}).pipe(function () {
return self.bridge.reloadUser();
}).then(function (data) {
// Sync data from server with the UI and take us back to the home screen
self.syncUserState(data);
self.setState("initialstate");
}, function (data) {
self._showErrorState(data);
});
},
_onRemoveSMSProtectionClick: function (e) {
var self = this;
e.preventDefault();
self.setState("loading").
pipe(function () {
return self.bridge.requestPasscode("sms")
}).
pipe(function (data) {
// Pass the response data from requestPasscode through to removeSmsProtection
return $.when(
self.removeSMSProtection(data),
self.setState("entersmscode")                        
);
}, function (data) {
self._showErrorState(data);
}).pipe(function () {
// Update the cached user state
return self.bridge.updateUser({
obscured_phone: "",
sms_status: "not_validated"
});
}).then(function (state) {
self.syncUserState(state);
self.setState("initialstate");
}, function (data) {
self._showErrorState(data);
});
}
};
// TODO: Move twig to static file
Sandworm.setTwig(twigId, [
"<div id='sw-accountprotection' class='sandworm_panel'>",
"<div class='sw-managesection-state sw-managesection-state-loading' data-state='loading'>",
"{% include 'pvpnetMenuLoader' %}",
"</div>",
"<div class='sw-managesection-state sw-managesection-state-initialstate' data-state='initialstate'>",
"<div class='sw-accountprotection-validateemail-unvalidated'>",
"<h2>",
"{{ ACCT_PROTN_VFY_EML_LBL }} ",
"<span class='sw-accountprotection-ipboost'>",
"<span class='sw-accountprotection-tooltip'>{{ ACCT_PROTN_IP_BOOST_TXT }}</span>",
"</span>",
"<span class='sw-accountprotection-icon sw-accountprotection-icon-unvalidated'></span>",
"</h2>",
"<p>",
"<em class='sw-accountprotection-obscuredemail'></em> ",
"[<a class='sw-accountprotection-changeemail' href='#'>{{ ACCT_PROTN_EML_CHG }}</a>]",
"</p>",
"<div class='sw-accountprotection-c2a'>",
"{{ ACCT_PROTN_VFY_EML_C2A_DESC }}",
"<p>",
"<a class='form-submit' href='#'>",
"<span class='sw-accountprotection-c2a-verify'>{{ ACCT_PROTN_VFY_EML_SEND_TXT }}</span>",
"<span class='sw-accountprotection-c2a-resend'>{{ ACCT_PROTN_VFY_EML_RESEND_TXT }}</span>",
"</a>",
"</p>",
"</div>",
"</div>",
"<div class='sw-accountprotection-validateemail-validated'>",
"<h2>",
"{{ ACCT_PROTN_VFY_DONE_EML_LBL }}",
"<span class='sw-accountprotection-icon sw-accountprotection-icon-validated'></span>",
"</h2>",
"<p>",
"<em class='sw-accountprotection-obscuredemail'></em> ",
"[<a class='sw-accountprotection-changeemail' href='#'>{{ ACCT_PROTN_EML_CHG }}</a>]",
"</p>",
"<div class='sw-accountprotection-success'>",
"<p>",
"{{ ACCT_PROTN_VERIFY_SUCCESS_DESC }} ",
"<strong class='sw-accountprotection-email'></strong>",
"</p>",
"</div>",
"</div>",
"<div class='sw-accountprotection-addsms'>",
"<h2>",
"<span class='sw-accountprotection-addsms-title-unvalidated'>{{ ACCT_PROTN_ADD_SMS_LBL }}</span> ",
"<span class='sw-accountprotection-addsms-title-validated'>{{ ACCT_PROTN_ADDED_SMS_LBL }}</span> ",
"<span class='sw-accountprotection-icon sw-accountprotection-icon-validated'></span>",
"<span class='sw-accountprotection-icon sw-accountprotection-icon-unvalidated'></span>",
"</h2>",
"<p class='sw-accountprotection-requiresemail'>{{ ACCT_PROTN_ADD_SMS_REQ }}</p>",
"<div class='sw-accountprotection-addsms-success'>",
"<p>",
"<em class='sw-accountprotection-obscuredphone'></em> ",
"[<a class='sw-accountprotection-changephone' href='#'>{{ ACCT_PROTN_PHONE_CHG }}</a>]",
"</p>",
"<p>",
"{{ ACCT_PROTN_ADD_SMS_SUCCESS_DESC }} ",
"</p>",
"</div>",
"<div class='sw-accountprotection-addsms-c2a'>",
"<div class='sw-accountprotection-icon sw-accountprotection-icon-sms'></div>",
"{{ ACCT_PROTN_ADD_SMS_DESC }}",
"<p>",
"<a class='form-submit' href='{{ host }}/add-sms'>",
"<span class='sw-accountprotection-c2a-verify'>{{ ACCT_PROTN_ADD_SMS_C2A }}</span>",
"</a>",
"</p>",
"</div>",
"<div class='sw-accountprotection-addsms-disclaimer'>{{ ACCT_PROTN_ADD_SMS_DISCL }}</div>",
"</div>",
"</div>",
"<div class='sw-managesection-state sw-managesection-state-validation' data-state='validation'>",
"<h2>{{ account_protection }}</h2>",
"<p>{{ ACCT_PROTN_VFY_EML_SEND_MSG }}</p>",
"<p><em class='sw-accountprotection-obscuredemail'></em></p>",
"<p>{{ ACCT_PROTN_VFY_EML_SEND_CALL_OUT }}</p>",
"</div>",
"<div class='sw-managesection-state sw-managesection-state-error' data-state='pvpnet-error'>",
"<h2>{{ account_protection }}</h2>",
"<p class='pvpnet-message pvpnet-error'></p>",
"</div>",
"<form action='#' class='sw-managesection-state sw-managesection-state-entersmsnumber' data-state='entersmsnumber' onsubmit='return false;'>",
"<h2>{{ ACCT_PROTN_VERIFY_PHONE_TITLE }}</h2>",
"<p>",
"<span class='sw-accountprotection-addsms-message'></span> ",
"<strong class='sw-accountprotection-addsms-email'></strong>",
"{{ PASSCODE_EXPIRY }}",
"</p>",
"<p><label for='pvpnet-accountprotection-entersmsnumber-passcode'>{{ PASSCODE_LABEL }}</label></p>",
"<p><input id='pvpnet-accountprotection-entersmsnumber-passcode' required type='text' name='passcode' class='form-text'></p>",
"<p><label for='pvpnet-accountprotection-entersmsnumber-country'>{{ COUNTRY_LABEL }}</label></p>",
"<p><select id='pvpnet-accountprotection-entersmsnumber-country' name='country' data-placeholder='{{ COUNTRY_PLACEHOLDER }}'></select></p>",
"<p><label for='pvpnet-accountprotection-entersmsnumber-enterphone'>{{ ACCT_PROTN_VERIFY_PHONE_DESC_1 }}</label></p>",
"<p><input id='pvpnet-accountprotection-entersmsnumber-enterphone' required type='text' name='new-phone' class='form-text'></p>",
"<p>{{ ACCT_PROTN_VERIFY_PHONE_DESC_2 }}</p>",
"<p>",
"<input type='submit' value='{{ ACCT_PROTN_VFY_EML_SEND_TXT }}' />",
// "<input class='sw-accountprotection-c2a-resend' type='submit' value='{{ ACCT_PROTN_VFY_EML_RESEND_TXT }}' />",
"<a class='form-cancel sw-accountprotection-addsms-remove' href='#'>{{ ACCT_PROTN_PHONE_CHG }}</a>",
"</p>",
"</form>",
"<form action='#' class='sw-managesection-state sw-managesection-state-entersmscode' data-state='entersmscode' onsubmit='return false;'>",
"<h2>{{ ACCT_PROTN_ENTER_CODE_TITLE }}</h2>",
"<p><label for='pvpnet-accountprotection-entercode'>",
"<span class='sw-accountprotection-entersmscode-message'></span> ",
"<strong class='sw-accountprotection-entersmscode-obscuredphone'></strong>",
"{{ PASSCODE_EXPIRY }}",
"</p>",
"<p>{{ ACCT_PROTN_ENTER_CODE_DESC_2 }}</label></p>",
"<p><input id='pvpnet-accountprotection-entercode' required type='text' name='code' class='form-text'></p>",
// "<p>{{ ACCT_PROTN_ENTER_CODE_DESC_3 }}</p>",
"<p>",
"<input class='sw-accountprotection-c2a-verify' type='submit' value='{{ ACCT_PROTN_VFY_EML_SEND_TXT }}' />",
// "<input class='sw-accountprotection-c2a-resend' type='submit' value='{{ ACCT_PROTN_VFY_EML_RESEND_TXT }}' />",
"</p>",
"</form>",
"</div>"
]);
}(Riot, jQuery));
Riot.cssPrepare("pvpnet-accountprotection","#sw-accountprotection{width:350px !important}#sw-accountprotection h2{border-bottom:1px solid #585858;position:relative;line-height:1.5;font-size:200%}#sw-accountprotection em{font-weight:bold;font-style:normal}#sw-accountprotection .form-submit{float:none !important;margin:2em 0 !important}.sw-accountprotection-icon{position:absolute;right:105%;top:0.3em;width:27px;background-image:url('https://account.leagueoflegends.com/bundles/riotsandworm/img/pvpnet-sprite-v3.png');display:none}.sw-accountprotection-icon-validated{background-position:-350px -680px;height:27px}.sw-accountprotection-icon-unvalidated{background-position:-350px -550px;height:27px}.sw-accountprotection-icon-sms{background-position:-346px -500px;height:41px}.sw-accountprotection-emailstate-validated .sw-accountprotection-validateemail-validated{display:block}.sw-accountprotection-emailstate-validated .sw-accountprotection-validateemail-validated .sw-accountprotection-icon-validated{display:block}.sw-accountprotection-emailstate-validated .sw-accountprotection-addsms .sw-accountprotection-icon-unvalidated{display:block}.sw-accountprotection-emailstate-validated .sw-accountprotection-requiresemail,.sw-accountprotection-emailstate-validated .sw-accountprotection-ipboost,.sw-accountprotection-emailstate-validated .sw-accountprotection-c2a,.sw-accountprotection-emailstate-validated .sw-accountprotection-validateemail-unvalidated{display:none}.sw-accountprotection-validateemail-unvalidated{display:none}.sw-accountprotection-validateemail-validated{display:none}.sw-accountprotection-note-success{font-weight:bold;color:#1ac505}.sw-accountprotection-emailstate-token_generated .sw-accountprotection-addsms,.sw-accountprotection-emailstate-unsent .sw-accountprotection-addsms{opacity:0.3}.sw-accountprotection-emailstate-token_generated .sw-accountprotection-addsms .form-submit,.sw-accountprotection-emailstate-unsent .sw-accountprotection-addsms .form-submit{display:none !important}.sw-accountprotection-emailstate-token_generated .sw-accountprotection-validateemail-unvalidated,.sw-accountprotection-emailstate-unsent .sw-accountprotection-validateemail-unvalidated{display:block}.sw-accountprotection-emailstate-token_generated .sw-accountprotection-validateemail-unvalidated .sw-accountprotection-icon-unvalidated,.sw-accountprotection-emailstate-unsent .sw-accountprotection-validateemail-unvalidated .sw-accountprotection-icon-unvalidated{display:block}.sw-accountprotection-emailstate-token_generated .sw-accountprotection-addsms h2 .sw-accountprotection-icon-unvalidated,.sw-accountprotection-emailstate-unsent .sw-accountprotection-addsms h2 .sw-accountprotection-icon-unvalidated{display:block}.sw-accountprotection-emailstate-token_generated .sw-accountprotection-addsms-disclaimer,.sw-accountprotection-emailstate-token_generated .sw-accountprotection-addsms-c2a,.sw-accountprotection-emailstate-token_generated .sw-accountprotection-icon-validated,.sw-accountprotection-emailstate-token_generated .sw-accountprotection-success .sw-accountprotection-validateemail-validated,.sw-accountprotection-emailstate-unsent .sw-accountprotection-addsms-disclaimer,.sw-accountprotection-emailstate-unsent .sw-accountprotection-addsms-c2a,.sw-accountprotection-emailstate-unsent .sw-accountprotection-icon-validated,.sw-accountprotection-emailstate-unsent .sw-accountprotection-success .sw-accountprotection-validateemail-validated{display:none}.sw-accountprotection-addsms-title-validated{display:none}.sw-accountprotection-addsms-remove,.sw-accountprotection-addsms-success{display:none !important}.sw-accountprotection-smsstate-validated .sw-accountprotection-addsms-remove,.sw-accountprotection-smsstate-validated .sw-accountprotection-addsms-success{display:block !important}.sw-accountprotection-smsstate-validated .sw-accountprotection-success,.sw-accountprotection-smsstate-validated .sw-accountprotection-addsms-c2a{display:none}.sw-accountprotection-smsstate-validated .sw-accountprotection-addsms h2 .sw-accountprotection-icon-unvalidated,.sw-accountprotection-smsstate-validated .sw-accountprotection-addsms h2 .sw-accountprotection-addsms-title-unvalidated{display:none}.sw-accountprotection-smsstate-validated .sw-accountprotection-addsms h2 .sw-accountprotection-icon-validated,.sw-accountprotection-smsstate-validated .sw-accountprotection-addsms h2 .sw-accountprotection-addsms-title-validated{display:block}.sw-accountprotection-smsstate-unsent .sw-accountprotection-addsms-c2a{display:block;position:relative}.sw-accountprotection-smsstate-unsent .sw-accountprotection-addsms-c2a .sw-accountprotection-icon-sms{display:block;top:0px;left:-3px}.sw-accountprotection-smsstate-unsent ul{padding-left:54px}.sw-accountprotection-smsstate-disabled .sw-accountprotection-addsms{display:none}.sw-accountprotection-ipboost{background-image:url('https://account.leagueoflegends.com/bundles/riotsandworm/img/pvpnet-sprite-v3.png');background-position:-350px -599px;width:23px;height:24px;display:inline-block;position:relative;vertical-align:text-top}.sw-accountprotection-tooltip{color:#1ac505;background:#0d3b04;font-size:37.5%;font-weight:normal;position:absolute;left:0;top:125%;padding:0.5em;-webkit-border-radius:0.5em;-moz-border-radius:0.5em;-ms-border-radius:0.5em;-o-border-radius:0.5em;border-radius:0.5em;-webkit-box-shadow:0 0 0.5em rgba(0,0,0,0.3);-moz-box-shadow:0 0 0.5em rgba(0,0,0,0.3);box-shadow:0 0 0.5em rgba(0,0,0,0.3);width:20em}.sw-accountprotection-emailstate-token_generated .sw-accountprotection-c2a-verify{display:none}.sw-accountprotection-emailstate-unsent .sw-accountprotection-c2a-resend{display:none}.sw-accountprotection-addsms-disclaimer{font-size:80%}");

(function(Riot) {
Riot.Sandworm.setTwig('pvpnet',"<div id='pvpnet' class='{{ globalClass }}'></div>");
Riot.Sandworm.setTwig('pvpnetBar', [
"<div id='pvpnet-bar'>",
"<div id='pvpnet-bar-inner'>",
"<div id='pvpnet-bar-logo'>",
"<a href='http://pvp.net/'></a>",
"</div>",
"{% includeif showRegions 'pvpnetBar-regions' %}",
"<div class='pvpnet-bar-support-link'>",
"<a href='http://support.leagueoflegends.com'>{{ support }}</a>",
"</div>",
"{% includeif showAccount 'pvpnetBar-account' %}",
"</div>",
"</div>"
]);
Riot.Sandworm.setTwig('pvpnetBar-regions', [
"<div id='pvpnet-bar-activator'>",
"<div class='pvpnet-bar-selected'>",
"<span class='activator-region'>{{ currentRegion }}</span>",
" - ",
"<span class='activator-language'>{{ currentLanguage }}</span>",
"</div>",
"<span class='activator-button'><span></span></span>",
"</div>"
]);
Riot.Sandworm.setTwig('pvpnetBar-account', "<div class='pvpnet-bar-account'></div>");
Riot.Sandworm.setTwig('logout', [
"<a href='{{ host }}/management' id='pvpnet-bar-account-button'>{{ username }}</a>",
"<a href='#' id='pvpnet-bar-logout-button'>{{ logout }}</a>"
]);
Riot.Sandworm.setTwig('login', [
"<a href='{{ host }}/login' id='pvpnet-bar-login-button'>{{ login }}</a>",
"<a href='{{ register_link }}'>{{ register }}</a>"
]);
Riot.Sandworm.setTwig('formCancel', "<a href='#' class='pvpnet-modal-button form-cancel'>{{ cancel }}</a>");
Riot.Sandworm.setTwig('loginMenu', [
"<div id='pvpnet-login-container' class='pvpnet-modal-container'>",
"<div class='pvpnet-modal-header'>",
"<h2>{{ login }}</h2>",
"<div class='pvpnet-modal-logo'></div>",
"</div>",
"<div class='pvpnet-modal-body'>",
"<div class='pvpnet-modal-content'>",
"<form method='post' autocomplete='off' class='pvpnet-login-form' action='{{ host }}/auth'>",
"<p>",
"<label for='pvpnet-account-username'>{{ username }}</label>"+
"<input type='text' id='pvpnet-account-username' name='username' class='pvpnet-modal-input form-text'>",
"</p>",
"<p>",
"<label for='pvpnet-account-password'>{{ password }}</label>",
"<input type='password' id='pvpnet-account-password' name='password' class='pvpnet-modal-input form-password'>",
"</p>",
"<div id='pvpnet-recaptcha'></div>",
"<div class='clearfix'>",
"<input type='submit'  class='form-submit' value='{{ login }}'>",
"</div>",
"</form>",
"<div class='pvpnet-form-links'>",
"<a class='forgot-username-anchor' href='{{ host }}/recover/username'>{{ forgotUsername }}</a>",
"<a class='forgot-password-anchor' href='{{ host }}/recover/password'>{{ forgotPassword }}</a>",
"</div>",
"</div>",
"</div>",
"<div class='pvpnet-modal-footer'></div>",
"</div>"
]);
Riot.Sandworm.setTwig('pvpnetMessage', '<p class="pvpnet-message" style="display:none;"></p>');
Riot.Sandworm.setTwig('pvpnetMenuLoader', "<div class='pvpnet-menu-loader'><div></div></div>");
Riot.Sandworm.setTwig('management', [
"<div id='account-management-container' class='pvpnet-modal-container'>",
"<div class='pvpnet-modal-header'>",
"<h2>{{ my_account_header }}</h2>",
"<div class='pvpnet-modal-logo'></div>",
"</div>",
"<div id='account-management-menu'>",
"<div id='account-management-right-column' class='account-column'>",
"</div>",
"<div id='account-management-left-column' class='account-column'>",
"<h4 class='account-management-menu'> {{ management_header }}</h4>",
"<ul class='nav-menu'>",
"{% includeif account_protection_enabled 'management-account-protection-link' %}",
"<li class='tab' data-goto-ref='change_email'>{{ management_change_email }}</li>",
"<li class='tab' data-goto-ref='change_password'>{{ management_change_password }}</li>",
"<li class='tab' data-goto-ref='change_sca'>{{ management_summoners_code_agreement }}</li>",
"</ul>",
"{% includeif show_links 'management-links' %}",
"</div>",
"<div class='pvpnet-modal-footer'></div>",
"</div>"
]);
Riot.Sandworm.setTwig('management_change_sca', [
"<div class='expanded sandworm_panel'>",
"<div class='summoners_code_description'>{{ summoners_code_description }}</div>",
"<div class='summoners_code_body'>{{ summoners_code_body }}</div>",
"</div>"
]);
Riot.Sandworm.setTwig('management-account-protection-link', [
"<li class='tab' data-goto-ref='change_acct_protection'>{{ management_account_protection }}</li>"
]);
Riot.Sandworm.setTwig('email-validation-error-try-again', [
"<div class= 'try-again-wrapper'><a>Try Again</a></div>"
]);
Riot.Sandworm.setTwig('password-change-tooltip', [
"<div class='tooltip-wrapper'>",
"<div class='pointer'>",
"<svg version='1.1'>",
"<polygon points='0,10 10,0 10,20'  style='fill:white;stroke:black;stroke-width:1'/>",
"</svg>",
"</div>",
"<div class ='tooltip'>",
"<div class='password-strength'>",
"<label>Password Strength: null</label>",
"<div class='strength-level'> <div></div> </div>",
"</div>",
"<ul>",
"<li class=''>No slashes or spaces</li>",
"<li class=''>8 to 16 characters long</li>",
"<li class=''>At least one letter and one number</li>",
"<li class=''>Password must match</li>",
"</ul>",
"</div>",
"</div>"
]);
Riot.Sandworm.setTwig('management-links',[
"<h4 class='account-management-links'>{{ management_links_header }}</h4>",
"<ul>",
"<li><a href='http://{{ region }}.leagueoflegends.com/tribunal/'>{{ links_tribunal }}</a> </li>",
"<li><a href='http://{{ region }}.leagueoflegends.com/rewards/'>{{ links_refer_a_friend }}</a></li>",
"<li><a href='http://signup.leagueoflegends.com/{{ short_language }}/signup/download'>{{ links_download }}</a></li>",
"</ul>"
]);
Riot.Sandworm.setTwig('management-cancel-button',[
"<a href='#' class='pvpnet-modal-button form-cancel'>{{ cancel }}</a>"
]);
Riot.Sandworm.setTwig('recoverUsername',[
"<div class='pvpnet-modal-container' id='pvpnet-recover-username'>",
"<div class='pvpnet-modal-header'>",
"<h2>{{ forgotUsername }}</h2>",
"<div class='pvpnet-modal-logo'></div>",
"</div>",
"<div class='pvpnet-modal-body'>",
"<div class='pvpnet-modal-content'>",
"<form method='post'  autocomplete='off' class='pvpnet-recover-username-form' action='{{ host }}/recover/username'>",
"<p>",
"<label for='pvpnet-recover-email'>{{ email }}</label>",
"<input id='pvpnet-recover-email' type='text' name='email' class='form-text'>",
"</p>",
"<div class='clearfix'>",
"<input type='submit' value='{{ submit }}' class='form-submit'>",
"</div>",
"</form>",
"</div>",
"</div>",
"<div class='pvpnet-modal-footer'></div>",
"</div>"
]);
Riot.Sandworm.setTwig('recoverPassword',[
"<div class='pvpnet-modal-container' id='pvpnet-recover-password'>",
"<div class='pvpnet-modal-header'>",
"<h2>{{ recoverPassword }}</h2>",
"<div class='pvpnet-modal-logo'></div>",
"</div>",
"<div class='pvpnet-modal-body'>",
"<div class='pvpnet-modal-content'>",
"<form method='post'  autocomplete='off' class='pvpnet-recover-password-form' action='{{ host }}/recover/password'>",
"<p>",
"<label for='pvpnet-recover-password-accountname'>{{ accountName }}</label>",
"<input id='pvpnet-recover-password-accountname' type='text' name='accountname' class='form-text'>",
"</p>",
"<div class='clearfix'>",
"<input type='submit' value='{{ submit }}' class='form-submit'>",
"</div>",
"</form>",
"</div>",
"</div>",
"<div class='pvpnet-modal-footer'></div>",
"</div>"
]);
})(Riot);Riot.Sandworm.pvpnetMenus = (function($) {
var menus = {},
active = false, animating = false, initialized = false;
// Define menu base object
var Menu = function() {
var observer = new Riot.Observer();
observer.injectOnto(this);
this.active = false;
this.initialized = false;
this.contents = null;
};
Menu.prototype.get = function() {
if (!this.initialized) {
this.initialized = true;
this.init();
}
return this.contents;
};
Menu.prototype.config = function (config) {
this.config = config;
};
Menu.prototype.init = function(){};
Menu.prototype._show = function () {};
Menu.prototype.show = function(){
this.get();
if (!this.active) {
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().fadeIn(100, function() {
Riot.Sandworm.pvpnetMenus.setAnimating(false);
});
this.active = true;
return this._show();
}
};
Menu.prototype._hide = function () {};
Menu.prototype.hide = function(){
var self = this,
deferred;
if (this.active) {
deferred = new $.Deferred();
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().fadeOut(100, function() {
Riot.Sandworm.pvpnetMenus.setAnimating(false);
$.when(self._hide()).then(function () {
deferred.resolve();
});
});
this.active = false;
return deferred.promise();
}
};
Menu.prototype.cancel = function () {
this.hide();
};
// Show a defined menu
// Arguments:
// 	menu (string) - index for menu to show
//	click (boolean) - did show event come from a click
function show(menu, click) {
if (typeof menus[menu] === 'undefined')
{
return;
}
// Ignore show action if a menu is animating and show event is from a click
if (animating && click) {
return;
}
// If a current menu is shown, hide first
if (active) {
active.hide();
}
// Wait for previous menu to complete animation event before showing.
if (animating) {
setTimeout(function() {
show(menu);
}, 50);
}
else {
menus[menu].show();
active = menus[menu];
}
if (!initialized) {
initialized = true;
}
};
// Show a defined menu and then go to a specific contentTabs tab index
// ++: now you can also specify a section within the tab
function showAndGoto(menu, index, section) {
if (typeof menus[menu] === 'undefined')
{
return;
}
if(!menus[menu].initialized) {
menus[menu].init({activeIndex: index});
}
else if(menus[menu].contents) {
$(menus[menu].contents).trigger("switch-panel", [index]);
}
// With this simple hack now we can specify sections within a tab 
// active section will be located in managementMenu.activeSection
menus[menu].activeSection = section;
show(menu);
};
// Hide a defined menu
// Arguments:
// 	menu (string) - index for menu to show
//	click (boolean) - did show event come from a click
function hide(menu, click) {
if (typeof menus[menu] === 'undefined')
{
return;
}
// Ignore hide action if there isn't a menu active or there are 
// menus currently animating ignore action.
if (!active ||
(animating && click)) {
return;
}
// Wait for previous menu to complete animation before hiding.
if (animating) {
setTimeout(function() {
hide(menu);
}, 50);
}
else {
menus[menu].hide();
active = false;
}
};
// Toggle state of menu
// Arguments:
// 	menu (string) - index for menu to show
//	click (boolean) - did show event come from a click
function toggle(menu, click) {
if (typeof menus[menu] === 'undefined')
{
return;
}
if (menus[menu].active) {
hide(menu, click);
}
else {
show(menu, click);
}
};
// Get a menu
function get(id) {
if(typeof menus[id] === 'undefined') {
menus[id] = new Menu();
}
return menus[id];
};
// Get the active menu
function getActive() {
return active;
};
function setAnimating(bool) {
animating = bool;
};
// Set a menu
// Initialize menu manager
function init(options) {
// Check to see if an menu initalization override has been set and if so
// show the menu.
if (typeof menus[options.init] !== 'undefined' && !initialized) {
menus[options.init].show();
}
};
return {
show: show,
showAndGoto: showAndGoto,
hide: hide,
toggle: toggle,
get: get,
getActive: getActive,
setAnimating: setAnimating,
init: init
};
})(jQuery);

(function(N,d,p,K,k,H){var b=this;var n=Math.floor(Math.random()*10000);var q=Function.prototype;var Q=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/;var R=/[\-\w]+\/\.\.\//;var F=/([^:])\/\//g;var I="";var o={};var M=N.easyXDM;var U="easyXDM_";var E;var y=false;var i;var h;function C(X,Z){var Y=typeof X[Z];return Y=="function"||(!!(Y=="object"&&X[Z]))||Y=="unknown"}function u(X,Y){return !!(typeof(X[Y])=="object"&&X[Y])}function r(X){return Object.prototype.toString.call(X)==="[object Array]"}function c(){var Z="Shockwave Flash",ad="application/x-shockwave-flash";if(!t(navigator.plugins)&&typeof navigator.plugins[Z]=="object"){var ab=navigator.plugins[Z].description;if(ab&&!t(navigator.mimeTypes)&&navigator.mimeTypes[ad]&&navigator.mimeTypes[ad].enabledPlugin){i=ab.match(/\d+/g)}}if(!i){var Y;try{Y=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");i=Array.prototype.slice.call(Y.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1);Y=null}catch(ac){}}if(!i){return false}var X=parseInt(i[0],10),aa=parseInt(i[1],10);h=X>9&&aa>0;return true}var v,x;if(C(N,"addEventListener")){v=function(Z,X,Y){Z.addEventListener(X,Y,false)};x=function(Z,X,Y){Z.removeEventListener(X,Y,false)}}else{if(C(N,"attachEvent")){v=function(X,Z,Y){X.attachEvent("on"+Z,Y)};x=function(X,Z,Y){X.detachEvent("on"+Z,Y)}}else{throw new Error("Browser not supported")}}var W=false,J=[],L;if("readyState" in d){L=d.readyState;W=L=="complete"||(~navigator.userAgent.indexOf("AppleWebKit/")&&(L=="loaded"||L=="interactive"))}else{W=!!d.body}function s(){if(W){return}W=true;for(var X=0;X<J.length;X++){J[X]()}J.length=0}if(!W){if(C(N,"addEventListener")){v(d,"DOMContentLoaded",s)}else{v(d,"readystatechange",function(){if(d.readyState=="complete"){s()}});if(d.documentElement.doScroll&&N===top){var g=function(){if(W){return}try{d.documentElement.doScroll("left")}catch(X){K(g,1);return}s()};g()}}v(N,"load",s)}function G(Y,X){if(W){Y.call(X);return}J.push(function(){Y.call(X)})}function m(){var Z=parent;if(I!==""){for(var X=0,Y=I.split(".");X<Y.length;X++){Z=Z[Y[X]]}}return Z.easyXDM}function e(X){N.easyXDM=M;I=X;if(I){U="easyXDM_"+I.replace(".","_")+"_"}return o}function z(X){return X.match(Q)[3]}function f(X){return X.match(Q)[4]||""}function j(Z){var X=Z.toLowerCase().match(Q);var aa=X[2],ab=X[3],Y=X[4]||"";if((aa=="http:"&&Y==":80")||(aa=="https:"&&Y==":443")){Y=""}return aa+"//"+ab+Y}function B(X){X=X.replace(F,"$1/");if(!X.match(/^(http||https):\/\//)){var Y=(X.substring(0,1)==="/")?"":p.pathname;if(Y.substring(Y.length-1)!=="/"){Y=Y.substring(0,Y.lastIndexOf("/")+1)}X=p.protocol+"//"+p.host+Y+X}while(R.test(X)){X=X.replace(R,"")}return X}function P(X,aa){var ac="",Z=X.indexOf("#");if(Z!==-1){ac=X.substring(Z);X=X.substring(0,Z)}var ab=[];for(var Y in aa){if(aa.hasOwnProperty(Y)){ab.push(Y+"="+H(aa[Y]))}}return X+(y?"#":(X.indexOf("?")==-1?"?":"&"))+ab.join("&")+ac}var S=(function(X){X=X.substring(1).split("&");var Z={},aa,Y=X.length;while(Y--){aa=X[Y].split("=");Z[aa[0]]=k(aa[1])}return Z}(/xdm_e=/.test(p.search)?p.search:p.hash));function t(X){return typeof X==="undefined"}var O=function(){var Y={};var Z={a:[1,2,3]},X='{"a":[1,2,3]}';if(typeof JSON!="undefined"&&typeof JSON.stringify==="function"&&JSON.stringify(Z).replace((/\s/g),"")===X){return JSON}if(Object.toJSON){if(Object.toJSON(Z).replace((/\s/g),"")===X){Y.stringify=Object.toJSON}}if(typeof String.prototype.evalJSON==="function"){Z=X.evalJSON();if(Z.a&&Z.a.length===3&&Z.a[2]===3){Y.parse=function(aa){return aa.evalJSON()}}}if(Y.stringify&&Y.parse){O=function(){return Y};return Y}return null};function T(X,Y,Z){var ab;for(var aa in Y){if(Y.hasOwnProperty(aa)){if(aa in X){ab=Y[aa];if(typeof ab==="object"){T(X[aa],ab,Z)}else{if(!Z){X[aa]=Y[aa]}}}else{X[aa]=Y[aa]}}}return X}function a(){var Y=d.body.appendChild(d.createElement("form")),X=Y.appendChild(d.createElement("input"));X.name=U+"TEST"+n;E=X!==Y.elements[X.name];d.body.removeChild(Y)}function A(Y){if(t(E)){a()}var ac;if(E){ac=d.createElement('<iframe name="'+Y.props.name+'"/>')}else{ac=d.createElement("IFRAME");ac.name=Y.props.name}ac.id=ac.name=Y.props.name;delete Y.props.name;if(typeof Y.container=="string"){Y.container=d.getElementById(Y.container)}if(!Y.container){T(ac.style,{position:"absolute",top:"-2000px",left:"0px"});Y.container=d.body}var ab=Y.props.src;Y.props.src="javascript:false";T(ac,Y.props);ac.border=ac.frameBorder=0;ac.allowTransparency=true;Y.container.appendChild(ac);if(Y.onLoad){v(ac,"load",Y.onLoad)}if(Y.usePost){var aa=Y.container.appendChild(d.createElement("form")),X;aa.target=ac.name;aa.action=ab;aa.method="POST";if(typeof(Y.usePost)==="object"){for(var Z in Y.usePost){if(Y.usePost.hasOwnProperty(Z)){if(E){X=d.createElement('<input name="'+Z+'"/>')}else{X=d.createElement("INPUT");X.name=Z}X.value=Y.usePost[Z];aa.appendChild(X)}}}aa.submit();aa.parentNode.removeChild(aa)}else{ac.src=ab}Y.props.src=ab;return ac}function V(aa,Z){if(typeof aa=="string"){aa=[aa]}var Y,X=aa.length;while(X--){Y=aa[X];Y=new RegExp(Y.substr(0,1)=="^"?Y:("^"+Y.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"));if(Y.test(Z)){return true}}return false}function l(Z){var ae=Z.protocol,Y;Z.isHost=Z.isHost||t(S.xdm_p);y=Z.hash||false;if(!Z.props){Z.props={}}if(!Z.isHost){Z.channel=S.xdm_c.replace(/["'<>\\]/g,"");Z.secret=S.xdm_s;Z.remote=S.xdm_e.replace(/["'<>\\]/g,"");ae=S.xdm_p;if(Z.acl&&!V(Z.acl,Z.remote)){throw new Error("Access denied for "+Z.remote)}}else{Z.remote=B(Z.remote);Z.channel=Z.channel||"default"+n++;Z.secret=Math.random().toString(16).substring(2);if(t(ae)){if(j(p.href)==j(Z.remote)){ae="4"}else{if(C(N,"postMessage")||C(d,"postMessage")){ae="1"}else{if(Z.swf&&C(N,"ActiveXObject")&&c()){ae="6"}else{if(navigator.product==="Gecko"&&"frameElement" in N&&navigator.userAgent.indexOf("WebKit")==-1){ae="5"}else{if(Z.remoteHelper){ae="2"}else{ae="0"}}}}}}}Z.protocol=ae;switch(ae){case"0":T(Z,{interval:100,delay:2000,useResize:true,useParent:false,usePolling:false},true);if(Z.isHost){if(!Z.local){var ac=p.protocol+"//"+p.host,X=d.body.getElementsByTagName("img"),ad;var aa=X.length;while(aa--){ad=X[aa];if(ad.src.substring(0,ac.length)===ac){Z.local=ad.src;break}}if(!Z.local){Z.local=N}}var ab={xdm_c:Z.channel,xdm_p:0};if(Z.local===N){Z.usePolling=true;Z.useParent=true;Z.local=p.protocol+"//"+p.host+p.pathname+p.search;ab.xdm_e=Z.local;ab.xdm_pa=1}else{ab.xdm_e=B(Z.local)}if(Z.container){Z.useResize=false;ab.xdm_po=1}Z.remote=P(Z.remote,ab)}else{T(Z,{channel:S.xdm_c,remote:S.xdm_e,useParent:!t(S.xdm_pa),usePolling:!t(S.xdm_po),useResize:Z.useParent?false:Z.useResize})}Y=[new o.stack.HashTransport(Z),new o.stack.ReliableBehavior({}),new o.stack.QueueBehavior({encode:true,maxLength:4000-Z.remote.length}),new o.stack.VerifyBehavior({initiate:Z.isHost})];break;case"1":Y=[new o.stack.PostMessageTransport(Z)];break;case"2":if(Z.isHost){Z.remoteHelper=B(Z.remoteHelper)}Y=[new o.stack.NameTransport(Z),new o.stack.QueueBehavior(),new o.stack.VerifyBehavior({initiate:Z.isHost})];break;case"3":Y=[new o.stack.NixTransport(Z)];break;case"4":Y=[new o.stack.SameOriginTransport(Z)];break;case"5":Y=[new o.stack.FrameElementTransport(Z)];break;case"6":if(!i){c()}Y=[new o.stack.FlashTransport(Z)];break}Y.push(new o.stack.QueueBehavior({lazy:Z.lazy,remove:true}));return Y}function D(aa){var ab,Z={incoming:function(ad,ac){this.up.incoming(ad,ac)},outgoing:function(ac,ad){this.down.outgoing(ac,ad)},callback:function(ac){this.up.callback(ac)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var Y=0,X=aa.length;Y<X;Y++){ab=aa[Y];T(ab,Z,true);if(Y!==0){ab.down=aa[Y-1]}if(Y!==X-1){ab.up=aa[Y+1]}}return ab}function w(X){X.up.down=X.down;X.down.up=X.up;X.up=X.down=null}T(o,{version:"2.4.19.3",query:S,stack:{},apply:T,getJSONObject:O,whenReady:G,noConflict:e});o.DomHelper={on:v,un:x,requiresJSON:function(X){if(!u(N,"JSON")){d.write('<script type="text/javascript" src="'+X+'"><\/script>')}}};(function(){var X={};o.Fn={set:function(Y,Z){X[Y]=Z},get:function(Z,Y){if(!X.hasOwnProperty(Z)){return}var aa=X[Z];if(Y){delete X[Z]}return aa}}}());o.Socket=function(Y){var X=D(l(Y).concat([{incoming:function(ab,aa){Y.onMessage(ab,aa)},callback:function(aa){if(Y.onReady){Y.onReady(aa)}}}])),Z=j(Y.remote);this.origin=j(Y.remote);this.destroy=function(){X.destroy()};this.postMessage=function(aa){X.outgoing(aa,Z)};X.init()};o.Rpc=function(Z,Y){if(Y.local){for(var ab in Y.local){if(Y.local.hasOwnProperty(ab)){var aa=Y.local[ab];if(typeof aa==="function"){Y.local[ab]={method:aa}}}}}var X=D(l(Z).concat([new o.stack.RpcBehavior(this,Y),{callback:function(ac){if(Z.onReady){Z.onReady(ac)}}}]));this.origin=j(Z.remote);this.destroy=function(){X.destroy()};X.init()};o.stack.SameOriginTransport=function(Y){var Z,ab,aa,X;return(Z={outgoing:function(ad,ae,ac){aa(ad);if(ac){ac()}},destroy:function(){if(ab){ab.parentNode.removeChild(ab);ab=null}},onDOMReady:function(){X=j(Y.remote);if(Y.isHost){T(Y.props,{src:P(Y.remote,{xdm_e:p.protocol+"//"+p.host+p.pathname,xdm_c:Y.channel,xdm_p:4}),name:U+Y.channel+"_provider"});ab=A(Y);o.Fn.set(Y.channel,function(ac){aa=ac;K(function(){Z.up.callback(true)},0);return function(ad){Z.up.incoming(ad,X)}})}else{aa=m().Fn.get(Y.channel,true)(function(ac){Z.up.incoming(ac,X)});K(function(){Z.up.callback(true)},0)}},init:function(){G(Z.onDOMReady,Z)}})};o.stack.FlashTransport=function(aa){var ac,X,ab,ad,Y,ae;function af(ah,ag){K(function(){ac.up.incoming(ah,ad)},0)}function Z(ah){var ag=aa.swf+"?host="+aa.isHost;var aj="easyXDM_swf_"+Math.floor(Math.random()*10000);o.Fn.set("flash_loaded"+ah.replace(/[\-.]/g,"_"),function(){o.stack.FlashTransport[ah].swf=Y=ae.firstChild;var ak=o.stack.FlashTransport[ah].queue;for(var al=0;al<ak.length;al++){ak[al]()}ak.length=0});if(aa.swfContainer){ae=(typeof aa.swfContainer=="string")?d.getElementById(aa.swfContainer):aa.swfContainer}else{ae=d.createElement("div");T(ae.style,h&&aa.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0});d.body.appendChild(ae)}var ai="callback=flash_loaded"+H(ah.replace(/[\-.]/g,"_"))+"&proto="+b.location.protocol+"&domain="+H(z(b.location.href))+"&port="+H(f(b.location.href))+"&ns="+H(I);ae.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+aj+"' data='"+ag+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+ag+"'></param><param name='flashvars' value='"+ai+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+ai+"' allowScriptAccess='always' wmode='transparent' src='"+ag+"' height='1' width='1'></embed></object>"}return(ac={outgoing:function(ah,ai,ag){Y.postMessage(aa.channel,ah.toString());if(ag){ag()}},destroy:function(){try{Y.destroyChannel(aa.channel)}catch(ag){}Y=null;if(X){X.parentNode.removeChild(X);X=null}},onDOMReady:function(){ad=aa.remote;o.Fn.set("flash_"+aa.channel+"_init",function(){K(function(){ac.up.callback(true)})});o.Fn.set("flash_"+aa.channel+"_onMessage",af);aa.swf=B(aa.swf);var ah=z(aa.swf);var ag=function(){o.stack.FlashTransport[ah].init=true;Y=o.stack.FlashTransport[ah].swf;Y.createChannel(aa.channel,aa.secret,j(aa.remote),aa.isHost);if(aa.isHost){if(h&&aa.swfNoThrottle){T(aa.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"})}T(aa.props,{src:P(aa.remote,{xdm_e:j(p.href),xdm_c:aa.channel,xdm_p:6,xdm_s:aa.secret}),name:U+aa.channel+"_provider"});X=A(aa)}};if(o.stack.FlashTransport[ah]&&o.stack.FlashTransport[ah].init){ag()}else{if(!o.stack.FlashTransport[ah]){o.stack.FlashTransport[ah]={queue:[ag]};Z(ah)}else{o.stack.FlashTransport[ah].queue.push(ag)}}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.PostMessageTransport=function(aa){var ac,ad,Y,Z;function X(ae){if(ae.origin){return j(ae.origin)}if(ae.uri){return j(ae.uri)}if(ae.domain){return p.protocol+"//"+ae.domain}throw"Unable to retrieve the origin of the event"}function ab(af){var ae=X(af);if(ae==Z&&af.data.substring(0,aa.channel.length+1)==aa.channel+" "){ac.up.incoming(af.data.substring(aa.channel.length+1),ae)}}return(ac={outgoing:function(af,ag,ae){Y.postMessage(aa.channel+" "+af,ag||Z);if(ae){ae()}},destroy:function(){x(N,"message",ab);if(ad){Y=null;ad.parentNode.removeChild(ad);ad=null}},onDOMReady:function(){Z=j(aa.remote);if(aa.isHost){var ae=function(af){if(af.data==aa.channel+"-ready"){Y=("postMessage" in ad.contentWindow)?ad.contentWindow:ad.contentWindow.document;x(N,"message",ae);v(N,"message",ab);K(function(){ac.up.callback(true)},0)}};v(N,"message",ae);T(aa.props,{src:P(aa.remote,{xdm_e:j(p.href),xdm_c:aa.channel,xdm_p:1}),name:U+aa.channel+"_provider"});ad=A(aa)}else{v(N,"message",ab);Y=("postMessage" in N.parent)?N.parent:N.parent.document;Y.postMessage(aa.channel+"-ready",Z);K(function(){ac.up.callback(true)},0)}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.FrameElementTransport=function(Y){var Z,ab,aa,X;return(Z={outgoing:function(ad,ae,ac){aa.call(this,ad);if(ac){ac()}},destroy:function(){if(ab){ab.parentNode.removeChild(ab);ab=null}},onDOMReady:function(){X=j(Y.remote);if(Y.isHost){T(Y.props,{src:P(Y.remote,{xdm_e:j(p.href),xdm_c:Y.channel,xdm_p:5}),name:U+Y.channel+"_provider"});ab=A(Y);ab.fn=function(ac){delete ab.fn;aa=ac;K(function(){Z.up.callback(true)},0);return function(ad){Z.up.incoming(ad,X)}}}else{if(d.referrer&&j(d.referrer)!=S.xdm_e){N.top.location=S.xdm_e}aa=N.frameElement.fn(function(ac){Z.up.incoming(ac,X)});Z.up.callback(true)}},init:function(){G(Z.onDOMReady,Z)}})};o.stack.NameTransport=function(ab){var ac;var ae,ai,aa,ag,ah,Y,X;function af(al){var ak=ab.remoteHelper+(ae?"#_3":"#_2")+ab.channel;ai.contentWindow.sendMessage(al,ak)}function ad(){if(ae){if(++ag===2||!ae){ac.up.callback(true)}}else{af("ready");ac.up.callback(true)}}function aj(ak){ac.up.incoming(ak,Y)}function Z(){if(ah){K(function(){ah(true)},0)}}return(ac={outgoing:function(al,am,ak){ah=ak;af(al)},destroy:function(){ai.parentNode.removeChild(ai);ai=null;if(ae){aa.parentNode.removeChild(aa);aa=null}},onDOMReady:function(){ae=ab.isHost;ag=0;Y=j(ab.remote);ab.local=B(ab.local);if(ae){o.Fn.set(ab.channel,function(al){if(ae&&al==="ready"){o.Fn.set(ab.channel,aj);ad()}});X=P(ab.remote,{xdm_e:ab.local,xdm_c:ab.channel,xdm_p:2});T(ab.props,{src:X+"#"+ab.channel,name:U+ab.channel+"_provider"});aa=A(ab)}else{ab.remoteHelper=ab.remote;o.Fn.set(ab.channel,aj)}var ak=function(){var al=ai||this;x(al,"load",ak);o.Fn.set(ab.channel+"_load",Z);(function am(){if(typeof al.contentWindow.sendMessage=="function"){ad()}else{K(am,50)}}())};ai=A({props:{src:ab.local+"#_4"+ab.channel},onLoad:ak})},init:function(){G(ac.onDOMReady,ac)}})};o.stack.HashTransport=function(Z){var ac;var ah=this,af,aa,X,ad,am,ab,al;var ag,Y;function ak(ao){if(!al){return}var an=Z.remote+"#"+(am++)+"_"+ao;((af||!ag)?al.contentWindow:al).location=an}function ae(an){ad=an;ac.up.incoming(ad.substring(ad.indexOf("_")+1),Y)}function aj(){if(!ab){return}var an=ab.location.href,ap="",ao=an.indexOf("#");if(ao!=-1){ap=an.substring(ao)}if(ap&&ap!=ad){ae(ap)}}function ai(){aa=setInterval(aj,X)}return(ac={outgoing:function(an,ao){ak(an)},destroy:function(){N.clearInterval(aa);if(af||!ag){al.parentNode.removeChild(al)}al=null},onDOMReady:function(){af=Z.isHost;X=Z.interval;ad="#"+Z.channel;am=0;ag=Z.useParent;Y=j(Z.remote);if(af){T(Z.props,{src:Z.remote,name:U+Z.channel+"_provider"});if(ag){Z.onLoad=function(){ab=N;ai();ac.up.callback(true)}}else{var ap=0,an=Z.delay/50;(function ao(){if(++ap>an){throw new Error("Unable to reference listenerwindow")}try{ab=al.contentWindow.frames[U+Z.channel+"_consumer"]}catch(aq){}if(ab){ai();ac.up.callback(true)}else{K(ao,50)}}())}al=A(Z)}else{ab=N;ai();if(ag){al=parent;ac.up.callback(true)}else{T(Z,{props:{src:Z.remote+"#"+Z.channel+new Date(),name:U+Z.channel+"_consumer"},onLoad:function(){ac.up.callback(true)}});al=A(Z)}}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.ReliableBehavior=function(Y){var aa,ac;var ab=0,X=0,Z="";return(aa={incoming:function(af,ad){var ae=af.indexOf("_"),ag=af.substring(0,ae).split(",");af=af.substring(ae+1);if(ag[0]==ab){Z="";if(ac){ac(true)}}if(af.length>0){aa.down.outgoing(ag[1]+","+ab+"_"+Z,ad);if(X!=ag[1]){X=ag[1];aa.up.incoming(af,ad)}}},outgoing:function(af,ad,ae){Z=af;ac=ae;aa.down.outgoing(X+","+(++ab)+"_"+af,ad)}})};o.stack.QueueBehavior=function(Z){var ac,ad=[],ag=true,aa="",af,X=0,Y=false,ab=false;function ae(){if(Z.remove&&ad.length===0){w(ac);return}if(ag||ad.length===0||af){return}ag=true;var ah=ad.shift();ac.down.outgoing(ah.data,ah.origin,function(ai){ag=false;if(ah.callback){K(function(){ah.callback(ai)},0)}ae()})}return(ac={init:function(){if(t(Z)){Z={}}if(Z.maxLength){X=Z.maxLength;ab=true}if(Z.lazy){Y=true}else{ac.down.init()}},callback:function(ai){ag=false;var ah=ac.up;ae();ah.callback(ai)},incoming:function(ak,ai){if(ab){var aj=ak.indexOf("_"),ah=parseInt(ak.substring(0,aj),10);aa+=ak.substring(aj+1);if(ah===0){if(Z.encode){aa=k(aa)}ac.up.incoming(aa,ai);aa=""}}else{ac.up.incoming(ak,ai)}},outgoing:function(al,ai,ak){if(Z.encode){al=H(al)}var ah=[],aj;if(ab){while(al.length!==0){aj=al.substring(0,X);al=al.substring(aj.length);ah.push(aj)}while((aj=ah.shift())){ad.push({data:ah.length+"_"+aj,origin:ai,callback:ah.length===0?ak:null})}}else{ad.push({data:al,origin:ai,callback:ak})}if(Y){ac.down.init()}else{ae()}},destroy:function(){af=true;ac.down.destroy()}})};o.stack.VerifyBehavior=function(ab){var ac,aa,Y,Z=false;function X(){aa=Math.random().toString(16).substring(2);ac.down.outgoing(aa)}return(ac={incoming:function(af,ad){var ae=af.indexOf("_");if(ae===-1){if(af===aa){ac.up.callback(true)}else{if(!Y){Y=af;if(!ab.initiate){X()}ac.down.outgoing(af)}}}else{if(af.substring(0,ae)===Y){ac.up.incoming(af.substring(ae+1),ad)}}},outgoing:function(af,ad,ae){ac.down.outgoing(aa+"_"+af,ad,ae)},callback:function(ad){if(ab.initiate){X()}}})};o.stack.RpcBehavior=function(ad,Y){var aa,af=Y.serializer||O();var ae=0,ac={};function X(ag){ag.jsonrpc="2.0";aa.down.outgoing(af.stringify(ag))}function ab(ag,ai){var ah=Array.prototype.slice;return function(){var aj=arguments.length,al,ak={method:ai};if(aj>0&&typeof arguments[aj-1]==="function"){if(aj>1&&typeof arguments[aj-2]==="function"){al={success:arguments[aj-2],error:arguments[aj-1]};ak.params=ah.call(arguments,0,aj-2)}else{al={success:arguments[aj-1]};ak.params=ah.call(arguments,0,aj-1)}ac[""+(++ae)]=al;ak.id=ae}else{ak.params=ah.call(arguments,0)}if(ag.namedParams&&ak.params.length===1){ak.params=ak.params[0]}X(ak)}}function Z(an,am,ai,al){if(!ai){if(am){X({id:am,error:{code:-32601,message:"Procedure not found."}})}return}var ak,ah;if(am){ak=function(ao){ak=q;X({id:am,result:ao})};ah=function(ao,ap){ah=q;var aq={id:am,error:{code:-32099,message:ao}};if(ap){aq.error.data=ap}X(aq)}}else{ak=ah=q}if(!r(al)){al=[al]}try{var ag=ai.method.apply(ai.scope,al.concat([ak,ah]));if(!t(ag)){ak(ag)}}catch(aj){ah(aj.message)}}return(aa={incoming:function(ah,ag){var ai=af.parse(ah);if(ai.method){if(Y.handle){Y.handle(ai,X)}else{Z(ai.method,ai.id,Y.local[ai.method],ai.params)}}else{var aj=ac[ai.id];if(ai.error){if(aj.error){aj.error(ai.error)}}else{if(aj.success){aj.success(ai.result)}}delete ac[ai.id]}},init:function(){if(Y.remote){for(var ag in Y.remote){if(Y.remote.hasOwnProperty(ag)){ad[ag]=ab(Y.remote[ag],ag)}}}aa.down.init()},destroy:function(){for(var ag in Y.remote){if(Y.remote.hasOwnProperty(ag)&&ad.hasOwnProperty(ag)){delete ad[ag]}}aa.down.destroy()}})};b.easyXDM=o})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);(function (win) {
var $ = win.jQuery,
ns = "strongpassword",
passwordRE = /^((?=.*[^0-9])(?=.*\d).{8,})$/, 
examples = ["runepage1","ruenpaeg1","!ruenicpaege051!"],
minLength = 8,
strengthValue = [0, 1, 1, 2, 2],
ajaxPromise;
function zxcvbnStub () {
return { score: 2 };
}
function loadZxcvbn(callback) {
if (win.zxcvbn) {
return callback(win.zxcvbn);
} else if (!ajaxPromise) {
ajaxPromise = $.ajax({
dataType: "script",
cache: true,
url: checkPasswordStrength.url
});
ajaxPromise.always(function () {
ajaxPromise = null;
});
}
ajaxPromise.always(function () {
callback(win.zxcvbn || zxcvbnStub);
});
}
function checkPasswordStrength() {
var $self = $(this),
$dom = $(checkPasswordStrength.template),
$help = $("." + ns + "-help", $dom),
$value = $("." + ns + "-value", $dom),
$tooltip = $("." + ns + "-tooltip", $dom),
zxcvbn,
ready,
currentStr,
onHelpToggle = function () {
$tooltip.fadeToggle();
},
onKeyUp = function () {
handle.checkStrength();
},
l10n = checkPasswordStrength.l10n,
handle = {
detach: function () {
$dom.remove();
$help.off("mouseover mouseout", onHelpToggle);
$self.off("keyup paste change", onKeyUp);
$self.data(ns, null);
$dom = $help = $value = $tooltip = null;
},
getStrength: function() {
if (!$self.val()) {
return -1;
}
if (!handle.meetsCriteria()) {
return 0;
}
return strengthValue[handle.getEntropy().score];
},
isLoaded: function () {
return ready;
},
checkStrength: function () {
var newStr = handle.getStrength();
$dom.removeClass(ns + "-strength-" + currentStr).addClass(ns + "-strength-" + newStr);
currentStr = newStr;
},
meetsCriteria: function () {
return passwordRE.test($self.val());
},
getEntropy: function () {
return zxcvbn($self.val(), checkPasswordStrength.blacklist.concat(examples));
},
isStrongEnough: function () {
return handle.isLoaded() && handle.meetsCriteria() && handle.getEntropy().score > 0;
}
};
// Localize
if (l10n) {
$.each(l10n, function (key, value) {
$("." + ns + "-" + key, $dom).html(value);
});
}
// add examples
$("." + ns + "-example-bad", $dom).text(examples[0]);
$("." + ns + "-example-better", $dom).text(examples[1]);
$("." + ns + "-example-best", $dom).text(examples[2]);
// add the new UI
$tooltip.hide();
$dom.insertAfter($self);
// attach listeners
$help.hover(onHelpToggle);
$self.on("keyup paste change", onKeyUp);
// load zxcvbn if it's not been requested
loadZxcvbn(function (result) {
zxcvbn = result;
ready = true;
$dom.removeClass(ns + "-is-loading");
handle.checkStrength();
});
// store the handle for easy reference
$self.data(ns, handle);
return handle;
}
checkPasswordStrength.blacklist = [];
checkPasswordStrength.template = ([
"<div class='" + ns + " " + ns + "-is-loading'>",
"<div class='" + ns + "-help'>?</div>",
"<div class='" + ns + "-text'>",
"<span class='" + ns + "-loading'></span>",
"<span class='" + ns + "-label'></span> ",
"<span class='" + ns + "-value " + ns + "-value-0'></span>",
"<span class='" + ns + "-value " + ns + "-value-1'></span>",
"<span class='" + ns + "-value " + ns + "-value-2'></span>",
"</div>",
"<div class='" + ns + "-tooltip'>",
"<p class='" + ns + "-tooltip-1'></p>",
"<p class='" + ns + "-tooltip-2'></p>",
"<p>",
"<span class='" + ns + "-example'>Example:</span> ",
"<br /><span class='" + ns + "-bad'></span> ",
"&quot;<span class='" + ns + "-example-bad'></span>&quot; ",
"<br /><span class='" + ns + "-better'></span> ",
"&quot;<span class='" + ns + "-example-better'></span>&quot; ",
"<br /><span class='" + ns + "-best'></span> ",
"&quot;<span class='" + ns + "-example-best'></span>&quot;",
"</p>",
"</div>",
"</div>"
]).join("");
checkPasswordStrength.examples = examples;
checkPasswordStrength.url = "https://d3993dh69r9jfv.cloudfront.net/vendor/zxcvbn.js";
$.fn.checkPasswordStrength = checkPasswordStrength;
}(window));
Riot.cssPrepare("strongpassword","#pvpnet-account-password-new{margin-bottom:4px !important}.strongpassword{border-top:5px solid transparent;position:relative;display:block;font-size:10px;line-height:2;padding-left:16px}.strongpassword-help{position:absolute;top:2px;left:0}.strongpassword-help{background:transparent url(https://s3-us-west-2.amazonaws.com/sandworm/images/pvpnet-sprite-v3.png) no-repeat -5px -805px;width:14px;height:14px;text-indent:22px;overflow:hidden;margin-right:0.5em;white-space:nowrap}.strongpassword-loading,.strongpassword-value{display:none}.strongpassword-strength--1 .strongpassword-help,.strongpassword-strength--1 .strongpassword-text{visibility:hidden}.strongpassword-is-loading .strongpassword-label{display:none}.strongpassword-is-loading .strongpassword-loading{display:inline-block}.strongpassword-strength-0{border-top-color:#f30}.strongpassword-strength-0 .strongpassword-value-0{color:#f30;display:inline}.strongpassword-strength-1{border-top-color:#fc0}.strongpassword-strength-1 .strongpassword-value-1{color:#fc0;display:inline}.strongpassword-strength-2{border-top-color:#0c0}.strongpassword-strength-2 .strongpassword-value-2{color:#0c0;display:inline}.strongpassword-tooltip{position:absolute;top:2em;left:1em;line-height:1.2;padding:1px 1em;background:#323232;color:#CCC;border:1px solid #797979;-webkit-border-radius:0.5em;-moz-border-radius:0.5em;-ms-border-radius:0.5em;-o-border-radius:0.5em;border-radius:0.5em;width:18em;z-index:1}");

// jQuery dependency
(function ($) {
var console = window.console;
if(typeof $.fn.on === 'undefined') {
$.fn.on = function on(type, delegate, callback) {
if(typeof delegate === 'string') {
return $.fn.delegate.call(this, delegate, type, callback);
}
else {
callback = delegate;
return $.fn.bind.call(this, type, callback);
}
};
if(typeof console === 'object' && typeof console.warn == 'function') {
console.warn('The PVPNet bar is intended for jQuery 1.7.0 or greater. Extending the older version of jQuery to compensate.');
}
}
var body, options, initDeferred;
Riot.Sandworm.pvpnet = function (_options) {
initDeferred = new $.Deferred();
// Exit if pvpnet bar is already initialized
if (document.getElementById('pvpnet')) {
initDeferred.reject();
return initDeferred.promise();
}
options = _options || {};
options = Riot.rebase(options, {
//Ajax timeout setting
ajax:{
timeout:15000
},
// Style controls
offset_bars:false,
// Set to true to add some margin to the top of the body for sandworm
offset_body:false,
//There are some links on the side of the management modal, hide or show them?
show_links:false,
//Show regions dropdown?
show_regions:true,
//Show login and account management?
show_account:true,
//Language in path for language selection redirection
language_in_path: {
enabled: true,
long_languages: ["pt_BR"],
excluded_languages_in_path: ["en"]
},
//Append the window.location.pathname to the language redirector
append_path: false,
// is sandworm in standalone mode?
standalone:false,
// Initial loading wait timer
load_timer:1,
// This object and its properties are used to build the region
// selector dropdown columns.
regions:sw_cfg.regions,
//What menus are currently being shown?
menus:{},
//What host do we want to point to? Used in various link outputs
host:sw_cfg.host,
//Sandworm backend connection point
postMessage:{
origin:sw_cfg.host,
bridgePath:"/pm.html"
},
//The link to the signup site
register_link: 'http://signup.leagueoflegends.com',
//Do you want to show captcha ?
captcha: {
enabled: true,
public_key: sw_cfg.captcha_public_key
}
});
// Local Localizations
if (typeof pvpnet_localizations === "object") {
options.localization = Riot.rebase(pvpnet_localizations, options.localization);
$.fn.checkPasswordStrength.l10n = options.localization.strongpassword;
}
initOnReady(options.load_timer);
return initDeferred.promise();
};
function initOnReady(timer) {
var bodies = document.getElementsByTagName('body');
if (bodies.length) {
body = bodies[0];
init();
}
// We fail when the body takes more than a second to init
else if (timer < options.load_timer * 256) {
setTimeout(initOnReady, timer, timer * 2);
}
}
function init() {
// Setting up the visual of the pvpnet bar ASAP
Riot.cssInject('pvpnet');
var $pvpnet = $(Riot.Sandworm.getTwig('pvpnet', {
globalClass:(Riot.hasFeature('borderRadius') ? "" : "oldie ")
})).prependTo(body);
// The fancy stuff comes later
var events = new Riot.Observer(),
bridge = new Riot.Sandworm.Bridge({
host: sw_cfg.host,
origin: options.postMessage.origin,
bridgePath: options.postMessage.bridgePath,
serviceError: options.localization.service_error,
timeout: options.ajax.timeout,
tracker: Riot.Sandworm.track
});
events.addListener("pvpnet-form-clear", function () {
$(".pvpnet-message", $pvpnet).remove();
});
events.addListener("pvpnet-menu-hide", function () {
events.trigger("pvpnet-form-clear");
$("input[type!=submit]", $pvpnet).each(function () {
$(this).val("");
$(this).change();
})
});
function pvpnetInit() {
var GASTOKEN = Riot.getCookie(Riot.Sandworm.cookies.token + "_" + Riot.Sandworm.getRegion().toUpperCase()),
USERNAME = Riot.getCookie(Riot.Sandworm.cookies.user + "_" + Riot.Sandworm.getRegion().toUpperCase());
$(Riot.Sandworm.getTwig('pvpnetBar', {
currentRegion: options.localization.regions[Riot.Sandworm.getRegion()],
currentLanguage: options.localization.languages[Riot.Sandworm.getLang()],
support: options.localization.support,
showRegions: options.show_regions,
showAccount: options.show_account
})).prependTo($pvpnet);
// If user is not logged in display login button.  Otherwise display
// username and logout button.
if (GASTOKEN && USERNAME) {
USERNAME = decodeURIComponent(USERNAME.replace(/\+/g, ' ')).replace(/[<">]/g, '');
// User is logged in.  Display account management and logout buttons
$(".pvpnet-bar-account", "#pvpnet-bar").append(Riot.Sandworm.getTwig('logout', {
host:options.host,
username:USERNAME,
logout:options.localization.logout
}));
$("#pvpnet-bar-account-button").bind("click", function (e) {
e.preventDefault();
Riot.Sandworm.pvpnetMenus.toggle("management");
});
$("#pvpnet-bar-logout-button").bind("click", function (e) {
e.preventDefault();
events.trigger("pvpnet-logout");
});
}
else {
// User is not logged in.  Display login and signup buttons.
$(".pvpnet-bar-account", "#pvpnet-bar").append(Riot.Sandworm.getTwig('login', {
host:options.host,
login:options.localization.login,
register:options.localization.register,
register_link: options.register_link
}));
$("#pvpnet-bar-login-button").bind("click", function (e) {
e.preventDefault();
Riot.Sandworm.pvpnetMenus.toggle('login', true);
});
}
if (options.show_regions) {
// Add region menu to #pvpnet-bar-activator
$("#pvpnet-bar-activator").bind("click", function (e) {
e.preventDefault();
Riot.Sandworm.pvpnetMenus.toggle('regions', true);
});
}
// Bind to menu cancel action to ESC key
$pvpnet.bind("keyup", function (e) {
if (e.keyCode == 27 && Riot.Sandworm.pvpnetMenus.getActive()) {
Riot.Sandworm.pvpnetMenus.get('active').cancel();
}
});
// Initialize menu manager
Riot.Sandworm.pvpnetMenus.init(options.menus, $pvpnet);
// Show appropriate error messaging for from form AJAX requests.
// Needs {form: Object, message: String}
// TODO: normalize meh! pls!
events.addListener("pvpnet-form-ajax-error", function (data) {
var $message = $(".pvpnet-message", data.form),
text = data.message;
if ("object" === typeof text) {
text = text.error.response;
if ("object" === typeof text) {
text = text.error;
}
}
if ($message.length === 0) {
$message = $(Riot.Sandworm.getTwig('pvpnetMessage')).prependTo(data.form);
}
$message.fadeOut(100, function () {
$(this).toggleClass("pvpnet-error", true);
$(this).toggleClass("pvpnet-success", false);
$(this).html(text).fadeIn(100);
});
});
// Needs {form: Object, message: String}
events.addListener("pvpnet-form-ajax-response", function (data) {
var $message = $(".pvpnet-message", data.form);
if ($message.length === 0) {
$message = $(Riot.Sandworm.getTwig('pvpnetMessage')).prependTo(data.form);
}
$message.fadeOut(100, function () {
$(this).toggleClass("pvpnet-error", false);
$(this).toggleClass("pvpnet-success", true);
$(this).html(data.message).fadeIn(100);
});
});
// Hiding the messaging
// Needs {form: Object}
events.addListener("pvpnet-form-ajax-hide", function (data) {
var $message = $(".pvpnet-message", data.form);
$message.hide();
});
events.addListener('pvpnet-form-show-loader', function (data) {
data.form.prepend(Riot.Sandworm.getTwig('pvpnetMenuLoader', {host:sw_cfg.host}));
});
events.addListener('pvpnet-form-hide-loader', function (data) {
data.form.find(".pvpnet-menu-loader").remove();
});
events.addListener('pvpnet-form-disable', function (data) {
data.form.find("input[type='submit']").attr("disabled", "disabled");
});
events.addListener('pvpnet-form-enable', function (data) {
data.form.find("input[type='submit']").removeAttr("disabled");
});
// This goes here to ensure a reflow occurred before we check the height
var pvpnetHeight = $pvpnet.outerHeight();
// Kicking other floating nav bars out of pvp.net's way
if (options.offset_bars) {
var els = document.getElementsByTagName('*'),
count = els.length,
$el, offset;
while(count--) {
$el = $(els[count]);
offset = $el.offset();
// Detecting a floating bar, under some conditionals that floating bars tend to fullfil.
if( (
offset.top === 0 &&
offset.left === 0 &&
$el.attr('id') !== 'pvpnet' &&
$el.outerHeight() <= 100 &&
// Fix: (Magic Number) Older browsers can have up to a 4 pixel wide padding in select conditions
$el.outerWidth() >= ($(body).outerWidth() - 8)
) &&
(
$el.css('position') === 'fixed' ||
$el.css('position') === 'absolute' ||
$el.hasClass('navbar')
)
) {
// Fix: 0 + addresses NaN problems for older browsers
var shiftTo = pvpnetHeight + parseInt(0 + $el.css('margin-top'), 10);
// Fix: Bootstrap navbar's has a really strange top border-radius. We'll just overlap that.
if($el.hasClass('navbar')) {
shiftTo -= 3;
}
$el.css('margin-top', shiftTo + 'px');
}
}
}
// Offsetting the body
if (options.offset_body) {
var $body = $(body);
$body.css('margin-top', parseInt(0 + $body.css('margin-top'), 10) + pvpnetHeight);
}
// Resolve the promise indicating Pvp.net bar initialization has finished
initDeferred.resolve();
}
events.addListener("pvpnet-init", function pvpnetInitListener() {
var currentRegion = Riot.Sandworm.getRegion().toUpperCase();
// If the current domain is not *.leagueoflegends.com, then copy the Sandworm cookies over to this domain.
if(Riot.Sandworm.isForeignHost()) {
bridge.copyCookiesFromLol([
Riot.Sandworm.cookies.user + '_' + currentRegion,
Riot.Sandworm.cookies.userid + '_' + currentRegion,
Riot.Sandworm.cookies.token + '_' + currentRegion
]).then(function(data) {
pvpnetInit();
});
} else {
pvpnetInit();
}
events.removeListener("pvpnet-init", pvpnetInitListener);
}); // @end events.addListener("pvpnet-init")
Riot.Sandworm.pvpnetMenus.add = function (name, MenuClass) {
var menu = Riot.Sandworm.pvpnetMenus.get(name);
$.extend(menu, MenuClass);
menu.config({
options: options,
events: events,
bridge: bridge,
sw_cfg: sw_cfg,
$pvpnet: $pvpnet,
tracker: Riot.Sandworm.track
});
return menu;
};
var loginMenu = Riot.Sandworm.pvpnetMenus.get('login'),
loginMenuForm,
loginFormValidtion;
// Define login menu
loginMenu.get = function () {
if (!this.initialized) {
this.init();
}
return this.contents;
};
loginMenu.onSuccess = function () {
loginFormValidtion.detach();
location.reload();
};
loginMenu.onError = function (data) {
var errorMessage;
//If we have captcha enabled and a key provided, reload it
if (options.captcha.enabled && options.captcha.public_key && window.Recaptcha) {
Recaptcha.reload();
}
switch (data) {
case "Not Authorized.":
errorMessage = options.localization.invalid_auth_credentials;
break;
case "NO_SUMMONER_NAME":
errorMessage = options.localization.no_summoner_name;
break;
default:
if (typeof data == 'string') {
errorMessage = data;
} else if (typeof data == "object" && data.error != undefined && typeof data.error.response == 'object' ){
errorMessage = data.error.response.error;
} else {
errorMessage = options.localization.service_error;
}
break;
}
events.trigger("pvpnet-form-hide-loader", { form: loginMenuForm });
events.trigger('pvpnet-form-ajax-error', {
form: loginMenuForm,
message:errorMessage
});
loginMenuForm.one("keyup", function () {
loginFormValidtion.setLock(false);
});
};
loginMenu.init = function () {
this.contents = $(Riot.Sandworm.getTwig('loginMenu', {
host:options.host,
username:options.localization.username,
password:options.localization.password,
login:options.localization.login,
forgotUsername:options.localization.forgot_username,
forgotPassword:options.localization.forgot_password
})).appendTo($pvpnet);
if (options.captcha.enabled && options.captcha.public_key.length > 0) {
// Here we dynamically inject recaptcha
var scriptObj = document.createElement('script');
scriptObj.src='https://www.google.com/recaptcha/api/js/recaptcha_ajax.js';
var insertPoint = document.body;
//and wait for the script to finish loading before we ask Recaptcha to inject itself
scriptObj.onload = scriptObj.onreadystatechange = function(){
//Once the script is loaded, let's inject captcha, and increase the width of the modal
if (window.Recaptcha) {
Recaptcha.create(options.captcha.public_key,
"pvpnet-recaptcha",
{
theme: "blackglass",
lang: Riot.Sandworm.getLang().substr(0, 2)
}
);
$("#pvpnet-login-container").addClass('recaptcha');
}
};
insertPoint.parentNode.insertBefore(scriptObj, insertPoint);
}
//Let's give the player an easier time of getting to the login form
$("#pvpnet-account-username").focus();
// If menu is not in standalone mode add modal cancel and close buttons.
if (!options.standalone) {
$(".pvpnet-modal-header", this.contents).append(
$("<div>").addClass("pvpnet-modal-close")
.bind("click", function () {
// Hide modal when form is closed
Riot.Sandworm.pvpnetMenus.getActive().hide();
})
);
$(".clearfix", this.contents).append(
$(Riot.Sandworm.getTwig('formCancel', {
cancel: options.localization.cancel
})).bind("click", function () {
// Hide modal when form is canceled
Riot.Sandworm.pvpnetMenus.getActive().hide();
})
);
}
//Delegate events for elements in the login container
//click event: forgot username link
$(".pvpnet-form-links").delegate(".forgot-username-anchor", "click", function (e) {
// Show the recover username menu when this button is clicked.
e.preventDefault();
Riot.Sandworm.pvpnetMenus.show("recoverUsername", true);
});
//click event: forgot password link
$(".pvpnet-form-links").delegate(".forgot-password-anchor", "click", function (e) {
// Show the recover password menu when this button is clicked.
e.preventDefault();
Riot.Sandworm.pvpnetMenus.show("recoverPassword", true);
});
this.initialized = true;
// store a reference to the form
loginMenuForm = $(".pvpnet-login-form", $pvpnet);
};
// Fade out when menu manager tries to hide this menu
loginMenu.hide = function () {
if (this.active) {
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().fadeOut(100, function () {
$(this).trigger("pvpnet-menu-login-hide");
events.trigger("pvpnet-menu-hide");
Riot.Sandworm.pvpnetMenus.setAnimating(false);
});
this.active = false;
loginFormValidtion.detach();
}
};
loginMenu.onValidate = function ($form) {
return $("#pvpnet-account-username", $form).val() && $("#pvpnet-account-password", $form).val();
};
loginMenu.onSubmit = function (e) {
var $form = $(e.target),
input = {};
$("input[name]", $form).each(function () {
input[this.name] = $(this).val();
});
events.trigger("pvpnet-form-clear", {form:$form});
events.trigger('pvpnet-form-show-loader', {form:$form});
loginFormValidtion.setLock(true);
bridge.send({
type:'login',
action:$form.attr('action'),
input:input
}).then(loginMenu.onSuccess, loginMenu.onError);
};
// Fade in when menu manager tries to show this menu
loginMenu.show = function () {
if (!this.active) {
Riot.Sandworm.track("pageview", "/sandworm/loginMenu");
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().fadeIn(100, function () {
$(this).trigger("pvpnet-menu-login-show");
$("input[type!=submit]", this).eq(0).focus();
Riot.Sandworm.pvpnetMenus.setAnimating(false);
});
this.active = true;
loginFormValidtion = loginMenuForm.addSandwormFormValidation({
onValidate: loginMenu.onValidate,
onSubmit: loginMenu.onSubmit
});
}
};
// Hide this menu when the menu manager cancels this menu
loginMenu.cancel = function () {
this.hide();
};
var manageMenu = Riot.Sandworm.pvpnetMenus.add('management', Riot.Sandworm.ManageMenu);
var regionsMenu = Riot.Sandworm.pvpnetMenus.add('regions', Riot.Sandworm.RegionsMenu);
// Handle logout event
events.addListener("pvpnet-logout", function () {
bridge.send({
type:'logout',
action:sw_cfg.host + "/logout"
}).always(function () {
// As of right now, we are only responding with success: true unless a 500 or 404 is thrown
window.location.reload();
});
});
var recoverUsername = Riot.Sandworm.pvpnetMenus.get('recoverUsername'),
recoverUsernameForm,
recoverUsernameValidation;
// Define recover-username menu
recoverUsername.get = function() {
if (!this.initialized) {
this.init();
}
return this.contents;
};
recoverUsername.init = function() {
this.contents = $(Riot.Sandworm.getTwig('recoverUsername', {
forgotUsername: options.localization.forgot_username,
email: options.localization.email,
submit: options.localization.submit,
host: options.host
})).appendTo($pvpnet);
// If menu is not in standalone mode add modal cancel and close buttons.
if (!options.standalone) {
$(".pvpnet-modal-header", this.contents).append(
$("<div>").addClass("pvpnet-modal-close")
.bind("click", function(e) {
// Hide modal when form is closed
e.preventDefault();
Riot.Sandworm.pvpnetMenus.getActive().hide();
})
);
}
$(".clearfix", this.contents).append(
$(Riot.Sandworm.getTwig('formCancel', {
cancel: options.localization.cancel
})).bind("click", function (e) {
// Hide modal when form is canceled
e.preventDefault();
Riot.Sandworm.pvpnetMenus.show("login", true);
})
);
this.initialized = true;
recoverUsernameForm = $(".pvpnet-recover-username-form", $pvpnet);
};
recoverUsername.onSubmit = function (e) {
var $form = $(e.target),
input = {};
$("input[name]", $form).each(function () {
input[this.name] = $(this).val();
});
// Trigger form clear and show a loader before sending request.
events.trigger("pvpnet-form-clear", {form:$form});
events.trigger('pvpnet-form-show-loader', {form:$form});
recoverUsernameValidation.setLock(true);
bridge.send({
type:'recover-username',
action:$form.attr('action'),
input:input
}).then(recoverUsername.onSuccess, recoverUsername.onError);
};
recoverUsername.onValidate = function ($form) {
var val = $("input[name]", $form).val();
return val && Riot.Sandworm.isEmail(val);
};
recoverUsername.onSuccess = function(data){
var $form = recoverUsernameForm;
events.trigger("pvpnet-form-hide-loader",{form:$form});
if(data.success){
events.trigger("pvpnet-form-ajax-response",{form:$form, message:data.message});
}
else{
events.trigger("pvpnet-form-ajax-error", {form : $form, message: data.error});
}
$form.one("keyup", "input[name]", function () {
recoverUsernameValidation.setLock(false);
});
};
recoverUsername.onError = function(data){
var $form = recoverUsernameForm;
events.trigger("pvpnet-form-hide-loader",{form:$form});
events.trigger("pvpnet-form-ajax-error", {form : $form, message: data});
$form.one("keyup", "input[name]", function () {
recoverUsernameValidation.setLock(false);
});
};
// Fade out when menu manager tries to hide this menu.
recoverUsername.hide = function() {
if (this.active) {
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().fadeOut(100, function() {
$(this).trigger("pvpnet-menu-recoverUsername-hide");
events.trigger("pvpnet-menu-hide");
Riot.Sandworm.pvpnetMenus.setAnimating(false);
});
this.active = false;
recoverUsernameValidation.detach();
}
};
// Fade in when menu manager tries to hide this menu.
recoverUsername.show = function() {
if (!this.active) {
Riot.Sandworm.track("pageview", "/sandworm/recoverUsername");
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().fadeIn(100, function() {
$(this).trigger("pvpnet-menu-recoverUsername-show");
$("input[type!=submit]", this).eq(0).focus();
Riot.Sandworm.pvpnetMenus.setAnimating(false);
});
this.active = true;
recoverUsernameValidation = recoverUsernameForm.addSandwormFormValidation({
onValidate: recoverUsername.onValidate,
onSubmit: recoverUsername.onSubmit
});
}
};
// Show login menu when recover username menu is canceled.
recoverUsername.cancel = function() {
Riot.Sandworm.pvpnetMenus.show("login",true);
};
var recoverPassword = Riot.Sandworm.pvpnetMenus.get('recoverPassword'),
recoverPasswordForm,
recoverPasswordValidation;
// Define recoverPassword menu
recoverPassword.get = function() {
if (!this.initialized) {
this.init();
}
return this.contents;
};
recoverPassword.init = function() {
this.contents = $(Riot.Sandworm.getTwig('recoverPassword', {
recoverPassword: options.localization.recover_password,
accountName: options.localization.account_name,
submit: options.localization.submit,
host: options.host
})).appendTo($pvpnet);
// If menu is not in standalone mode add modal cancel and close buttons.
if (!options.standalone) {
$(".pvpnet-modal-header", this.contents).append(
$("<div>").addClass("pvpnet-modal-close")
.bind("click", function(e) {
// Hide modal when form is closed
e.preventDefault();
Riot.Sandworm.pvpnetMenus.getActive().hide();
})
);
}
$(".clearfix", this.contents).append(
$(Riot.Sandworm.getTwig('formCancel', {
cancel: options.localization.cancel
})).bind("click", function (e) {
// Hide modal when form is canceled
e.preventDefault();
Riot.Sandworm.pvpnetMenus.show("login", true);
})
);
this.initialized = true;
recoverPasswordForm = $(".pvpnet-recover-password-form", $pvpnet);
};
recoverPassword.onSubmit = function (e) {
var $form = $(e.target),
input = {};
$("input[type!='submit']", $form).each(function () {
input[this.name] = $(this).val();
});
// Trigger form clear and show a loader before sending request.
events.trigger("pvpnet-form-clear", {form:$form});
events.trigger('pvpnet-form-show-loader', {form:$form});
recoverPasswordValidation.setLock(true);
bridge.send({
type:'recover-password',
action:$form.attr('action'),
input:input
}).then(recoverPassword.onSuccess, recoverPassword.onError);
};
recoverPassword.onValidate = function ($form) {
return $("input[type=text]", $form).val();
};
recoverPassword.onSuccess = function(data){
var $form = recoverPasswordForm;
events.trigger("pvpnet-form-hide-loader",{form:$form});
if(data.success){
events.trigger("pvpnet-form-ajax-response",{form: $form, message:data.message });
}
else{
events.trigger("pvpnet-form-ajax-error", {form : $form, message: data.error});
}
$form.one("keyup", "input[name]", function () {
recoverPasswordValidation.setLock(false);
});
};
recoverPassword.onError = function(data){
var $form = recoverPasswordForm;
events.trigger("pvpnet-form-hide-loader",{form:$form});
events.trigger("pvpnet-form-ajax-error", {form : $form, message: data});
$form.one("keyup", "input[name]", function () {
recoverPasswordValidation.setLock(false);
});
};
// Fade out when menu manager tries to hide this menu.
recoverPassword.hide = function() {
if (this.active) {
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().fadeOut(100, function() {
$(this).trigger("pvpnet-menu-recoverPassword-hide");
events.trigger("pvpnet-menu-hide");
Riot.Sandworm.pvpnetMenus.setAnimating(false);
});
this.active = false;
recoverPasswordValidation.detach();
}
};
// Fade in when menu manager tries to hide this menu.
recoverPassword.show = function() {
if (!this.active) {
Riot.Sandworm.track("pageview", "/sandworm/recoverPassword");
Riot.Sandworm.pvpnetMenus.setAnimating(true);
this.get().fadeIn(100, function() {
$(this).trigger("pvpnet-menu-recoverPassword-show");
$("input[type!=submit]", this).eq(0).focus();
Riot.Sandworm.pvpnetMenus.setAnimating(false);
});
this.active = true;
recoverPasswordValidation = recoverPasswordForm.addSandwormFormValidation({
onValidate: recoverPassword.onValidate,
onSubmit: recoverPassword.onSubmit
});
}
};
// Show login menu when recover username menu is canceled.
recoverPassword.cancel = function() {
Riot.Sandworm.pvpnetMenus.show("login",true);
};
events.trigger("pvpnet-init");
}
})(jQuery);
